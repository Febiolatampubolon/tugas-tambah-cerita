var Mo=a=>{throw TypeError(a)};var on=(a,i,o)=>i.has(a)||Mo("Cannot "+o);var V=(a,i,o)=>(on(a,i,"read from private field"),o?o.call(a):i.get(a)),fe=(a,i,o)=>i.has(a)?Mo("Cannot add the same private member more than once"):i instanceof WeakSet?i.add(a):i.set(a,o),Me=(a,i,o,r)=>(on(a,i,"write to private field"),r?r.call(a,o):i.set(a,o),o),Be=(a,i,o)=>(on(a,i,"access private method"),o);(function(){const i=document.createElement("link").relList;if(i&&i.supports&&i.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))r(c);new MutationObserver(c=>{for(const d of c)if(d.type==="childList")for(const h of d.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function o(c){const d={};return c.integrity&&(d.integrity=c.integrity),c.referrerPolicy&&(d.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?d.credentials="include":c.crossOrigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function r(c){if(c.ep)return;c.ep=!0;const d=o(c);fetch(c.href,d)}})();const ta="modulepreload",ea=function(a){return"/story-catalog/"+a},Bo={},Ne=function(i,o,r){let c=Promise.resolve();if(o&&o.length>0){document.getElementsByTagName("link");const h=document.querySelector("meta[property=csp-nonce]"),p=(h==null?void 0:h.nonce)||(h==null?void 0:h.getAttribute("nonce"));c=Promise.allSettled(o.map(g=>{if(g=ea(g),g in Bo)return;Bo[g]=!0;const w=g.endsWith(".css"),y=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${g}"]${y}`))return;const b=document.createElement("link");if(b.rel=w?"stylesheet":ta,w||(b.as="script"),b.crossOrigin="",b.href=g,p&&b.setAttribute("nonce",p),document.head.appendChild(b),w)return new Promise((I,$)=>{b.addEventListener("load",I),b.addEventListener("error",()=>$(new Error(`Unable to preload CSS for ${g}`)))})}))}function d(h){const p=new Event("vite:preloadError",{cancelable:!0});if(p.payload=h,window.dispatchEvent(p),!p.defaultPrevented)throw h}return c.then(h=>{for(const p of h||[])p.status==="rejected"&&d(p.reason);return i().catch(d)})};class _i{constructor(i){this.view=i}async init(){}showLoading(){this.view.showLoading&&this.view.showLoading()}hideLoading(){this.view.hideLoading&&this.view.hideLoading()}showError(i){this.view.showError?this.view.showError(i):console.error(i)}showSuccess(i){this.view.showSuccess&&this.view.showSuccess(i)}}class jt{constructor(){this.presenter=null}async render(){return"<div>Base Page</div>"}async afterRender(){this.presenter&&await this.presenter.init()}showLoading(){const i=document.getElementById("loading-indicator");i&&(i.style.display="flex",i.setAttribute("aria-hidden","false")),Ne(async()=>{const{AccessibilityUtils:o}=await Promise.resolve().then(()=>ze);return{AccessibilityUtils:o}},void 0).then(({AccessibilityUtils:o})=>{o.announceLoadingState(!0)})}hideLoading(){const i=document.getElementById("loading-indicator");i&&(i.style.display="none",i.setAttribute("aria-hidden","true")),Ne(async()=>{const{AccessibilityUtils:o}=await Promise.resolve().then(()=>ze);return{AccessibilityUtils:o}},void 0).then(({AccessibilityUtils:o})=>{o.announceLoadingState(!1)})}showError(i){this.showNotification(i,"error"),Ne(async()=>{const{AccessibilityUtils:o}=await Promise.resolve().then(()=>ze);return{AccessibilityUtils:o}},void 0).then(({AccessibilityUtils:o})=>{o.announce(`Error: ${i}`,"assertive")})}showSuccess(i){this.showNotification(i,"success"),Ne(async()=>{const{AccessibilityUtils:o}=await Promise.resolve().then(()=>ze);return{AccessibilityUtils:o}},void 0).then(({AccessibilityUtils:o})=>{o.announce(i,"polite")})}showNotification(i,o="info"){const r=document.createElement("div");r.className=`notification ${o}`,r.innerHTML=`
      <span>${i}</span>
      <button class="close-notification" onclick="this.parentElement.remove()">√ó</button>
    `,document.body.appendChild(r),setTimeout(()=>{r.parentElement&&r.remove()},5e3)}}function is(a,i){return function(){return a.apply(i,arguments)}}const{toString:ia}=Object.prototype,{getPrototypeOf:vn}=Object,{iterator:vi,toStringTag:ns}=Symbol,yi=(a=>i=>{const o=ia.call(i);return a[o]||(a[o]=o.slice(8,-1).toLowerCase())})(Object.create(null)),Pt=a=>(a=a.toLowerCase(),i=>yi(i)===a),wi=a=>i=>typeof i===a,{isArray:me}=Array,pe=wi("undefined");function Ze(a){return a!==null&&!pe(a)&&a.constructor!==null&&!pe(a.constructor)&&pt(a.constructor.isBuffer)&&a.constructor.isBuffer(a)}const os=Pt("ArrayBuffer");function na(a){let i;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?i=ArrayBuffer.isView(a):i=a&&a.buffer&&os(a.buffer),i}const oa=wi("string"),pt=wi("function"),ss=wi("number"),Ue=a=>a!==null&&typeof a=="object",sa=a=>a===!0||a===!1,hi=a=>{if(yi(a)!=="object")return!1;const i=vn(a);return(i===null||i===Object.prototype||Object.getPrototypeOf(i)===null)&&!(ns in a)&&!(vi in a)},ra=a=>{if(!Ue(a)||Ze(a))return!1;try{return Object.keys(a).length===0&&Object.getPrototypeOf(a)===Object.prototype}catch{return!1}},aa=Pt("Date"),la=Pt("File"),ca=Pt("Blob"),ua=Pt("FileList"),ha=a=>Ue(a)&&pt(a.pipe),da=a=>{let i;return a&&(typeof FormData=="function"&&a instanceof FormData||pt(a.append)&&((i=yi(a))==="formdata"||i==="object"&&pt(a.toString)&&a.toString()==="[object FormData]"))},fa=Pt("URLSearchParams"),[pa,ma,ga,_a]=["ReadableStream","Request","Response","Headers"].map(Pt),va=a=>a.trim?a.trim():a.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function He(a,i,{allOwnKeys:o=!1}={}){if(a===null||typeof a>"u")return;let r,c;if(typeof a!="object"&&(a=[a]),me(a))for(r=0,c=a.length;r<c;r++)i.call(null,a[r],r,a);else{if(Ze(a))return;const d=o?Object.getOwnPropertyNames(a):Object.keys(a),h=d.length;let p;for(r=0;r<h;r++)p=d[r],i.call(null,a[p],p,a)}}function rs(a,i){if(Ze(a))return null;i=i.toLowerCase();const o=Object.keys(a);let r=o.length,c;for(;r-- >0;)if(c=o[r],i===c.toLowerCase())return c;return null}const te=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,as=a=>!pe(a)&&a!==te;function un(){const{caseless:a,skipUndefined:i}=as(this)&&this||{},o={},r=(c,d)=>{const h=a&&rs(o,d)||d;hi(o[h])&&hi(c)?o[h]=un(o[h],c):hi(c)?o[h]=un({},c):me(c)?o[h]=c.slice():(!i||!pe(c))&&(o[h]=c)};for(let c=0,d=arguments.length;c<d;c++)arguments[c]&&He(arguments[c],r);return o}const ya=(a,i,o,{allOwnKeys:r}={})=>(He(i,(c,d)=>{o&&pt(c)?a[d]=is(c,o):a[d]=c},{allOwnKeys:r}),a),wa=a=>(a.charCodeAt(0)===65279&&(a=a.slice(1)),a),ba=(a,i,o,r)=>{a.prototype=Object.create(i.prototype,r),a.prototype.constructor=a,Object.defineProperty(a,"super",{value:i.prototype}),o&&Object.assign(a.prototype,o)},Sa=(a,i,o,r)=>{let c,d,h;const p={};if(i=i||{},a==null)return i;do{for(c=Object.getOwnPropertyNames(a),d=c.length;d-- >0;)h=c[d],(!r||r(h,a,i))&&!p[h]&&(i[h]=a[h],p[h]=!0);a=o!==!1&&vn(a)}while(a&&(!o||o(a,i))&&a!==Object.prototype);return i},La=(a,i,o)=>{a=String(a),(o===void 0||o>a.length)&&(o=a.length),o-=i.length;const r=a.indexOf(i,o);return r!==-1&&r===o},Ea=a=>{if(!a)return null;if(me(a))return a;let i=a.length;if(!ss(i))return null;const o=new Array(i);for(;i-- >0;)o[i]=a[i];return o},xa=(a=>i=>a&&i instanceof a)(typeof Uint8Array<"u"&&vn(Uint8Array)),Pa=(a,i)=>{const r=(a&&a[vi]).call(a);let c;for(;(c=r.next())&&!c.done;){const d=c.value;i.call(a,d[0],d[1])}},Ta=(a,i)=>{let o;const r=[];for(;(o=a.exec(i))!==null;)r.push(o);return r},Aa=Pt("HTMLFormElement"),Ca=a=>a.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(o,r,c){return r.toUpperCase()+c}),Ro=(({hasOwnProperty:a})=>(i,o)=>a.call(i,o))(Object.prototype),ka=Pt("RegExp"),ls=(a,i)=>{const o=Object.getOwnPropertyDescriptors(a),r={};He(o,(c,d)=>{let h;(h=i(c,d,a))!==!1&&(r[d]=h||c)}),Object.defineProperties(a,r)},Ia=a=>{ls(a,(i,o)=>{if(pt(a)&&["arguments","caller","callee"].indexOf(o)!==-1)return!1;const r=a[o];if(pt(r)){if(i.enumerable=!1,"writable"in i){i.writable=!1;return}i.set||(i.set=()=>{throw Error("Can not rewrite read-only method '"+o+"'")})}})},Oa=(a,i)=>{const o={},r=c=>{c.forEach(d=>{o[d]=!0})};return me(a)?r(a):r(String(a).split(i)),o},Ma=()=>{},Ba=(a,i)=>a!=null&&Number.isFinite(a=+a)?a:i;function Ra(a){return!!(a&&pt(a.append)&&a[ns]==="FormData"&&a[vi])}const Na=a=>{const i=new Array(10),o=(r,c)=>{if(Ue(r)){if(i.indexOf(r)>=0)return;if(Ze(r))return r;if(!("toJSON"in r)){i[c]=r;const d=me(r)?[]:{};return He(r,(h,p)=>{const g=o(h,c+1);!pe(g)&&(d[p]=g)}),i[c]=void 0,d}}return r};return o(a,0)},Da=Pt("AsyncFunction"),za=a=>a&&(Ue(a)||pt(a))&&pt(a.then)&&pt(a.catch),cs=((a,i)=>a?setImmediate:i?((o,r)=>(te.addEventListener("message",({source:c,data:d})=>{c===te&&d===o&&r.length&&r.shift()()},!1),c=>{r.push(c),te.postMessage(o,"*")}))(`axios@${Math.random()}`,[]):o=>setTimeout(o))(typeof setImmediate=="function",pt(te.postMessage)),Fa=typeof queueMicrotask<"u"?queueMicrotask.bind(te):typeof process<"u"&&process.nextTick||cs,Za=a=>a!=null&&pt(a[vi]),v={isArray:me,isArrayBuffer:os,isBuffer:Ze,isFormData:da,isArrayBufferView:na,isString:oa,isNumber:ss,isBoolean:sa,isObject:Ue,isPlainObject:hi,isEmptyObject:ra,isReadableStream:pa,isRequest:ma,isResponse:ga,isHeaders:_a,isUndefined:pe,isDate:aa,isFile:la,isBlob:ca,isRegExp:ka,isFunction:pt,isStream:ha,isURLSearchParams:fa,isTypedArray:xa,isFileList:ua,forEach:He,merge:un,extend:ya,trim:va,stripBOM:wa,inherits:ba,toFlatObject:Sa,kindOf:yi,kindOfTest:Pt,endsWith:La,toArray:Ea,forEachEntry:Pa,matchAll:Ta,isHTMLForm:Aa,hasOwnProperty:Ro,hasOwnProp:Ro,reduceDescriptors:ls,freezeMethods:Ia,toObjectSet:Oa,toCamelCase:Ca,noop:Ma,toFiniteNumber:Ba,findKey:rs,global:te,isContextDefined:as,isSpecCompliantForm:Ra,toJSONObject:Na,isAsyncFn:Da,isThenable:za,setImmediate:cs,asap:Fa,isIterable:Za};function B(a,i,o,r,c){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=a,this.name="AxiosError",i&&(this.code=i),o&&(this.config=o),r&&(this.request=r),c&&(this.response=c,this.status=c.status?c.status:null)}v.inherits(B,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:v.toJSONObject(this.config),code:this.code,status:this.status}}});const us=B.prototype,hs={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(a=>{hs[a]={value:a}});Object.defineProperties(B,hs);Object.defineProperty(us,"isAxiosError",{value:!0});B.from=(a,i,o,r,c,d)=>{const h=Object.create(us);v.toFlatObject(a,h,function(y){return y!==Error.prototype},w=>w!=="isAxiosError");const p=a&&a.message?a.message:"Error",g=i==null&&a?a.code:i;return B.call(h,p,g,o,r,c),a&&h.cause==null&&Object.defineProperty(h,"cause",{value:a,configurable:!0}),h.name=a&&a.name||"Error",d&&Object.assign(h,d),h};const Ua=null;function hn(a){return v.isPlainObject(a)||v.isArray(a)}function ds(a){return v.endsWith(a,"[]")?a.slice(0,-2):a}function No(a,i,o){return a?a.concat(i).map(function(c,d){return c=ds(c),!o&&d?"["+c+"]":c}).join(o?".":""):i}function Ha(a){return v.isArray(a)&&!a.some(hn)}const qa=v.toFlatObject(v,{},null,function(i){return/^is[A-Z]/.test(i)});function bi(a,i,o){if(!v.isObject(a))throw new TypeError("target must be an object");i=i||new FormData,o=v.toFlatObject(o,{metaTokens:!0,dots:!1,indexes:!1},!1,function(x,T){return!v.isUndefined(T[x])});const r=o.metaTokens,c=o.visitor||y,d=o.dots,h=o.indexes,g=(o.Blob||typeof Blob<"u"&&Blob)&&v.isSpecCompliantForm(i);if(!v.isFunction(c))throw new TypeError("visitor must be a function");function w(E){if(E===null)return"";if(v.isDate(E))return E.toISOString();if(v.isBoolean(E))return E.toString();if(!g&&v.isBlob(E))throw new B("Blob is not supported. Use a Buffer instead.");return v.isArrayBuffer(E)||v.isTypedArray(E)?g&&typeof Blob=="function"?new Blob([E]):Buffer.from(E):E}function y(E,x,T){let K=E;if(E&&!T&&typeof E=="object"){if(v.endsWith(x,"{}"))x=r?x:x.slice(0,-2),E=JSON.stringify(E);else if(v.isArray(E)&&Ha(E)||(v.isFileList(E)||v.endsWith(x,"[]"))&&(K=v.toArray(E)))return x=ds(x),K.forEach(function(H,et){!(v.isUndefined(H)||H===null)&&i.append(h===!0?No([x],et,d):h===null?x:x+"[]",w(H))}),!1}return hn(E)?!0:(i.append(No(T,x,d),w(E)),!1)}const b=[],I=Object.assign(qa,{defaultVisitor:y,convertValue:w,isVisitable:hn});function $(E,x){if(!v.isUndefined(E)){if(b.indexOf(E)!==-1)throw Error("Circular reference detected in "+x.join("."));b.push(E),v.forEach(E,function(K,ut){(!(v.isUndefined(K)||K===null)&&c.call(i,K,v.isString(ut)?ut.trim():ut,x,I))===!0&&$(K,x?x.concat(ut):[ut])}),b.pop()}}if(!v.isObject(a))throw new TypeError("data must be an object");return $(a),i}function Do(a){const i={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(a).replace(/[!'()~]|%20|%00/g,function(r){return i[r]})}function yn(a,i){this._pairs=[],a&&bi(a,this,i)}const fs=yn.prototype;fs.append=function(i,o){this._pairs.push([i,o])};fs.toString=function(i){const o=i?function(r){return i.call(this,r,Do)}:Do;return this._pairs.map(function(c){return o(c[0])+"="+o(c[1])},"").join("&")};function Wa(a){return encodeURIComponent(a).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+")}function ps(a,i,o){if(!i)return a;const r=o&&o.encode||Wa;v.isFunction(o)&&(o={serialize:o});const c=o&&o.serialize;let d;if(c?d=c(i,o):d=v.isURLSearchParams(i)?i.toString():new yn(i,o).toString(r),d){const h=a.indexOf("#");h!==-1&&(a=a.slice(0,h)),a+=(a.indexOf("?")===-1?"?":"&")+d}return a}class zo{constructor(){this.handlers=[]}use(i,o,r){return this.handlers.push({fulfilled:i,rejected:o,synchronous:r?r.synchronous:!1,runWhen:r?r.runWhen:null}),this.handlers.length-1}eject(i){this.handlers[i]&&(this.handlers[i]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(i){v.forEach(this.handlers,function(r){r!==null&&i(r)})}}const ms={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},$a=typeof URLSearchParams<"u"?URLSearchParams:yn,ja=typeof FormData<"u"?FormData:null,Va=typeof Blob<"u"?Blob:null,Ga={isBrowser:!0,classes:{URLSearchParams:$a,FormData:ja,Blob:Va},protocols:["http","https","file","blob","url","data"]},wn=typeof window<"u"&&typeof document<"u",dn=typeof navigator=="object"&&navigator||void 0,Ka=wn&&(!dn||["ReactNative","NativeScript","NS"].indexOf(dn.product)<0),Ja=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Ya=wn&&window.location.href||"http://localhost",Qa=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:wn,hasStandardBrowserEnv:Ka,hasStandardBrowserWebWorkerEnv:Ja,navigator:dn,origin:Ya},Symbol.toStringTag,{value:"Module"})),ct={...Qa,...Ga};function Xa(a,i){return bi(a,new ct.classes.URLSearchParams,{visitor:function(o,r,c,d){return ct.isNode&&v.isBuffer(o)?(this.append(r,o.toString("base64")),!1):d.defaultVisitor.apply(this,arguments)},...i})}function tl(a){return v.matchAll(/\w+|\[(\w*)]/g,a).map(i=>i[0]==="[]"?"":i[1]||i[0])}function el(a){const i={},o=Object.keys(a);let r;const c=o.length;let d;for(r=0;r<c;r++)d=o[r],i[d]=a[d];return i}function gs(a){function i(o,r,c,d){let h=o[d++];if(h==="__proto__")return!0;const p=Number.isFinite(+h),g=d>=o.length;return h=!h&&v.isArray(c)?c.length:h,g?(v.hasOwnProp(c,h)?c[h]=[c[h],r]:c[h]=r,!p):((!c[h]||!v.isObject(c[h]))&&(c[h]=[]),i(o,r,c[h],d)&&v.isArray(c[h])&&(c[h]=el(c[h])),!p)}if(v.isFormData(a)&&v.isFunction(a.entries)){const o={};return v.forEachEntry(a,(r,c)=>{i(tl(r),c,o,0)}),o}return null}function il(a,i,o){if(v.isString(a))try{return(i||JSON.parse)(a),v.trim(a)}catch(r){if(r.name!=="SyntaxError")throw r}return(o||JSON.stringify)(a)}const qe={transitional:ms,adapter:["xhr","http","fetch"],transformRequest:[function(i,o){const r=o.getContentType()||"",c=r.indexOf("application/json")>-1,d=v.isObject(i);if(d&&v.isHTMLForm(i)&&(i=new FormData(i)),v.isFormData(i))return c?JSON.stringify(gs(i)):i;if(v.isArrayBuffer(i)||v.isBuffer(i)||v.isStream(i)||v.isFile(i)||v.isBlob(i)||v.isReadableStream(i))return i;if(v.isArrayBufferView(i))return i.buffer;if(v.isURLSearchParams(i))return o.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),i.toString();let p;if(d){if(r.indexOf("application/x-www-form-urlencoded")>-1)return Xa(i,this.formSerializer).toString();if((p=v.isFileList(i))||r.indexOf("multipart/form-data")>-1){const g=this.env&&this.env.FormData;return bi(p?{"files[]":i}:i,g&&new g,this.formSerializer)}}return d||c?(o.setContentType("application/json",!1),il(i)):i}],transformResponse:[function(i){const o=this.transitional||qe.transitional,r=o&&o.forcedJSONParsing,c=this.responseType==="json";if(v.isResponse(i)||v.isReadableStream(i))return i;if(i&&v.isString(i)&&(r&&!this.responseType||c)){const h=!(o&&o.silentJSONParsing)&&c;try{return JSON.parse(i,this.parseReviver)}catch(p){if(h)throw p.name==="SyntaxError"?B.from(p,B.ERR_BAD_RESPONSE,this,null,this.response):p}}return i}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ct.classes.FormData,Blob:ct.classes.Blob},validateStatus:function(i){return i>=200&&i<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};v.forEach(["delete","get","head","post","put","patch"],a=>{qe.headers[a]={}});const nl=v.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),ol=a=>{const i={};let o,r,c;return a&&a.split(`
`).forEach(function(h){c=h.indexOf(":"),o=h.substring(0,c).trim().toLowerCase(),r=h.substring(c+1).trim(),!(!o||i[o]&&nl[o])&&(o==="set-cookie"?i[o]?i[o].push(r):i[o]=[r]:i[o]=i[o]?i[o]+", "+r:r)}),i},Fo=Symbol("internals");function Re(a){return a&&String(a).trim().toLowerCase()}function di(a){return a===!1||a==null?a:v.isArray(a)?a.map(di):String(a)}function sl(a){const i=Object.create(null),o=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let r;for(;r=o.exec(a);)i[r[1]]=r[2];return i}const rl=a=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(a.trim());function sn(a,i,o,r,c){if(v.isFunction(r))return r.call(this,i,o);if(c&&(i=o),!!v.isString(i)){if(v.isString(r))return i.indexOf(r)!==-1;if(v.isRegExp(r))return r.test(i)}}function al(a){return a.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(i,o,r)=>o.toUpperCase()+r)}function ll(a,i){const o=v.toCamelCase(" "+i);["get","set","has"].forEach(r=>{Object.defineProperty(a,r+o,{value:function(c,d,h){return this[r].call(this,i,c,d,h)},configurable:!0})})}let mt=class{constructor(i){i&&this.set(i)}set(i,o,r){const c=this;function d(p,g,w){const y=Re(g);if(!y)throw new Error("header name must be a non-empty string");const b=v.findKey(c,y);(!b||c[b]===void 0||w===!0||w===void 0&&c[b]!==!1)&&(c[b||g]=di(p))}const h=(p,g)=>v.forEach(p,(w,y)=>d(w,y,g));if(v.isPlainObject(i)||i instanceof this.constructor)h(i,o);else if(v.isString(i)&&(i=i.trim())&&!rl(i))h(ol(i),o);else if(v.isObject(i)&&v.isIterable(i)){let p={},g,w;for(const y of i){if(!v.isArray(y))throw TypeError("Object iterator must return a key-value pair");p[w=y[0]]=(g=p[w])?v.isArray(g)?[...g,y[1]]:[g,y[1]]:y[1]}h(p,o)}else i!=null&&d(o,i,r);return this}get(i,o){if(i=Re(i),i){const r=v.findKey(this,i);if(r){const c=this[r];if(!o)return c;if(o===!0)return sl(c);if(v.isFunction(o))return o.call(this,c,r);if(v.isRegExp(o))return o.exec(c);throw new TypeError("parser must be boolean|regexp|function")}}}has(i,o){if(i=Re(i),i){const r=v.findKey(this,i);return!!(r&&this[r]!==void 0&&(!o||sn(this,this[r],r,o)))}return!1}delete(i,o){const r=this;let c=!1;function d(h){if(h=Re(h),h){const p=v.findKey(r,h);p&&(!o||sn(r,r[p],p,o))&&(delete r[p],c=!0)}}return v.isArray(i)?i.forEach(d):d(i),c}clear(i){const o=Object.keys(this);let r=o.length,c=!1;for(;r--;){const d=o[r];(!i||sn(this,this[d],d,i,!0))&&(delete this[d],c=!0)}return c}normalize(i){const o=this,r={};return v.forEach(this,(c,d)=>{const h=v.findKey(r,d);if(h){o[h]=di(c),delete o[d];return}const p=i?al(d):String(d).trim();p!==d&&delete o[d],o[p]=di(c),r[p]=!0}),this}concat(...i){return this.constructor.concat(this,...i)}toJSON(i){const o=Object.create(null);return v.forEach(this,(r,c)=>{r!=null&&r!==!1&&(o[c]=i&&v.isArray(r)?r.join(", "):r)}),o}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([i,o])=>i+": "+o).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(i){return i instanceof this?i:new this(i)}static concat(i,...o){const r=new this(i);return o.forEach(c=>r.set(c)),r}static accessor(i){const r=(this[Fo]=this[Fo]={accessors:{}}).accessors,c=this.prototype;function d(h){const p=Re(h);r[p]||(ll(c,h),r[p]=!0)}return v.isArray(i)?i.forEach(d):d(i),this}};mt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);v.reduceDescriptors(mt.prototype,({value:a},i)=>{let o=i[0].toUpperCase()+i.slice(1);return{get:()=>a,set(r){this[o]=r}}});v.freezeMethods(mt);function rn(a,i){const o=this||qe,r=i||o,c=mt.from(r.headers);let d=r.data;return v.forEach(a,function(p){d=p.call(o,d,c.normalize(),i?i.status:void 0)}),c.normalize(),d}function _s(a){return!!(a&&a.__CANCEL__)}function ge(a,i,o){B.call(this,a??"canceled",B.ERR_CANCELED,i,o),this.name="CanceledError"}v.inherits(ge,B,{__CANCEL__:!0});function vs(a,i,o){const r=o.config.validateStatus;!o.status||!r||r(o.status)?a(o):i(new B("Request failed with status code "+o.status,[B.ERR_BAD_REQUEST,B.ERR_BAD_RESPONSE][Math.floor(o.status/100)-4],o.config,o.request,o))}function cl(a){const i=/^([-+\w]{1,25})(:?\/\/|:)/.exec(a);return i&&i[1]||""}function ul(a,i){a=a||10;const o=new Array(a),r=new Array(a);let c=0,d=0,h;return i=i!==void 0?i:1e3,function(g){const w=Date.now(),y=r[d];h||(h=w),o[c]=g,r[c]=w;let b=d,I=0;for(;b!==c;)I+=o[b++],b=b%a;if(c=(c+1)%a,c===d&&(d=(d+1)%a),w-h<i)return;const $=y&&w-y;return $?Math.round(I*1e3/$):void 0}}function hl(a,i){let o=0,r=1e3/i,c,d;const h=(w,y=Date.now())=>{o=y,c=null,d&&(clearTimeout(d),d=null),a(...w)};return[(...w)=>{const y=Date.now(),b=y-o;b>=r?h(w,y):(c=w,d||(d=setTimeout(()=>{d=null,h(c)},r-b)))},()=>c&&h(c)]}const gi=(a,i,o=3)=>{let r=0;const c=ul(50,250);return hl(d=>{const h=d.loaded,p=d.lengthComputable?d.total:void 0,g=h-r,w=c(g),y=h<=p;r=h;const b={loaded:h,total:p,progress:p?h/p:void 0,bytes:g,rate:w||void 0,estimated:w&&p&&y?(p-h)/w:void 0,event:d,lengthComputable:p!=null,[i?"download":"upload"]:!0};a(b)},o)},Zo=(a,i)=>{const o=a!=null;return[r=>i[0]({lengthComputable:o,total:a,loaded:r}),i[1]]},Uo=a=>(...i)=>v.asap(()=>a(...i)),dl=ct.hasStandardBrowserEnv?((a,i)=>o=>(o=new URL(o,ct.origin),a.protocol===o.protocol&&a.host===o.host&&(i||a.port===o.port)))(new URL(ct.origin),ct.navigator&&/(msie|trident)/i.test(ct.navigator.userAgent)):()=>!0,fl=ct.hasStandardBrowserEnv?{write(a,i,o,r,c,d,h){if(typeof document>"u")return;const p=[`${a}=${encodeURIComponent(i)}`];v.isNumber(o)&&p.push(`expires=${new Date(o).toUTCString()}`),v.isString(r)&&p.push(`path=${r}`),v.isString(c)&&p.push(`domain=${c}`),d===!0&&p.push("secure"),v.isString(h)&&p.push(`SameSite=${h}`),document.cookie=p.join("; ")},read(a){if(typeof document>"u")return null;const i=document.cookie.match(new RegExp("(?:^|; )"+a+"=([^;]*)"));return i?decodeURIComponent(i[1]):null},remove(a){this.write(a,"",Date.now()-864e5,"/")}}:{write(){},read(){return null},remove(){}};function pl(a){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(a)}function ml(a,i){return i?a.replace(/\/?\/$/,"")+"/"+i.replace(/^\/+/,""):a}function ys(a,i,o){let r=!pl(i);return a&&(r||o==!1)?ml(a,i):i}const Ho=a=>a instanceof mt?{...a}:a;function ie(a,i){i=i||{};const o={};function r(w,y,b,I){return v.isPlainObject(w)&&v.isPlainObject(y)?v.merge.call({caseless:I},w,y):v.isPlainObject(y)?v.merge({},y):v.isArray(y)?y.slice():y}function c(w,y,b,I){if(v.isUndefined(y)){if(!v.isUndefined(w))return r(void 0,w,b,I)}else return r(w,y,b,I)}function d(w,y){if(!v.isUndefined(y))return r(void 0,y)}function h(w,y){if(v.isUndefined(y)){if(!v.isUndefined(w))return r(void 0,w)}else return r(void 0,y)}function p(w,y,b){if(b in i)return r(w,y);if(b in a)return r(void 0,w)}const g={url:d,method:d,data:d,baseURL:h,transformRequest:h,transformResponse:h,paramsSerializer:h,timeout:h,timeoutMessage:h,withCredentials:h,withXSRFToken:h,adapter:h,responseType:h,xsrfCookieName:h,xsrfHeaderName:h,onUploadProgress:h,onDownloadProgress:h,decompress:h,maxContentLength:h,maxBodyLength:h,beforeRedirect:h,transport:h,httpAgent:h,httpsAgent:h,cancelToken:h,socketPath:h,responseEncoding:h,validateStatus:p,headers:(w,y,b)=>c(Ho(w),Ho(y),b,!0)};return v.forEach(Object.keys({...a,...i}),function(y){const b=g[y]||c,I=b(a[y],i[y],y);v.isUndefined(I)&&b!==p||(o[y]=I)}),o}const ws=a=>{const i=ie({},a);let{data:o,withXSRFToken:r,xsrfHeaderName:c,xsrfCookieName:d,headers:h,auth:p}=i;if(i.headers=h=mt.from(h),i.url=ps(ys(i.baseURL,i.url,i.allowAbsoluteUrls),a.params,a.paramsSerializer),p&&h.set("Authorization","Basic "+btoa((p.username||"")+":"+(p.password?unescape(encodeURIComponent(p.password)):""))),v.isFormData(o)){if(ct.hasStandardBrowserEnv||ct.hasStandardBrowserWebWorkerEnv)h.setContentType(void 0);else if(v.isFunction(o.getHeaders)){const g=o.getHeaders(),w=["content-type","content-length"];Object.entries(g).forEach(([y,b])=>{w.includes(y.toLowerCase())&&h.set(y,b)})}}if(ct.hasStandardBrowserEnv&&(r&&v.isFunction(r)&&(r=r(i)),r||r!==!1&&dl(i.url))){const g=c&&d&&fl.read(d);g&&h.set(c,g)}return i},gl=typeof XMLHttpRequest<"u",_l=gl&&function(a){return new Promise(function(o,r){const c=ws(a);let d=c.data;const h=mt.from(c.headers).normalize();let{responseType:p,onUploadProgress:g,onDownloadProgress:w}=c,y,b,I,$,E;function x(){$&&$(),E&&E(),c.cancelToken&&c.cancelToken.unsubscribe(y),c.signal&&c.signal.removeEventListener("abort",y)}let T=new XMLHttpRequest;T.open(c.method.toUpperCase(),c.url,!0),T.timeout=c.timeout;function K(){if(!T)return;const H=mt.from("getAllResponseHeaders"in T&&T.getAllResponseHeaders()),lt={data:!p||p==="text"||p==="json"?T.responseText:T.response,status:T.status,statusText:T.statusText,headers:H,config:a,request:T};vs(function(ht){o(ht),x()},function(ht){r(ht),x()},lt),T=null}"onloadend"in T?T.onloadend=K:T.onreadystatechange=function(){!T||T.readyState!==4||T.status===0&&!(T.responseURL&&T.responseURL.indexOf("file:")===0)||setTimeout(K)},T.onabort=function(){T&&(r(new B("Request aborted",B.ECONNABORTED,a,T)),T=null)},T.onerror=function(et){const lt=et&&et.message?et.message:"Network Error",Lt=new B(lt,B.ERR_NETWORK,a,T);Lt.event=et||null,r(Lt),T=null},T.ontimeout=function(){let et=c.timeout?"timeout of "+c.timeout+"ms exceeded":"timeout exceeded";const lt=c.transitional||ms;c.timeoutErrorMessage&&(et=c.timeoutErrorMessage),r(new B(et,lt.clarifyTimeoutError?B.ETIMEDOUT:B.ECONNABORTED,a,T)),T=null},d===void 0&&h.setContentType(null),"setRequestHeader"in T&&v.forEach(h.toJSON(),function(et,lt){T.setRequestHeader(lt,et)}),v.isUndefined(c.withCredentials)||(T.withCredentials=!!c.withCredentials),p&&p!=="json"&&(T.responseType=c.responseType),w&&([I,E]=gi(w,!0),T.addEventListener("progress",I)),g&&T.upload&&([b,$]=gi(g),T.upload.addEventListener("progress",b),T.upload.addEventListener("loadend",$)),(c.cancelToken||c.signal)&&(y=H=>{T&&(r(!H||H.type?new ge(null,a,T):H),T.abort(),T=null)},c.cancelToken&&c.cancelToken.subscribe(y),c.signal&&(c.signal.aborted?y():c.signal.addEventListener("abort",y)));const ut=cl(c.url);if(ut&&ct.protocols.indexOf(ut)===-1){r(new B("Unsupported protocol "+ut+":",B.ERR_BAD_REQUEST,a));return}T.send(d||null)})},vl=(a,i)=>{const{length:o}=a=a?a.filter(Boolean):[];if(i||o){let r=new AbortController,c;const d=function(w){if(!c){c=!0,p();const y=w instanceof Error?w:this.reason;r.abort(y instanceof B?y:new ge(y instanceof Error?y.message:y))}};let h=i&&setTimeout(()=>{h=null,d(new B(`timeout ${i} of ms exceeded`,B.ETIMEDOUT))},i);const p=()=>{a&&(h&&clearTimeout(h),h=null,a.forEach(w=>{w.unsubscribe?w.unsubscribe(d):w.removeEventListener("abort",d)}),a=null)};a.forEach(w=>w.addEventListener("abort",d));const{signal:g}=r;return g.unsubscribe=()=>v.asap(p),g}},yl=function*(a,i){let o=a.byteLength;if(o<i){yield a;return}let r=0,c;for(;r<o;)c=r+i,yield a.slice(r,c),r=c},wl=async function*(a,i){for await(const o of bl(a))yield*yl(o,i)},bl=async function*(a){if(a[Symbol.asyncIterator]){yield*a;return}const i=a.getReader();try{for(;;){const{done:o,value:r}=await i.read();if(o)break;yield r}}finally{await i.cancel()}},qo=(a,i,o,r)=>{const c=wl(a,i);let d=0,h,p=g=>{h||(h=!0,r&&r(g))};return new ReadableStream({async pull(g){try{const{done:w,value:y}=await c.next();if(w){p(),g.close();return}let b=y.byteLength;if(o){let I=d+=b;o(I)}g.enqueue(new Uint8Array(y))}catch(w){throw p(w),w}},cancel(g){return p(g),c.return()}},{highWaterMark:2})},Wo=64*1024,{isFunction:ui}=v,Sl=(({Request:a,Response:i})=>({Request:a,Response:i}))(v.global),{ReadableStream:$o,TextEncoder:jo}=v.global,Vo=(a,...i)=>{try{return!!a(...i)}catch{return!1}},Ll=a=>{a=v.merge.call({skipUndefined:!0},Sl,a);const{fetch:i,Request:o,Response:r}=a,c=i?ui(i):typeof fetch=="function",d=ui(o),h=ui(r);if(!c)return!1;const p=c&&ui($o),g=c&&(typeof jo=="function"?(E=>x=>E.encode(x))(new jo):async E=>new Uint8Array(await new o(E).arrayBuffer())),w=d&&p&&Vo(()=>{let E=!1;const x=new o(ct.origin,{body:new $o,method:"POST",get duplex(){return E=!0,"half"}}).headers.has("Content-Type");return E&&!x}),y=h&&p&&Vo(()=>v.isReadableStream(new r("").body)),b={stream:y&&(E=>E.body)};c&&["text","arrayBuffer","blob","formData","stream"].forEach(E=>{!b[E]&&(b[E]=(x,T)=>{let K=x&&x[E];if(K)return K.call(x);throw new B(`Response type '${E}' is not supported`,B.ERR_NOT_SUPPORT,T)})});const I=async E=>{if(E==null)return 0;if(v.isBlob(E))return E.size;if(v.isSpecCompliantForm(E))return(await new o(ct.origin,{method:"POST",body:E}).arrayBuffer()).byteLength;if(v.isArrayBufferView(E)||v.isArrayBuffer(E))return E.byteLength;if(v.isURLSearchParams(E)&&(E=E+""),v.isString(E))return(await g(E)).byteLength},$=async(E,x)=>{const T=v.toFiniteNumber(E.getContentLength());return T??I(x)};return async E=>{let{url:x,method:T,data:K,signal:ut,cancelToken:H,timeout:et,onDownloadProgress:lt,onUploadProgress:Lt,responseType:ht,headers:ne,withCredentials:Zt="same-origin",fetchOptions:_e}=ws(E),ot=i||fetch;ht=ht?(ht+"").toLowerCase():"text";let st=vl([ut,H&&H.toAbortSignal()],et),Vt=null;const rt=st&&st.unsubscribe&&(()=>{st.unsubscribe()});let We;try{if(Lt&&w&&T!=="get"&&T!=="head"&&(We=await $(ne,K))!==0){let F=new o(x,{method:"POST",body:K,duplex:"half"}),J;if(v.isFormData(K)&&(J=F.headers.get("content-type"))&&ne.setContentType(J),F.body){const[it,W]=Zo(We,gi(Uo(Lt)));K=qo(F.body,Wo,it,W)}}v.isString(Zt)||(Zt=Zt?"include":"omit");const j=d&&"credentials"in o.prototype,Ut={..._e,signal:st,method:T.toUpperCase(),headers:ne.normalize().toJSON(),body:K,duplex:"half",credentials:j?Zt:void 0};Vt=d&&new o(x,Ut);let C=await(d?ot(Vt,_e):ot(x,Ut));const ve=y&&(ht==="stream"||ht==="response");if(y&&(lt||ve&&rt)){const F={};["status","statusText","headers"].forEach(U=>{F[U]=C[U]});const J=v.toFiniteNumber(C.headers.get("content-length")),[it,W]=lt&&Zo(J,gi(Uo(lt),!0))||[];C=new r(qo(C.body,Wo,it,()=>{W&&W(),rt&&rt()}),F)}ht=ht||"text";let O=await b[v.findKey(b,ht)||"text"](C,E);return!ve&&rt&&rt(),await new Promise((F,J)=>{vs(F,J,{data:O,headers:mt.from(C.headers),status:C.status,statusText:C.statusText,config:E,request:Vt})})}catch(j){throw rt&&rt(),j&&j.name==="TypeError"&&/Load failed|fetch/i.test(j.message)?Object.assign(new B("Network Error",B.ERR_NETWORK,E,Vt),{cause:j.cause||j}):B.from(j,j&&j.code,E,Vt)}}},El=new Map,bs=a=>{let i=a&&a.env||{};const{fetch:o,Request:r,Response:c}=i,d=[r,c,o];let h=d.length,p=h,g,w,y=El;for(;p--;)g=d[p],w=y.get(g),w===void 0&&y.set(g,w=p?new Map:Ll(i)),y=w;return w};bs();const bn={http:Ua,xhr:_l,fetch:{get:bs}};v.forEach(bn,(a,i)=>{if(a){try{Object.defineProperty(a,"name",{value:i})}catch{}Object.defineProperty(a,"adapterName",{value:i})}});const Go=a=>`- ${a}`,xl=a=>v.isFunction(a)||a===null||a===!1;function Pl(a,i){a=v.isArray(a)?a:[a];const{length:o}=a;let r,c;const d={};for(let h=0;h<o;h++){r=a[h];let p;if(c=r,!xl(r)&&(c=bn[(p=String(r)).toLowerCase()],c===void 0))throw new B(`Unknown adapter '${p}'`);if(c&&(v.isFunction(c)||(c=c.get(i))))break;d[p||"#"+h]=c}if(!c){const h=Object.entries(d).map(([g,w])=>`adapter ${g} `+(w===!1?"is not supported by the environment":"is not available in the build"));let p=o?h.length>1?`since :
`+h.map(Go).join(`
`):" "+Go(h[0]):"as no adapter specified";throw new B("There is no suitable adapter to dispatch the request "+p,"ERR_NOT_SUPPORT")}return c}const Ss={getAdapter:Pl,adapters:bn};function an(a){if(a.cancelToken&&a.cancelToken.throwIfRequested(),a.signal&&a.signal.aborted)throw new ge(null,a)}function Ko(a){return an(a),a.headers=mt.from(a.headers),a.data=rn.call(a,a.transformRequest),["post","put","patch"].indexOf(a.method)!==-1&&a.headers.setContentType("application/x-www-form-urlencoded",!1),Ss.getAdapter(a.adapter||qe.adapter,a)(a).then(function(r){return an(a),r.data=rn.call(a,a.transformResponse,r),r.headers=mt.from(r.headers),r},function(r){return _s(r)||(an(a),r&&r.response&&(r.response.data=rn.call(a,a.transformResponse,r.response),r.response.headers=mt.from(r.response.headers))),Promise.reject(r)})}const Ls="1.13.2",Si={};["object","boolean","number","function","string","symbol"].forEach((a,i)=>{Si[a]=function(r){return typeof r===a||"a"+(i<1?"n ":" ")+a}});const Jo={};Si.transitional=function(i,o,r){function c(d,h){return"[Axios v"+Ls+"] Transitional option '"+d+"'"+h+(r?". "+r:"")}return(d,h,p)=>{if(i===!1)throw new B(c(h," has been removed"+(o?" in "+o:"")),B.ERR_DEPRECATED);return o&&!Jo[h]&&(Jo[h]=!0,console.warn(c(h," has been deprecated since v"+o+" and will be removed in the near future"))),i?i(d,h,p):!0}};Si.spelling=function(i){return(o,r)=>(console.warn(`${r} is likely a misspelling of ${i}`),!0)};function Tl(a,i,o){if(typeof a!="object")throw new B("options must be an object",B.ERR_BAD_OPTION_VALUE);const r=Object.keys(a);let c=r.length;for(;c-- >0;){const d=r[c],h=i[d];if(h){const p=a[d],g=p===void 0||h(p,d,a);if(g!==!0)throw new B("option "+d+" must be "+g,B.ERR_BAD_OPTION_VALUE);continue}if(o!==!0)throw new B("Unknown option "+d,B.ERR_BAD_OPTION)}}const fi={assertOptions:Tl,validators:Si},It=fi.validators;let ee=class{constructor(i){this.defaults=i||{},this.interceptors={request:new zo,response:new zo}}async request(i,o){try{return await this._request(i,o)}catch(r){if(r instanceof Error){let c={};Error.captureStackTrace?Error.captureStackTrace(c):c=new Error;const d=c.stack?c.stack.replace(/^.+\n/,""):"";try{r.stack?d&&!String(r.stack).endsWith(d.replace(/^.+\n.+\n/,""))&&(r.stack+=`
`+d):r.stack=d}catch{}}throw r}}_request(i,o){typeof i=="string"?(o=o||{},o.url=i):o=i||{},o=ie(this.defaults,o);const{transitional:r,paramsSerializer:c,headers:d}=o;r!==void 0&&fi.assertOptions(r,{silentJSONParsing:It.transitional(It.boolean),forcedJSONParsing:It.transitional(It.boolean),clarifyTimeoutError:It.transitional(It.boolean)},!1),c!=null&&(v.isFunction(c)?o.paramsSerializer={serialize:c}:fi.assertOptions(c,{encode:It.function,serialize:It.function},!0)),o.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?o.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:o.allowAbsoluteUrls=!0),fi.assertOptions(o,{baseUrl:It.spelling("baseURL"),withXsrfToken:It.spelling("withXSRFToken")},!0),o.method=(o.method||this.defaults.method||"get").toLowerCase();let h=d&&v.merge(d.common,d[o.method]);d&&v.forEach(["delete","get","head","post","put","patch","common"],E=>{delete d[E]}),o.headers=mt.concat(h,d);const p=[];let g=!0;this.interceptors.request.forEach(function(x){typeof x.runWhen=="function"&&x.runWhen(o)===!1||(g=g&&x.synchronous,p.unshift(x.fulfilled,x.rejected))});const w=[];this.interceptors.response.forEach(function(x){w.push(x.fulfilled,x.rejected)});let y,b=0,I;if(!g){const E=[Ko.bind(this),void 0];for(E.unshift(...p),E.push(...w),I=E.length,y=Promise.resolve(o);b<I;)y=y.then(E[b++],E[b++]);return y}I=p.length;let $=o;for(;b<I;){const E=p[b++],x=p[b++];try{$=E($)}catch(T){x.call(this,T);break}}try{y=Ko.call(this,$)}catch(E){return Promise.reject(E)}for(b=0,I=w.length;b<I;)y=y.then(w[b++],w[b++]);return y}getUri(i){i=ie(this.defaults,i);const o=ys(i.baseURL,i.url,i.allowAbsoluteUrls);return ps(o,i.params,i.paramsSerializer)}};v.forEach(["delete","get","head","options"],function(i){ee.prototype[i]=function(o,r){return this.request(ie(r||{},{method:i,url:o,data:(r||{}).data}))}});v.forEach(["post","put","patch"],function(i){function o(r){return function(d,h,p){return this.request(ie(p||{},{method:i,headers:r?{"Content-Type":"multipart/form-data"}:{},url:d,data:h}))}}ee.prototype[i]=o(),ee.prototype[i+"Form"]=o(!0)});let Al=class Es{constructor(i){if(typeof i!="function")throw new TypeError("executor must be a function.");let o;this.promise=new Promise(function(d){o=d});const r=this;this.promise.then(c=>{if(!r._listeners)return;let d=r._listeners.length;for(;d-- >0;)r._listeners[d](c);r._listeners=null}),this.promise.then=c=>{let d;const h=new Promise(p=>{r.subscribe(p),d=p}).then(c);return h.cancel=function(){r.unsubscribe(d)},h},i(function(d,h,p){r.reason||(r.reason=new ge(d,h,p),o(r.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(i){if(this.reason){i(this.reason);return}this._listeners?this._listeners.push(i):this._listeners=[i]}unsubscribe(i){if(!this._listeners)return;const o=this._listeners.indexOf(i);o!==-1&&this._listeners.splice(o,1)}toAbortSignal(){const i=new AbortController,o=r=>{i.abort(r)};return this.subscribe(o),i.signal.unsubscribe=()=>this.unsubscribe(o),i.signal}static source(){let i;return{token:new Es(function(c){i=c}),cancel:i}}};function Cl(a){return function(o){return a.apply(null,o)}}function kl(a){return v.isObject(a)&&a.isAxiosError===!0}const fn={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511,WebServerIsDown:521,ConnectionTimedOut:522,OriginIsUnreachable:523,TimeoutOccurred:524,SslHandshakeFailed:525,InvalidSslCertificate:526};Object.entries(fn).forEach(([a,i])=>{fn[i]=a});function xs(a){const i=new ee(a),o=is(ee.prototype.request,i);return v.extend(o,ee.prototype,i,{allOwnKeys:!0}),v.extend(o,i,null,{allOwnKeys:!0}),o.create=function(c){return xs(ie(a,c))},o}const Q=xs(qe);Q.Axios=ee;Q.CanceledError=ge;Q.CancelToken=Al;Q.isCancel=_s;Q.VERSION=Ls;Q.toFormData=bi;Q.AxiosError=B;Q.Cancel=Q.CanceledError;Q.all=function(i){return Promise.all(i)};Q.spread=Cl;Q.isAxiosError=kl;Q.mergeConfig=ie;Q.AxiosHeaders=mt;Q.formToJSON=a=>gs(v.isHTMLForm(a)?new FormData(a):a);Q.getAdapter=Ss.getAdapter;Q.HttpStatusCode=fn;Q.default=Q;const{Axios:uc,AxiosError:hc,CanceledError:dc,isCancel:fc,CancelToken:pc,VERSION:mc,all:gc,Cancel:_c,isAxiosError:vc,spread:yc,toFormData:wc,AxiosHeaders:bc,HttpStatusCode:Sc,formToJSON:Lc,getAdapter:Ec,mergeConfig:xc}=Q,Xt={BASE_URL:"https://story-api.dicoding.dev/v1",ENDPOINTS:{STORIES:"/stories",STORIES_WITH_LOCATION:"/stories?location=1",REGISTER:"/register",LOGIN:"/login",ADD_STORY:"/stories"},DEFAULT_HEADERS:{"Content-Type":"application/json"}},bt={DEFAULT_CENTER:[-6.2,106.816666],DEFAULT_ZOOM:10,TILE_LAYERS:{OPENSTREETMAP:{url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",attribution:"¬© OpenStreetMap contributors",name:"OpenStreetMap"},SATELLITE:{url:"https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",attribution:"¬© Esri",name:"Satellite"},TERRAIN:{url:"https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",attribution:"¬© OpenTopoMap contributors",name:"Terrain"}}};class Il{constructor(){this.api=Q.create({baseURL:Xt.BASE_URL,headers:Xt.DEFAULT_HEADERS,timeout:1e4,validateStatus:function(i){return i<500}}),this.api.interceptors.request.use(i=>{var r;const o=localStorage.getItem("token");return o&&(i.headers.Authorization=`Bearer ${o}`),console.log(`API Request: ${(r=i.method)==null?void 0:r.toUpperCase()} ${i.url}`,i.data),i}),this.api.interceptors.response.use(i=>(console.log(`API Response: ${i.status}`,i.data),i),i=>{var o;return console.error("API Error:",((o=i.response)==null?void 0:o.data)||i.message),Promise.reject(i)})}async getStories(){try{return(await this.api.get(Xt.ENDPOINTS.STORIES)).data}catch(i){throw new Error(`Failed to fetch stories: ${i.message}`)}}async getStoriesWithLocation(){try{return(await this.api.get(Xt.ENDPOINTS.STORIES_WITH_LOCATION)).data}catch(i){throw new Error(`Failed to fetch stories with location: ${i.message}`)}}async addStory(i){try{return(await this.api.post(Xt.ENDPOINTS.ADD_STORY,i,{headers:{"Content-Type":"multipart/form-data"}})).data}catch(o){throw new Error(`Failed to add story: ${o.message}`)}}async register(i){var o,r,c,d;try{console.log("Sending registration data:",i);const h=await this.api.post(Xt.ENDPOINTS.REGISTER,i);return console.log("Registration response:",h.data),h.data}catch(h){console.error("Registration error details:",((o=h.response)==null?void 0:o.data)||h);const p=((c=(r=h.response)==null?void 0:r.data)==null?void 0:c.message)||((d=h.response)==null?void 0:d.statusText)||h.message||"Registration failed";throw new Error(p)}}async login(i){var o,r,c,d,h;try{console.log("Sending login data:",i);const p=await this.api.post(Xt.ENDPOINTS.LOGIN,i);return console.log("Login response:",p.data),(o=p.data.loginResult)!=null&&o.token&&localStorage.setItem("token",p.data.loginResult.token),p.data}catch(p){console.error("Login error details:",((r=p.response)==null?void 0:r.data)||p);const g=((d=(c=p.response)==null?void 0:c.data)==null?void 0:d.message)||((h=p.response)==null?void 0:h.statusText)||p.message||"Login failed";throw new Error(g)}}logout(){localStorage.removeItem("token"),Ne(async()=>{const{AccessibilityUtils:i}=await Promise.resolve().then(()=>ze);return{AccessibilityUtils:i}},void 0).then(({AccessibilityUtils:i})=>{i.announce("Anda telah berhasil logout","polite")}),window.location.hash="#/",window.dispatchEvent(new HashChangeEvent("hashchange"))}isAuthenticated(){return!!localStorage.getItem("token")}}const zt=new Il;class Ol extends jt{constructor(){super(),this.title="Home - App"}async render(){return`
      <div class="container">
  <!-- Hero Section -->
  <section class="hero-section" role="banner">
    <div class="hero-content">
      <h1 class="hero-title">
        üåç Discover Stories From Around the Globe
      </h1>
      <p class="hero-description">
        Dive into unique moments shared by people everywhere. 
        Browse inspiring narratives and explore 
        places through a beautifully designed interactive map.
      </p>
      <div class="hero-actions">
        <a href="#/register" class="btn btn-primary">‚ú® Join and Start Creating</a>
        <a href="#/stories" class="btn btn-outline">üìò Browse Story Collection</a>
      </div>
    </div>
  </section>
</div>


        <!-- Features Section -->
        <section class="features-section" role="region" aria-labelledby="features-title">
          <h2 id="features-title" class="section-title">‚ú® Key Features</h2>

          <article class="feature-card">
  <div class="feature-icon">‚ö°</div>
  <h3 class="feature-title">Fast Performance</h3>
  <p class="feature-description">
    Enjoy a highly optimized experience with quick loading times and efficient data processing across all pages.
  </p>
</article>

<article class="feature-card">
  <div class="feature-icon">üîí</div>
  <h3 class="feature-title">Secure Authentication</h3>
  <p class="feature-description">
    Your data is protected with secure login and authorization features, ensuring safe access to your stories.
  </p>
</article>

<article class="feature-card">
  <div class="feature-icon">‚òÅÔ∏è</div>
  <h3 class="feature-title">Cloud Backup</h3>
  <p class="feature-description">
    All your stories are stored safely in the cloud, allowing you to access them anytime and from any device.
  </p>
</article>
              

        <!-- Stats Section -->
        <section class="stats-section" role="region" aria-labelledby="stats-title">
          <h2 id="stats-title" class="section-title">üìä Platform Statistics</h2>
          
          <div class="stats-grid">
            <div class="stat-item">
              <div class="stat-number" id="story-count">0</div>
              <div class="stat-label">Published Stories</div>
            </div>
            <div class="stat-item">
              <div class="stat-number" id="location-count">0</div>
              <div class="stat-label">Different Locations</div>
            </div>
            <div class="stat-item">
              <div class="stat-number">100%</div>
              <div class="stat-label">Accessibility</div>
            </div>
          </div>
        </section>

        <!-- CTA Section -->
        <section class="cta-section" role="region" aria-labelledby="cta-title">
          <div class="cta-content">
            <h2 id="cta-title">üöÄ Ready to Get Started?</h2>
            <p>Join the storyteller community and share your experiences</p>
            <div class="cta-actions">
              ${zt.isAuthenticated()?`
                <a href="#/add-story" class="btn btn-primary">Add New Story</a>
                <a href="#/stories" class="btn btn-outline">View All Stories</a>
              `:`
                <a href="#/register" class="btn btn-primary">Sign Up Now</a>
                <a href="#/login" class="btn btn-outline">Already Have an Account?</a>
              `}
            </div>
          </div>
        </section>
      </div>
    `}async afterRender(){await super.afterRender(),await this.loadStats(),this.setupAnimations()}async loadStats(){try{const o=await(await fetch("https://story-api.dicoding.dev/v1/stories?size=100")).json();if(o.error===!1&&o.listStory){const r=o.listStory,c=r.length,d=new Set(r.filter(h=>h.lat&&h.lon).map(h=>`${h.lat.toFixed(2)},${h.lon.toFixed(2)}`)).size;this.animateCounter("story-count",c),this.animateCounter("location-count",d)}}catch(i){console.warn("Failed to load stats:",i),document.getElementById("story-count").textContent="50+",document.getElementById("location-count").textContent="25+"}}animateCounter(i,o){const r=document.getElementById(i);if(!r)return;let c=0;const d=Math.ceil(o/30),h=setInterval(()=>{c+=d,c>=o&&(c=o,clearInterval(h)),r.textContent=c.toLocaleString()},50)}setupAnimations(){const i={threshold:.1,rootMargin:"0px 0px -50px 0px"},o=new IntersectionObserver(c=>{c.forEach(d=>{d.isIntersecting&&(d.target.style.opacity="1",d.target.style.transform="translateY(0)")})},i);document.querySelectorAll(".feature-card, .stat-item, .cta-content").forEach((c,d)=>{c.style.opacity="0",c.style.transform="translateY(20px)",c.style.transition=`opacity 0.6s ease ${d*.1}s, transform 0.6s ease ${d*.1}s`,o.observe(c)})}}class Ml extends jt{constructor(){super(),this.title="About ‚Äî App"}async render(){return`
      <div class="container">
        <header class="page-header">
          <h3 class="page-title"> About This Application</h3>
        </header>

        <!-- Basic Info -->
        <section class="card">
          <div class="card-header">
            <h2 class="card-title">üìò Overview</h2>
          </div>
          <div class="card-body">
            <p>
              This web app allows users to post short stories and connect them to specific map locations.
              It was created as part of a learning project using modern web development techniques.
            </p>
            <p>
              The app supports creating stories, viewing them on a map, and browsing user submissions.
            </p>
          </div>
        </section>

        <!-- Main Features -->
        <section class="card">
          <div class="card-header">
            <h2 class="card-title">‚ú® Main Capabilities</h2>
          </div>
          <div class="card-body">
            <ul class="features-list">
              <li>Interactive map with location markers</li>
              <li>Story creation with photo uploads</li>
              <li>Simple single-page navigation</li>
              <li>Responsive layout for all screen sizes</li>
              <li>Support for basic offline usage</li>
            </ul>
          </div>
        </section>

        <!-- Dev Info -->
        <section class="card">
          <div class="card-header">
            <h2 class="card-title">üë®‚Äçüíª Project Details</h2>
          </div>
          <div class="card-body">
            <p><strong>Stack:</strong> JavaScript, HTML, CSS, Web APIs</p>
            <p><strong>Purpose:</strong> Learning and practice</p>
            <p><strong>Developer:</strong> Independent project</p>
          </div>
        </section>

        <!-- Actions -->
        <nav class="about-actions">
          <a href="#/stories" class="btn btn-primary"> View Stories</a>
          <a href="#/add-story" class="btn btn-secondary"> Create Story</a>
          <a href="#/" class="btn btn-outline"> Home</a>
        </nav>
      </div>
    `}async afterRender(){await super.afterRender()}}class Bl extends _i{async handleLogin(i){try{this.showLoading();const o={email:i.get("email"),password:i.get("password")},r=await zt.login(o);this.hideLoading(),r.error===!1?(this.showSuccess("Login successful! Redirecting to the stories page..."),document.dispatchEvent(new CustomEvent("authStateChange")),setTimeout(()=>{window.location.hash="#/stories"},1500)):this.showError(r.message||"Login failed")}catch(o){this.hideLoading(),this.showError("An error occurred: "+o.message)}}}class Rl extends jt{constructor(){super(),this.title="Login ‚Äî APP",this.presenter=new Bl(this)}async render(){return`
      <div class="container">
        <div class="card" style="max-width: 400px; margin: 0 auto;">
          <div class="card-header">
            <h1 class="card-title">Sign In to Your Account</h1>
            <p class="text-light">Please log in to access the APP</p>
          </div>
          
          <form id="login-form" novalidate>
            <div class="form-group">
              <label for="email" class="form-label">Email Address</label>
              <input 
                type="email" 
                id="email" 
                name="email" 
                class="form-input" 
                required 
                aria-describedby="email-error"
                autocomplete="email"
              >
              <div id="email-error" class="form-error" aria-live="polite"></div>
            </div>
            
            <div class="form-group">
              <label for="password" class="form-label">Password</label>
              <input 
                type="password" 
                id="password" 
                name="password"
                class="form-input"
                required
                aria-describedby="password-error"
                autocomplete="current-password"
                minlength="8"
              >
              <div id="password-error" class="form-error" aria-live="polite"></div>
            </div>
            
            <button type="submit" class="btn btn-primary" style="width: 100%;">
              Log In
            </button>
          </form>
          
          <div style="text-align: center; margin-top: 20px;">
            <p>Don't have an account? <a href="#/register">Register here</a></p>
          </div>
        </div>
      </div>
    `}async afterRender(){await super.afterRender();const i=document.getElementById("login-form"),o=document.getElementById("email"),r=document.getElementById("password"),c=()=>{const h=o.value.trim(),p=document.getElementById("email-error");return h?h.includes("@")?(p.textContent="",!0):(p.textContent="Please enter a valid email address",!1):(p.textContent="Email is required",!1)},d=()=>{const h=r.value,p=document.getElementById("password-error");return h?h.length<8?(p.textContent="Password must be at least 8 characters",!1):(p.textContent="",!0):(p.textContent="Password is required",!1)};o.addEventListener("blur",c),r.addEventListener("blur",d),i.addEventListener("submit",h=>{h.preventDefault();const p=c(),g=d();if(p&&g){const w=new FormData(i);this.presenter.handleLogin(w)}})}}class Nl extends _i{async handleRegister(i){var o,r;try{this.showLoading();const c={name:(o=i.get("name"))==null?void 0:o.trim(),email:(r=i.get("email"))==null?void 0:r.trim().toLowerCase(),password:i.get("password")};if(console.log("Form data being sent:",c),!c.name||c.name.length<2){this.hideLoading(),this.showError("Name must be at least 2 characters long");return}if(!c.email||!c.email.includes("@")){this.hideLoading(),this.showError("Invalid email format");return}if(!c.password||c.password.length<8){this.hideLoading(),this.showError("Password must be at least 8 characters long");return}const d=await zt.register(c);this.hideLoading(),console.log("Registration result:",d),d.error===!1?(this.showSuccess("Registration successful! Please log in with your account."),setTimeout(()=>{window.location.hash="#/login"},2e3)):this.showError(d.message||"Registration failed")}catch(c){this.hideLoading(),console.error("Registration error:",c),this.showError("An error occurred: "+c.message)}}}class Dl extends jt{constructor(){super(),this.title="Register - App",this.presenter=new Nl(this)}async render(){return`
      <div class="container">
        <div class="card" style="max-width: 400px; margin: 0 auto;">
          <div class="card-header">
            <h1 class="card-title">Create a New Account</h1>
            <p class="text-light">Register to start sharing your stories</p>
          </div>
          
          <form id="register-form" novalidate>
            <div class="form-group">
              <label for="name" class="form-label">Full Name</label>
              <input 
                type="text" 
                id="name" 
                name="name" 
                class="form-input" 
                required 
                aria-describedby="name-error"
                autocomplete="name"
              >
              <div id="name-error" class="form-error" aria-live="polite"></div>
            </div>
            
            <div class="form-group">
              <label for="email" class="form-label">Email Address</label>
              <input 
                type="email" 
                id="email" 
                name="email" 
                class="form-input" 
                required 
                aria-describedby="email-error"
                autocomplete="email"
              >
              <div id="email-error" class="form-error" aria-live="polite"></div>
            </div>
            
            <div class="form-group">
              <label for="password" class="form-label">Password</label>
              <input 
                type="password" 
                id="password" 
                name="password" 
                class="form-input" 
                required 
                aria-describedby="password-error password-help"
                autocomplete="new-password"
                minlength="8"
              >
              <div id="password-help" class="form-help">At least 8 characters</div>
              <div id="password-error" class="form-error" aria-live="polite"></div>
            </div>
            
            <div class="form-group">
              <label for="confirm-password" class="form-label">Confirm Password</label>
              <input 
                type="password" 
                id="confirm-password" 
                name="confirm-password" 
                class="form-input" 
                required 
                aria-describedby="confirm-password-error"
                autocomplete="new-password"
              >
              <div id="confirm-password-error" class="form-error" aria-live="polite"></div>
            </div>
            
            <button type="submit" class="btn btn-primary" style="width: 100%;">
              Register
            </button>
          </form>
          
          <div style="text-align: center; margin-top: 20px;">
            <p>Already have an account? <a href="#/login">Sign in here</a></p>
          </div>
        </div>
      </div>
    `}async afterRender(){await super.afterRender();const i=document.getElementById("register-form"),o=document.getElementById("name"),r=document.getElementById("email"),c=document.getElementById("password"),d=document.getElementById("confirm-password"),h=()=>{const y=o.value.trim(),b=document.getElementById("name-error");return y?y.length<2?(b.textContent="Name must be at least 2 characters long",!1):(b.textContent="",!0):(b.textContent="Name is required",!1)},p=()=>{const y=r.value.trim(),b=document.getElementById("email-error");return y?y.includes("@")?(b.textContent="",!0):(b.textContent="Invalid email format",!1):(b.textContent="Email is required",!1)},g=()=>{const y=c.value,b=document.getElementById("password-error");return y?y.length<8?(b.textContent="Password must be at least 8 characters long",!1):(b.textContent="",!0):(b.textContent="Password is required",!1)},w=()=>{const y=c.value,b=d.value,I=document.getElementById("confirm-password-error");return b?y!==b?(I.textContent="Passwords do not match",!1):(I.textContent="",!0):(I.textContent="Please confirm your password",!1)};o.addEventListener("blur",h),r.addEventListener("blur",p),c.addEventListener("blur",g),d.addEventListener("blur",w),d.addEventListener("input",w),i.addEventListener("submit",y=>{y.preventDefault();const b=h(),I=p(),$=g(),E=w();if(b&&I&&$&&E){const x=new FormData(i);this.presenter.handleRegister(x)}})}}function zl(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}var De={exports:{}};/* @preserve
 * Leaflet 1.9.4, a JS library for interactive maps. https://leafletjs.com
 * (c) 2010-2023 Vladimir Agafonkin, (c) 2010-2011 CloudMade
 */var Fl=De.exports,Yo;function Zl(){return Yo||(Yo=1,function(a,i){(function(o,r){r(i)})(Fl,function(o){var r="1.9.4";function c(t){var e,n,s,l;for(n=1,s=arguments.length;n<s;n++){l=arguments[n];for(e in l)t[e]=l[e]}return t}var d=Object.create||function(){function t(){}return function(e){return t.prototype=e,new t}}();function h(t,e){var n=Array.prototype.slice;if(t.bind)return t.bind.apply(t,n.call(arguments,1));var s=n.call(arguments,2);return function(){return t.apply(e,s.length?s.concat(n.call(arguments)):arguments)}}var p=0;function g(t){return"_leaflet_id"in t||(t._leaflet_id=++p),t._leaflet_id}function w(t,e,n){var s,l,u,f;return f=function(){s=!1,l&&(u.apply(n,l),l=!1)},u=function(){s?l=arguments:(t.apply(n,arguments),setTimeout(f,e),s=!0)},u}function y(t,e,n){var s=e[1],l=e[0],u=s-l;return t===s&&n?t:((t-l)%u+u)%u+l}function b(){return!1}function I(t,e){if(e===!1)return t;var n=Math.pow(10,e===void 0?6:e);return Math.round(t*n)/n}function $(t){return t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")}function E(t){return $(t).split(/\s+/)}function x(t,e){Object.prototype.hasOwnProperty.call(t,"options")||(t.options=t.options?d(t.options):{});for(var n in e)t.options[n]=e[n];return t.options}function T(t,e,n){var s=[];for(var l in t)s.push(encodeURIComponent(n?l.toUpperCase():l)+"="+encodeURIComponent(t[l]));return(!e||e.indexOf("?")===-1?"?":"&")+s.join("&")}var K=/\{ *([\w_ -]+) *\}/g;function ut(t,e){return t.replace(K,function(n,s){var l=e[s];if(l===void 0)throw new Error("No value provided for variable "+n);return typeof l=="function"&&(l=l(e)),l})}var H=Array.isArray||function(t){return Object.prototype.toString.call(t)==="[object Array]"};function et(t,e){for(var n=0;n<t.length;n++)if(t[n]===e)return n;return-1}var lt="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=";function Lt(t){return window["webkit"+t]||window["moz"+t]||window["ms"+t]}var ht=0;function ne(t){var e=+new Date,n=Math.max(0,16-(e-ht));return ht=e+n,window.setTimeout(t,n)}var Zt=window.requestAnimationFrame||Lt("RequestAnimationFrame")||ne,_e=window.cancelAnimationFrame||Lt("CancelAnimationFrame")||Lt("CancelRequestAnimationFrame")||function(t){window.clearTimeout(t)};function ot(t,e,n){if(n&&Zt===ne)t.call(e);else return Zt.call(window,h(t,e))}function st(t){t&&_e.call(window,t)}var Vt={__proto__:null,extend:c,create:d,bind:h,get lastId(){return p},stamp:g,throttle:w,wrapNum:y,falseFn:b,formatNum:I,trim:$,splitWords:E,setOptions:x,getParamString:T,template:ut,isArray:H,indexOf:et,emptyImageUrl:lt,requestFn:Zt,cancelFn:_e,requestAnimFrame:ot,cancelAnimFrame:st};function rt(){}rt.extend=function(t){var e=function(){x(this),this.initialize&&this.initialize.apply(this,arguments),this.callInitHooks()},n=e.__super__=this.prototype,s=d(n);s.constructor=e,e.prototype=s;for(var l in this)Object.prototype.hasOwnProperty.call(this,l)&&l!=="prototype"&&l!=="__super__"&&(e[l]=this[l]);return t.statics&&c(e,t.statics),t.includes&&(We(t.includes),c.apply(null,[s].concat(t.includes))),c(s,t),delete s.statics,delete s.includes,s.options&&(s.options=n.options?d(n.options):{},c(s.options,t.options)),s._initHooks=[],s.callInitHooks=function(){if(!this._initHooksCalled){n.callInitHooks&&n.callInitHooks.call(this),this._initHooksCalled=!0;for(var u=0,f=s._initHooks.length;u<f;u++)s._initHooks[u].call(this)}},e},rt.include=function(t){var e=this.prototype.options;return c(this.prototype,t),t.options&&(this.prototype.options=e,this.mergeOptions(t.options)),this},rt.mergeOptions=function(t){return c(this.prototype.options,t),this},rt.addInitHook=function(t){var e=Array.prototype.slice.call(arguments,1),n=typeof t=="function"?t:function(){this[t].apply(this,e)};return this.prototype._initHooks=this.prototype._initHooks||[],this.prototype._initHooks.push(n),this};function We(t){if(!(typeof L>"u"||!L||!L.Mixin)){t=H(t)?t:[t];for(var e=0;e<t.length;e++)t[e]===L.Mixin.Events&&console.warn("Deprecated include of L.Mixin.Events: this property will be removed in future releases, please inherit from L.Evented instead.",new Error().stack)}}var j={on:function(t,e,n){if(typeof t=="object")for(var s in t)this._on(s,t[s],e);else{t=E(t);for(var l=0,u=t.length;l<u;l++)this._on(t[l],e,n)}return this},off:function(t,e,n){if(!arguments.length)delete this._events;else if(typeof t=="object")for(var s in t)this._off(s,t[s],e);else{t=E(t);for(var l=arguments.length===1,u=0,f=t.length;u<f;u++)l?this._off(t[u]):this._off(t[u],e,n)}return this},_on:function(t,e,n,s){if(typeof e!="function"){console.warn("wrong listener type: "+typeof e);return}if(this._listens(t,e,n)===!1){n===this&&(n=void 0);var l={fn:e,ctx:n};s&&(l.once=!0),this._events=this._events||{},this._events[t]=this._events[t]||[],this._events[t].push(l)}},_off:function(t,e,n){var s,l,u;if(this._events&&(s=this._events[t],!!s)){if(arguments.length===1){if(this._firingCount)for(l=0,u=s.length;l<u;l++)s[l].fn=b;delete this._events[t];return}if(typeof e!="function"){console.warn("wrong listener type: "+typeof e);return}var f=this._listens(t,e,n);if(f!==!1){var m=s[f];this._firingCount&&(m.fn=b,this._events[t]=s=s.slice()),s.splice(f,1)}}},fire:function(t,e,n){if(!this.listens(t,n))return this;var s=c({},e,{type:t,target:this,sourceTarget:e&&e.sourceTarget||this});if(this._events){var l=this._events[t];if(l){this._firingCount=this._firingCount+1||1;for(var u=0,f=l.length;u<f;u++){var m=l[u],_=m.fn;m.once&&this.off(t,_,m.ctx),_.call(m.ctx||this,s)}this._firingCount--}}return n&&this._propagateEvent(s),this},listens:function(t,e,n,s){typeof t!="string"&&console.warn('"string" type argument expected');var l=e;typeof e!="function"&&(s=!!e,l=void 0,n=void 0);var u=this._events&&this._events[t];if(u&&u.length&&this._listens(t,l,n)!==!1)return!0;if(s){for(var f in this._eventParents)if(this._eventParents[f].listens(t,e,n,s))return!0}return!1},_listens:function(t,e,n){if(!this._events)return!1;var s=this._events[t]||[];if(!e)return!!s.length;n===this&&(n=void 0);for(var l=0,u=s.length;l<u;l++)if(s[l].fn===e&&s[l].ctx===n)return l;return!1},once:function(t,e,n){if(typeof t=="object")for(var s in t)this._on(s,t[s],e,!0);else{t=E(t);for(var l=0,u=t.length;l<u;l++)this._on(t[l],e,n,!0)}return this},addEventParent:function(t){return this._eventParents=this._eventParents||{},this._eventParents[g(t)]=t,this},removeEventParent:function(t){return this._eventParents&&delete this._eventParents[g(t)],this},_propagateEvent:function(t){for(var e in this._eventParents)this._eventParents[e].fire(t.type,c({layer:t.target,propagatedFrom:t.target},t),!0)}};j.addEventListener=j.on,j.removeEventListener=j.clearAllEventListeners=j.off,j.addOneTimeEventListener=j.once,j.fireEvent=j.fire,j.hasEventListeners=j.listens;var Ut=rt.extend(j);function C(t,e,n){this.x=n?Math.round(t):t,this.y=n?Math.round(e):e}var ve=Math.trunc||function(t){return t>0?Math.floor(t):Math.ceil(t)};C.prototype={clone:function(){return new C(this.x,this.y)},add:function(t){return this.clone()._add(O(t))},_add:function(t){return this.x+=t.x,this.y+=t.y,this},subtract:function(t){return this.clone()._subtract(O(t))},_subtract:function(t){return this.x-=t.x,this.y-=t.y,this},divideBy:function(t){return this.clone()._divideBy(t)},_divideBy:function(t){return this.x/=t,this.y/=t,this},multiplyBy:function(t){return this.clone()._multiplyBy(t)},_multiplyBy:function(t){return this.x*=t,this.y*=t,this},scaleBy:function(t){return new C(this.x*t.x,this.y*t.y)},unscaleBy:function(t){return new C(this.x/t.x,this.y/t.y)},round:function(){return this.clone()._round()},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},floor:function(){return this.clone()._floor()},_floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.clone()._ceil()},_ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},trunc:function(){return this.clone()._trunc()},_trunc:function(){return this.x=ve(this.x),this.y=ve(this.y),this},distanceTo:function(t){t=O(t);var e=t.x-this.x,n=t.y-this.y;return Math.sqrt(e*e+n*n)},equals:function(t){return t=O(t),t.x===this.x&&t.y===this.y},contains:function(t){return t=O(t),Math.abs(t.x)<=Math.abs(this.x)&&Math.abs(t.y)<=Math.abs(this.y)},toString:function(){return"Point("+I(this.x)+", "+I(this.y)+")"}};function O(t,e,n){return t instanceof C?t:H(t)?new C(t[0],t[1]):t==null?t:typeof t=="object"&&"x"in t&&"y"in t?new C(t.x,t.y):new C(t,e,n)}function F(t,e){if(t)for(var n=e?[t,e]:t,s=0,l=n.length;s<l;s++)this.extend(n[s])}F.prototype={extend:function(t){var e,n;if(!t)return this;if(t instanceof C||typeof t[0]=="number"||"x"in t)e=n=O(t);else if(t=J(t),e=t.min,n=t.max,!e||!n)return this;return!this.min&&!this.max?(this.min=e.clone(),this.max=n.clone()):(this.min.x=Math.min(e.x,this.min.x),this.max.x=Math.max(n.x,this.max.x),this.min.y=Math.min(e.y,this.min.y),this.max.y=Math.max(n.y,this.max.y)),this},getCenter:function(t){return O((this.min.x+this.max.x)/2,(this.min.y+this.max.y)/2,t)},getBottomLeft:function(){return O(this.min.x,this.max.y)},getTopRight:function(){return O(this.max.x,this.min.y)},getTopLeft:function(){return this.min},getBottomRight:function(){return this.max},getSize:function(){return this.max.subtract(this.min)},contains:function(t){var e,n;return typeof t[0]=="number"||t instanceof C?t=O(t):t=J(t),t instanceof F?(e=t.min,n=t.max):e=n=t,e.x>=this.min.x&&n.x<=this.max.x&&e.y>=this.min.y&&n.y<=this.max.y},intersects:function(t){t=J(t);var e=this.min,n=this.max,s=t.min,l=t.max,u=l.x>=e.x&&s.x<=n.x,f=l.y>=e.y&&s.y<=n.y;return u&&f},overlaps:function(t){t=J(t);var e=this.min,n=this.max,s=t.min,l=t.max,u=l.x>e.x&&s.x<n.x,f=l.y>e.y&&s.y<n.y;return u&&f},isValid:function(){return!!(this.min&&this.max)},pad:function(t){var e=this.min,n=this.max,s=Math.abs(e.x-n.x)*t,l=Math.abs(e.y-n.y)*t;return J(O(e.x-s,e.y-l),O(n.x+s,n.y+l))},equals:function(t){return t?(t=J(t),this.min.equals(t.getTopLeft())&&this.max.equals(t.getBottomRight())):!1}};function J(t,e){return!t||t instanceof F?t:new F(t,e)}function it(t,e){if(t)for(var n=e?[t,e]:t,s=0,l=n.length;s<l;s++)this.extend(n[s])}it.prototype={extend:function(t){var e=this._southWest,n=this._northEast,s,l;if(t instanceof U)s=t,l=t;else if(t instanceof it){if(s=t._southWest,l=t._northEast,!s||!l)return this}else return t?this.extend(D(t)||W(t)):this;return!e&&!n?(this._southWest=new U(s.lat,s.lng),this._northEast=new U(l.lat,l.lng)):(e.lat=Math.min(s.lat,e.lat),e.lng=Math.min(s.lng,e.lng),n.lat=Math.max(l.lat,n.lat),n.lng=Math.max(l.lng,n.lng)),this},pad:function(t){var e=this._southWest,n=this._northEast,s=Math.abs(e.lat-n.lat)*t,l=Math.abs(e.lng-n.lng)*t;return new it(new U(e.lat-s,e.lng-l),new U(n.lat+s,n.lng+l))},getCenter:function(){return new U((this._southWest.lat+this._northEast.lat)/2,(this._southWest.lng+this._northEast.lng)/2)},getSouthWest:function(){return this._southWest},getNorthEast:function(){return this._northEast},getNorthWest:function(){return new U(this.getNorth(),this.getWest())},getSouthEast:function(){return new U(this.getSouth(),this.getEast())},getWest:function(){return this._southWest.lng},getSouth:function(){return this._southWest.lat},getEast:function(){return this._northEast.lng},getNorth:function(){return this._northEast.lat},contains:function(t){typeof t[0]=="number"||t instanceof U||"lat"in t?t=D(t):t=W(t);var e=this._southWest,n=this._northEast,s,l;return t instanceof it?(s=t.getSouthWest(),l=t.getNorthEast()):s=l=t,s.lat>=e.lat&&l.lat<=n.lat&&s.lng>=e.lng&&l.lng<=n.lng},intersects:function(t){t=W(t);var e=this._southWest,n=this._northEast,s=t.getSouthWest(),l=t.getNorthEast(),u=l.lat>=e.lat&&s.lat<=n.lat,f=l.lng>=e.lng&&s.lng<=n.lng;return u&&f},overlaps:function(t){t=W(t);var e=this._southWest,n=this._northEast,s=t.getSouthWest(),l=t.getNorthEast(),u=l.lat>e.lat&&s.lat<n.lat,f=l.lng>e.lng&&s.lng<n.lng;return u&&f},toBBoxString:function(){return[this.getWest(),this.getSouth(),this.getEast(),this.getNorth()].join(",")},equals:function(t,e){return t?(t=W(t),this._southWest.equals(t.getSouthWest(),e)&&this._northEast.equals(t.getNorthEast(),e)):!1},isValid:function(){return!!(this._southWest&&this._northEast)}};function W(t,e){return t instanceof it?t:new it(t,e)}function U(t,e,n){if(isNaN(t)||isNaN(e))throw new Error("Invalid LatLng object: ("+t+", "+e+")");this.lat=+t,this.lng=+e,n!==void 0&&(this.alt=+n)}U.prototype={equals:function(t,e){if(!t)return!1;t=D(t);var n=Math.max(Math.abs(this.lat-t.lat),Math.abs(this.lng-t.lng));return n<=(e===void 0?1e-9:e)},toString:function(t){return"LatLng("+I(this.lat,t)+", "+I(this.lng,t)+")"},distanceTo:function(t){return Ht.distance(this,D(t))},wrap:function(){return Ht.wrapLatLng(this)},toBounds:function(t){var e=180*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return W([this.lat-e,this.lng-n],[this.lat+e,this.lng+n])},clone:function(){return new U(this.lat,this.lng,this.alt)}};function D(t,e,n){return t instanceof U?t:H(t)&&typeof t[0]!="object"?t.length===3?new U(t[0],t[1],t[2]):t.length===2?new U(t[0],t[1]):null:t==null?t:typeof t=="object"&&"lat"in t?new U(t.lat,"lng"in t?t.lng:t.lon,t.alt):e===void 0?null:new U(t,e,n)}var Ot={latLngToPoint:function(t,e){var n=this.projection.project(t),s=this.scale(e);return this.transformation._transform(n,s)},pointToLatLng:function(t,e){var n=this.scale(e),s=this.transformation.untransform(t,n);return this.projection.unproject(s)},project:function(t){return this.projection.project(t)},unproject:function(t){return this.projection.unproject(t)},scale:function(t){return 256*Math.pow(2,t)},zoom:function(t){return Math.log(t/256)/Math.LN2},getProjectedBounds:function(t){if(this.infinite)return null;var e=this.projection.bounds,n=this.scale(t),s=this.transformation.transform(e.min,n),l=this.transformation.transform(e.max,n);return new F(s,l)},infinite:!1,wrapLatLng:function(t){var e=this.wrapLng?y(t.lng,this.wrapLng,!0):t.lng,n=this.wrapLat?y(t.lat,this.wrapLat,!0):t.lat,s=t.alt;return new U(n,e,s)},wrapLatLngBounds:function(t){var e=t.getCenter(),n=this.wrapLatLng(e),s=e.lat-n.lat,l=e.lng-n.lng;if(s===0&&l===0)return t;var u=t.getSouthWest(),f=t.getNorthEast(),m=new U(u.lat-s,u.lng-l),_=new U(f.lat-s,f.lng-l);return new it(m,_)}},Ht=c({},Ot,{wrapLng:[-180,180],R:6371e3,distance:function(t,e){var n=Math.PI/180,s=t.lat*n,l=e.lat*n,u=Math.sin((e.lat-t.lat)*n/2),f=Math.sin((e.lng-t.lng)*n/2),m=u*u+Math.cos(s)*Math.cos(l)*f*f,_=2*Math.atan2(Math.sqrt(m),Math.sqrt(1-m));return this.R*_}}),Sn=6378137,Li={R:Sn,MAX_LATITUDE:85.0511287798,project:function(t){var e=Math.PI/180,n=this.MAX_LATITUDE,s=Math.max(Math.min(n,t.lat),-n),l=Math.sin(s*e);return new C(this.R*t.lng*e,this.R*Math.log((1+l)/(1-l))/2)},unproject:function(t){var e=180/Math.PI;return new U((2*Math.atan(Math.exp(t.y/this.R))-Math.PI/2)*e,t.x*e/this.R)},bounds:function(){var t=Sn*Math.PI;return new F([-t,-t],[t,t])}()};function Ei(t,e,n,s){if(H(t)){this._a=t[0],this._b=t[1],this._c=t[2],this._d=t[3];return}this._a=t,this._b=e,this._c=n,this._d=s}Ei.prototype={transform:function(t,e){return this._transform(t.clone(),e)},_transform:function(t,e){return e=e||1,t.x=e*(this._a*t.x+this._b),t.y=e*(this._c*t.y+this._d),t},untransform:function(t,e){return e=e||1,new C((t.x/e-this._b)/this._a,(t.y/e-this._d)/this._c)}};function ye(t,e,n,s){return new Ei(t,e,n,s)}var xi=c({},Ht,{code:"EPSG:3857",projection:Li,transformation:function(){var t=.5/(Math.PI*Li.R);return ye(t,.5,-t,.5)}()}),ks=c({},xi,{code:"EPSG:900913"});function Ln(t){return document.createElementNS("http://www.w3.org/2000/svg",t)}function En(t,e){var n="",s,l,u,f,m,_;for(s=0,u=t.length;s<u;s++){for(m=t[s],l=0,f=m.length;l<f;l++)_=m[l],n+=(l?"L":"M")+_.x+" "+_.y;n+=e?A.svg?"z":"x":""}return n||"M0 0"}var Pi=document.documentElement.style,$e="ActiveXObject"in window,Is=$e&&!document.addEventListener,xn="msLaunchUri"in navigator&&!("documentMode"in document),Ti=Tt("webkit"),Pn=Tt("android"),Tn=Tt("android 2")||Tt("android 3"),Os=parseInt(/WebKit\/([0-9]+)|$/.exec(navigator.userAgent)[1],10),Ms=Pn&&Tt("Google")&&Os<537&&!("AudioNode"in window),Ai=!!window.opera,An=!xn&&Tt("chrome"),Cn=Tt("gecko")&&!Ti&&!Ai&&!$e,Bs=!An&&Tt("safari"),kn=Tt("phantom"),In="OTransition"in Pi,Rs=navigator.platform.indexOf("Win")===0,On=$e&&"transition"in Pi,Ci="WebKitCSSMatrix"in window&&"m11"in new window.WebKitCSSMatrix&&!Tn,Mn="MozPerspective"in Pi,Ns=!window.L_DISABLE_3D&&(On||Ci||Mn)&&!In&&!kn,we=typeof orientation<"u"||Tt("mobile"),Ds=we&&Ti,zs=we&&Ci,Bn=!window.PointerEvent&&window.MSPointerEvent,Rn=!!(window.PointerEvent||Bn),Nn="ontouchstart"in window||!!window.TouchEvent,Fs=!window.L_NO_TOUCH&&(Nn||Rn),Zs=we&&Ai,Us=we&&Cn,Hs=(window.devicePixelRatio||window.screen.deviceXDPI/window.screen.logicalXDPI)>1,qs=function(){var t=!1;try{var e=Object.defineProperty({},"passive",{get:function(){t=!0}});window.addEventListener("testPassiveEventSupport",b,e),window.removeEventListener("testPassiveEventSupport",b,e)}catch{}return t}(),Ws=function(){return!!document.createElement("canvas").getContext}(),ki=!!(document.createElementNS&&Ln("svg").createSVGRect),$s=!!ki&&function(){var t=document.createElement("div");return t.innerHTML="<svg/>",(t.firstChild&&t.firstChild.namespaceURI)==="http://www.w3.org/2000/svg"}(),js=!ki&&function(){try{var t=document.createElement("div");t.innerHTML='<v:shape adj="1"/>';var e=t.firstChild;return e.style.behavior="url(#default#VML)",e&&typeof e.adj=="object"}catch{return!1}}(),Vs=navigator.platform.indexOf("Mac")===0,Gs=navigator.platform.indexOf("Linux")===0;function Tt(t){return navigator.userAgent.toLowerCase().indexOf(t)>=0}var A={ie:$e,ielt9:Is,edge:xn,webkit:Ti,android:Pn,android23:Tn,androidStock:Ms,opera:Ai,chrome:An,gecko:Cn,safari:Bs,phantom:kn,opera12:In,win:Rs,ie3d:On,webkit3d:Ci,gecko3d:Mn,any3d:Ns,mobile:we,mobileWebkit:Ds,mobileWebkit3d:zs,msPointer:Bn,pointer:Rn,touch:Fs,touchNative:Nn,mobileOpera:Zs,mobileGecko:Us,retina:Hs,passiveEvents:qs,canvas:Ws,svg:ki,vml:js,inlineSvg:$s,mac:Vs,linux:Gs},Dn=A.msPointer?"MSPointerDown":"pointerdown",zn=A.msPointer?"MSPointerMove":"pointermove",Fn=A.msPointer?"MSPointerUp":"pointerup",Zn=A.msPointer?"MSPointerCancel":"pointercancel",Ii={touchstart:Dn,touchmove:zn,touchend:Fn,touchcancel:Zn},Un={touchstart:tr,touchmove:je,touchend:je,touchcancel:je},oe={},Hn=!1;function Ks(t,e,n){return e==="touchstart"&&Xs(),Un[e]?(n=Un[e].bind(this,n),t.addEventListener(Ii[e],n,!1),n):(console.warn("wrong event specified:",e),b)}function Js(t,e,n){if(!Ii[e]){console.warn("wrong event specified:",e);return}t.removeEventListener(Ii[e],n,!1)}function Ys(t){oe[t.pointerId]=t}function Qs(t){oe[t.pointerId]&&(oe[t.pointerId]=t)}function qn(t){delete oe[t.pointerId]}function Xs(){Hn||(document.addEventListener(Dn,Ys,!0),document.addEventListener(zn,Qs,!0),document.addEventListener(Fn,qn,!0),document.addEventListener(Zn,qn,!0),Hn=!0)}function je(t,e){if(e.pointerType!==(e.MSPOINTER_TYPE_MOUSE||"mouse")){e.touches=[];for(var n in oe)e.touches.push(oe[n]);e.changedTouches=[e],t(e)}}function tr(t,e){e.MSPOINTER_TYPE_TOUCH&&e.pointerType===e.MSPOINTER_TYPE_TOUCH&&at(e),je(t,e)}function er(t){var e={},n,s;for(s in t)n=t[s],e[s]=n&&n.bind?n.bind(t):n;return t=e,e.type="dblclick",e.detail=2,e.isTrusted=!1,e._simulated=!0,e}var ir=200;function nr(t,e){t.addEventListener("dblclick",e);var n=0,s;function l(u){if(u.detail!==1){s=u.detail;return}if(!(u.pointerType==="mouse"||u.sourceCapabilities&&!u.sourceCapabilities.firesTouchEvents)){var f=Gn(u);if(!(f.some(function(_){return _ instanceof HTMLLabelElement&&_.attributes.for})&&!f.some(function(_){return _ instanceof HTMLInputElement||_ instanceof HTMLSelectElement}))){var m=Date.now();m-n<=ir?(s++,s===2&&e(er(u))):s=1,n=m}}}return t.addEventListener("click",l),{dblclick:e,simDblclick:l}}function or(t,e){t.removeEventListener("dblclick",e.dblclick),t.removeEventListener("click",e.simDblclick)}var Oi=Ke(["transform","webkitTransform","OTransform","MozTransform","msTransform"]),be=Ke(["webkitTransition","transition","OTransition","MozTransition","msTransition"]),Wn=be==="webkitTransition"||be==="OTransition"?be+"End":"transitionend";function $n(t){return typeof t=="string"?document.getElementById(t):t}function Se(t,e){var n=t.style[e]||t.currentStyle&&t.currentStyle[e];if((!n||n==="auto")&&document.defaultView){var s=document.defaultView.getComputedStyle(t,null);n=s?s[e]:null}return n==="auto"?null:n}function Z(t,e,n){var s=document.createElement(t);return s.className=e||"",n&&n.appendChild(s),s}function G(t){var e=t.parentNode;e&&e.removeChild(t)}function Ve(t){for(;t.firstChild;)t.removeChild(t.firstChild)}function se(t){var e=t.parentNode;e&&e.lastChild!==t&&e.appendChild(t)}function re(t){var e=t.parentNode;e&&e.firstChild!==t&&e.insertBefore(t,e.firstChild)}function Mi(t,e){if(t.classList!==void 0)return t.classList.contains(e);var n=Ge(t);return n.length>0&&new RegExp("(^|\\s)"+e+"(\\s|$)").test(n)}function R(t,e){if(t.classList!==void 0)for(var n=E(e),s=0,l=n.length;s<l;s++)t.classList.add(n[s]);else if(!Mi(t,e)){var u=Ge(t);Bi(t,(u?u+" ":"")+e)}}function Y(t,e){t.classList!==void 0?t.classList.remove(e):Bi(t,$((" "+Ge(t)+" ").replace(" "+e+" "," ")))}function Bi(t,e){t.className.baseVal===void 0?t.className=e:t.className.baseVal=e}function Ge(t){return t.correspondingElement&&(t=t.correspondingElement),t.className.baseVal===void 0?t.className:t.className.baseVal}function vt(t,e){"opacity"in t.style?t.style.opacity=e:"filter"in t.style&&sr(t,e)}function sr(t,e){var n=!1,s="DXImageTransform.Microsoft.Alpha";try{n=t.filters.item(s)}catch{if(e===1)return}e=Math.round(e*100),n?(n.Enabled=e!==100,n.Opacity=e):t.style.filter+=" progid:"+s+"(opacity="+e+")"}function Ke(t){for(var e=document.documentElement.style,n=0;n<t.length;n++)if(t[n]in e)return t[n];return!1}function Gt(t,e,n){var s=e||new C(0,0);t.style[Oi]=(A.ie3d?"translate("+s.x+"px,"+s.y+"px)":"translate3d("+s.x+"px,"+s.y+"px,0)")+(n?" scale("+n+")":"")}function X(t,e){t._leaflet_pos=e,A.any3d?Gt(t,e):(t.style.left=e.x+"px",t.style.top=e.y+"px")}function Kt(t){return t._leaflet_pos||new C(0,0)}var Le,Ee,Ri;if("onselectstart"in document)Le=function(){M(window,"selectstart",at)},Ee=function(){q(window,"selectstart",at)};else{var xe=Ke(["userSelect","WebkitUserSelect","OUserSelect","MozUserSelect","msUserSelect"]);Le=function(){if(xe){var t=document.documentElement.style;Ri=t[xe],t[xe]="none"}},Ee=function(){xe&&(document.documentElement.style[xe]=Ri,Ri=void 0)}}function Ni(){M(window,"dragstart",at)}function Di(){q(window,"dragstart",at)}var Je,zi;function Fi(t){for(;t.tabIndex===-1;)t=t.parentNode;t.style&&(Ye(),Je=t,zi=t.style.outlineStyle,t.style.outlineStyle="none",M(window,"keydown",Ye))}function Ye(){Je&&(Je.style.outlineStyle=zi,Je=void 0,zi=void 0,q(window,"keydown",Ye))}function jn(t){do t=t.parentNode;while((!t.offsetWidth||!t.offsetHeight)&&t!==document.body);return t}function Zi(t){var e=t.getBoundingClientRect();return{x:e.width/t.offsetWidth||1,y:e.height/t.offsetHeight||1,boundingClientRect:e}}var rr={__proto__:null,TRANSFORM:Oi,TRANSITION:be,TRANSITION_END:Wn,get:$n,getStyle:Se,create:Z,remove:G,empty:Ve,toFront:se,toBack:re,hasClass:Mi,addClass:R,removeClass:Y,setClass:Bi,getClass:Ge,setOpacity:vt,testProp:Ke,setTransform:Gt,setPosition:X,getPosition:Kt,get disableTextSelection(){return Le},get enableTextSelection(){return Ee},disableImageDrag:Ni,enableImageDrag:Di,preventOutline:Fi,restoreOutline:Ye,getSizedParentNode:jn,getScale:Zi};function M(t,e,n,s){if(e&&typeof e=="object")for(var l in e)Hi(t,l,e[l],n);else{e=E(e);for(var u=0,f=e.length;u<f;u++)Hi(t,e[u],n,s)}return this}var At="_leaflet_events";function q(t,e,n,s){if(arguments.length===1)Vn(t),delete t[At];else if(e&&typeof e=="object")for(var l in e)qi(t,l,e[l],n);else if(e=E(e),arguments.length===2)Vn(t,function(m){return et(e,m)!==-1});else for(var u=0,f=e.length;u<f;u++)qi(t,e[u],n,s);return this}function Vn(t,e){for(var n in t[At]){var s=n.split(/\d/)[0];(!e||e(s))&&qi(t,s,null,null,n)}}var Ui={mouseenter:"mouseover",mouseleave:"mouseout",wheel:!("onwheel"in window)&&"mousewheel"};function Hi(t,e,n,s){var l=e+g(n)+(s?"_"+g(s):"");if(t[At]&&t[At][l])return this;var u=function(m){return n.call(s||t,m||window.event)},f=u;!A.touchNative&&A.pointer&&e.indexOf("touch")===0?u=Ks(t,e,u):A.touch&&e==="dblclick"?u=nr(t,u):"addEventListener"in t?e==="touchstart"||e==="touchmove"||e==="wheel"||e==="mousewheel"?t.addEventListener(Ui[e]||e,u,A.passiveEvents?{passive:!1}:!1):e==="mouseenter"||e==="mouseleave"?(u=function(m){m=m||window.event,$i(t,m)&&f(m)},t.addEventListener(Ui[e],u,!1)):t.addEventListener(e,f,!1):t.attachEvent("on"+e,u),t[At]=t[At]||{},t[At][l]=u}function qi(t,e,n,s,l){l=l||e+g(n)+(s?"_"+g(s):"");var u=t[At]&&t[At][l];if(!u)return this;!A.touchNative&&A.pointer&&e.indexOf("touch")===0?Js(t,e,u):A.touch&&e==="dblclick"?or(t,u):"removeEventListener"in t?t.removeEventListener(Ui[e]||e,u,!1):t.detachEvent("on"+e,u),t[At][l]=null}function Jt(t){return t.stopPropagation?t.stopPropagation():t.originalEvent?t.originalEvent._stopped=!0:t.cancelBubble=!0,this}function Wi(t){return Hi(t,"wheel",Jt),this}function Pe(t){return M(t,"mousedown touchstart dblclick contextmenu",Jt),t._leaflet_disable_click=!0,this}function at(t){return t.preventDefault?t.preventDefault():t.returnValue=!1,this}function Yt(t){return at(t),Jt(t),this}function Gn(t){if(t.composedPath)return t.composedPath();for(var e=[],n=t.target;n;)e.push(n),n=n.parentNode;return e}function Kn(t,e){if(!e)return new C(t.clientX,t.clientY);var n=Zi(e),s=n.boundingClientRect;return new C((t.clientX-s.left)/n.x-e.clientLeft,(t.clientY-s.top)/n.y-e.clientTop)}var ar=A.linux&&A.chrome?window.devicePixelRatio:A.mac?window.devicePixelRatio*3:window.devicePixelRatio>0?2*window.devicePixelRatio:1;function Jn(t){return A.edge?t.wheelDeltaY/2:t.deltaY&&t.deltaMode===0?-t.deltaY/ar:t.deltaY&&t.deltaMode===1?-t.deltaY*20:t.deltaY&&t.deltaMode===2?-t.deltaY*60:t.deltaX||t.deltaZ?0:t.wheelDelta?(t.wheelDeltaY||t.wheelDelta)/2:t.detail&&Math.abs(t.detail)<32765?-t.detail*20:t.detail?t.detail/-32765*60:0}function $i(t,e){var n=e.relatedTarget;if(!n)return!0;try{for(;n&&n!==t;)n=n.parentNode}catch{return!1}return n!==t}var lr={__proto__:null,on:M,off:q,stopPropagation:Jt,disableScrollPropagation:Wi,disableClickPropagation:Pe,preventDefault:at,stop:Yt,getPropagationPath:Gn,getMousePosition:Kn,getWheelDelta:Jn,isExternalTarget:$i,addListener:M,removeListener:q},Yn=Ut.extend({run:function(t,e,n,s){this.stop(),this._el=t,this._inProgress=!0,this._duration=n||.25,this._easeOutPower=1/Math.max(s||.5,.2),this._startPos=Kt(t),this._offset=e.subtract(this._startPos),this._startTime=+new Date,this.fire("start"),this._animate()},stop:function(){this._inProgress&&(this._step(!0),this._complete())},_animate:function(){this._animId=ot(this._animate,this),this._step()},_step:function(t){var e=+new Date-this._startTime,n=this._duration*1e3;e<n?this._runFrame(this._easeOut(e/n),t):(this._runFrame(1),this._complete())},_runFrame:function(t,e){var n=this._startPos.add(this._offset.multiplyBy(t));e&&n._round(),X(this._el,n),this.fire("step")},_complete:function(){st(this._animId),this._inProgress=!1,this.fire("end")},_easeOut:function(t){return 1-Math.pow(1-t,this._easeOutPower)}}),z=Ut.extend({options:{crs:xi,center:void 0,zoom:void 0,minZoom:void 0,maxZoom:void 0,layers:[],maxBounds:void 0,renderer:void 0,zoomAnimation:!0,zoomAnimationThreshold:4,fadeAnimation:!0,markerZoomAnimation:!0,transform3DLimit:8388608,zoomSnap:1,zoomDelta:1,trackResize:!0},initialize:function(t,e){e=x(this,e),this._handlers=[],this._layers={},this._zoomBoundLayers={},this._sizeChanged=!0,this._initContainer(t),this._initLayout(),this._onResize=h(this._onResize,this),this._initEvents(),e.maxBounds&&this.setMaxBounds(e.maxBounds),e.zoom!==void 0&&(this._zoom=this._limitZoom(e.zoom)),e.center&&e.zoom!==void 0&&this.setView(D(e.center),e.zoom,{reset:!0}),this.callInitHooks(),this._zoomAnimated=be&&A.any3d&&!A.mobileOpera&&this.options.zoomAnimation,this._zoomAnimated&&(this._createAnimProxy(),M(this._proxy,Wn,this._catchTransitionEnd,this)),this._addLayers(this.options.layers)},setView:function(t,e,n){if(e=e===void 0?this._zoom:this._limitZoom(e),t=this._limitCenter(D(t),e,this.options.maxBounds),n=n||{},this._stop(),this._loaded&&!n.reset&&n!==!0){n.animate!==void 0&&(n.zoom=c({animate:n.animate},n.zoom),n.pan=c({animate:n.animate,duration:n.duration},n.pan));var s=this._zoom!==e?this._tryAnimatedZoom&&this._tryAnimatedZoom(t,e,n.zoom):this._tryAnimatedPan(t,n.pan);if(s)return clearTimeout(this._sizeTimer),this}return this._resetView(t,e,n.pan&&n.pan.noMoveStart),this},setZoom:function(t,e){return this._loaded?this.setView(this.getCenter(),t,{zoom:e}):(this._zoom=t,this)},zoomIn:function(t,e){return t=t||(A.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom+t,e)},zoomOut:function(t,e){return t=t||(A.any3d?this.options.zoomDelta:1),this.setZoom(this._zoom-t,e)},setZoomAround:function(t,e,n){var s=this.getZoomScale(e),l=this.getSize().divideBy(2),u=t instanceof C?t:this.latLngToContainerPoint(t),f=u.subtract(l).multiplyBy(1-1/s),m=this.containerPointToLatLng(l.add(f));return this.setView(m,e,{zoom:n})},_getBoundsCenterZoom:function(t,e){e=e||{},t=t.getBounds?t.getBounds():W(t);var n=O(e.paddingTopLeft||e.padding||[0,0]),s=O(e.paddingBottomRight||e.padding||[0,0]),l=this.getBoundsZoom(t,!1,n.add(s));if(l=typeof e.maxZoom=="number"?Math.min(e.maxZoom,l):l,l===1/0)return{center:t.getCenter(),zoom:l};var u=s.subtract(n).divideBy(2),f=this.project(t.getSouthWest(),l),m=this.project(t.getNorthEast(),l),_=this.unproject(f.add(m).divideBy(2).add(u),l);return{center:_,zoom:l}},fitBounds:function(t,e){if(t=W(t),!t.isValid())throw new Error("Bounds are not valid.");var n=this._getBoundsCenterZoom(t,e);return this.setView(n.center,n.zoom,e)},fitWorld:function(t){return this.fitBounds([[-90,-180],[90,180]],t)},panTo:function(t,e){return this.setView(t,this._zoom,{pan:e})},panBy:function(t,e){if(t=O(t).round(),e=e||{},!t.x&&!t.y)return this.fire("moveend");if(e.animate!==!0&&!this.getSize().contains(t))return this._resetView(this.unproject(this.project(this.getCenter()).add(t)),this.getZoom()),this;if(this._panAnim||(this._panAnim=new Yn,this._panAnim.on({step:this._onPanTransitionStep,end:this._onPanTransitionEnd},this)),e.noMoveStart||this.fire("movestart"),e.animate!==!1){R(this._mapPane,"leaflet-pan-anim");var n=this._getMapPanePos().subtract(t).round();this._panAnim.run(this._mapPane,n,e.duration||.25,e.easeLinearity)}else this._rawPanBy(t),this.fire("move").fire("moveend");return this},flyTo:function(t,e,n){if(n=n||{},n.animate===!1||!A.any3d)return this.setView(t,e,n);this._stop();var s=this.project(this.getCenter()),l=this.project(t),u=this.getSize(),f=this._zoom;t=D(t),e=e===void 0?f:e;var m=Math.max(u.x,u.y),_=m*this.getZoomScale(f,e),S=l.distanceTo(s)||1,P=1.42,k=P*P;function N(tt){var ci=tt?-1:1,Jr=tt?_:m,Yr=_*_-m*m+ci*k*k*S*S,Qr=2*Jr*k*S,nn=Yr/Qr,Oo=Math.sqrt(nn*nn+1)-nn,Xr=Oo<1e-9?-18:Math.log(Oo);return Xr}function dt(tt){return(Math.exp(tt)-Math.exp(-tt))/2}function nt(tt){return(Math.exp(tt)+Math.exp(-tt))/2}function wt(tt){return dt(tt)/nt(tt)}var ft=N(0);function de(tt){return m*(nt(ft)/nt(ft+P*tt))}function jr(tt){return m*(nt(ft)*wt(ft+P*tt)-dt(ft))/k}function Vr(tt){return 1-Math.pow(1-tt,1.5)}var Gr=Date.now(),ko=(N(1)-ft)/P,Kr=n.duration?1e3*n.duration:1e3*ko*.8;function Io(){var tt=(Date.now()-Gr)/Kr,ci=Vr(tt)*ko;tt<=1?(this._flyToFrame=ot(Io,this),this._move(this.unproject(s.add(l.subtract(s).multiplyBy(jr(ci)/S)),f),this.getScaleZoom(m/de(ci),f),{flyTo:!0})):this._move(t,e)._moveEnd(!0)}return this._moveStart(!0,n.noMoveStart),Io.call(this),this},flyToBounds:function(t,e){var n=this._getBoundsCenterZoom(t,e);return this.flyTo(n.center,n.zoom,e)},setMaxBounds:function(t){return t=W(t),this.listens("moveend",this._panInsideMaxBounds)&&this.off("moveend",this._panInsideMaxBounds),t.isValid()?(this.options.maxBounds=t,this._loaded&&this._panInsideMaxBounds(),this.on("moveend",this._panInsideMaxBounds)):(this.options.maxBounds=null,this)},setMinZoom:function(t){var e=this.options.minZoom;return this.options.minZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()<this.options.minZoom)?this.setZoom(t):this},setMaxZoom:function(t){var e=this.options.maxZoom;return this.options.maxZoom=t,this._loaded&&e!==t&&(this.fire("zoomlevelschange"),this.getZoom()>this.options.maxZoom)?this.setZoom(t):this},panInsideBounds:function(t,e){this._enforcingBounds=!0;var n=this.getCenter(),s=this._limitCenter(n,this._zoom,W(t));return n.equals(s)||this.panTo(s,e),this._enforcingBounds=!1,this},panInside:function(t,e){e=e||{};var n=O(e.paddingTopLeft||e.padding||[0,0]),s=O(e.paddingBottomRight||e.padding||[0,0]),l=this.project(this.getCenter()),u=this.project(t),f=this.getPixelBounds(),m=J([f.min.add(n),f.max.subtract(s)]),_=m.getSize();if(!m.contains(u)){this._enforcingBounds=!0;var S=u.subtract(m.getCenter()),P=m.extend(u).getSize().subtract(_);l.x+=S.x<0?-P.x:P.x,l.y+=S.y<0?-P.y:P.y,this.panTo(this.unproject(l),e),this._enforcingBounds=!1}return this},invalidateSize:function(t){if(!this._loaded)return this;t=c({animate:!1,pan:!0},t===!0?{animate:!0}:t);var e=this.getSize();this._sizeChanged=!0,this._lastCenter=null;var n=this.getSize(),s=e.divideBy(2).round(),l=n.divideBy(2).round(),u=s.subtract(l);return!u.x&&!u.y?this:(t.animate&&t.pan?this.panBy(u):(t.pan&&this._rawPanBy(u),this.fire("move"),t.debounceMoveend?(clearTimeout(this._sizeTimer),this._sizeTimer=setTimeout(h(this.fire,this,"moveend"),200)):this.fire("moveend")),this.fire("resize",{oldSize:e,newSize:n}))},stop:function(){return this.setZoom(this._limitZoom(this._zoom)),this.options.zoomSnap||this.fire("viewreset"),this._stop()},locate:function(t){if(t=this._locateOptions=c({timeout:1e4,watch:!1},t),!("geolocation"in navigator))return this._handleGeolocationError({code:0,message:"Geolocation not supported."}),this;var e=h(this._handleGeolocationResponse,this),n=h(this._handleGeolocationError,this);return t.watch?this._locationWatchId=navigator.geolocation.watchPosition(e,n,t):navigator.geolocation.getCurrentPosition(e,n,t),this},stopLocate:function(){return navigator.geolocation&&navigator.geolocation.clearWatch&&navigator.geolocation.clearWatch(this._locationWatchId),this._locateOptions&&(this._locateOptions.setView=!1),this},_handleGeolocationError:function(t){if(this._container._leaflet_id){var e=t.code,n=t.message||(e===1?"permission denied":e===2?"position unavailable":"timeout");this._locateOptions.setView&&!this._loaded&&this.fitWorld(),this.fire("locationerror",{code:e,message:"Geolocation error: "+n+"."})}},_handleGeolocationResponse:function(t){if(this._container._leaflet_id){var e=t.coords.latitude,n=t.coords.longitude,s=new U(e,n),l=s.toBounds(t.coords.accuracy*2),u=this._locateOptions;if(u.setView){var f=this.getBoundsZoom(l);this.setView(s,u.maxZoom?Math.min(f,u.maxZoom):f)}var m={latlng:s,bounds:l,timestamp:t.timestamp};for(var _ in t.coords)typeof t.coords[_]=="number"&&(m[_]=t.coords[_]);this.fire("locationfound",m)}},addHandler:function(t,e){if(!e)return this;var n=this[t]=new e(this);return this._handlers.push(n),this.options[t]&&n.enable(),this},remove:function(){if(this._initEvents(!0),this.options.maxBounds&&this.off("moveend",this._panInsideMaxBounds),this._containerId!==this._container._leaflet_id)throw new Error("Map container is being reused by another instance");try{delete this._container._leaflet_id,delete this._containerId}catch{this._container._leaflet_id=void 0,this._containerId=void 0}this._locationWatchId!==void 0&&this.stopLocate(),this._stop(),G(this._mapPane),this._clearControlPos&&this._clearControlPos(),this._resizeRequest&&(st(this._resizeRequest),this._resizeRequest=null),this._clearHandlers(),this._loaded&&this.fire("unload");var t;for(t in this._layers)this._layers[t].remove();for(t in this._panes)G(this._panes[t]);return this._layers=[],this._panes=[],delete this._mapPane,delete this._renderer,this},createPane:function(t,e){var n="leaflet-pane"+(t?" leaflet-"+t.replace("Pane","")+"-pane":""),s=Z("div",n,e||this._mapPane);return t&&(this._panes[t]=s),s},getCenter:function(){return this._checkIfLoaded(),this._lastCenter&&!this._moved()?this._lastCenter.clone():this.layerPointToLatLng(this._getCenterLayerPoint())},getZoom:function(){return this._zoom},getBounds:function(){var t=this.getPixelBounds(),e=this.unproject(t.getBottomLeft()),n=this.unproject(t.getTopRight());return new it(e,n)},getMinZoom:function(){return this.options.minZoom===void 0?this._layersMinZoom||0:this.options.minZoom},getMaxZoom:function(){return this.options.maxZoom===void 0?this._layersMaxZoom===void 0?1/0:this._layersMaxZoom:this.options.maxZoom},getBoundsZoom:function(t,e,n){t=W(t),n=O(n||[0,0]);var s=this.getZoom()||0,l=this.getMinZoom(),u=this.getMaxZoom(),f=t.getNorthWest(),m=t.getSouthEast(),_=this.getSize().subtract(n),S=J(this.project(m,s),this.project(f,s)).getSize(),P=A.any3d?this.options.zoomSnap:1,k=_.x/S.x,N=_.y/S.y,dt=e?Math.max(k,N):Math.min(k,N);return s=this.getScaleZoom(dt,s),P&&(s=Math.round(s/(P/100))*(P/100),s=e?Math.ceil(s/P)*P:Math.floor(s/P)*P),Math.max(l,Math.min(u,s))},getSize:function(){return(!this._size||this._sizeChanged)&&(this._size=new C(this._container.clientWidth||0,this._container.clientHeight||0),this._sizeChanged=!1),this._size.clone()},getPixelBounds:function(t,e){var n=this._getTopLeftPoint(t,e);return new F(n,n.add(this.getSize()))},getPixelOrigin:function(){return this._checkIfLoaded(),this._pixelOrigin},getPixelWorldBounds:function(t){return this.options.crs.getProjectedBounds(t===void 0?this.getZoom():t)},getPane:function(t){return typeof t=="string"?this._panes[t]:t},getPanes:function(){return this._panes},getContainer:function(){return this._container},getZoomScale:function(t,e){var n=this.options.crs;return e=e===void 0?this._zoom:e,n.scale(t)/n.scale(e)},getScaleZoom:function(t,e){var n=this.options.crs;e=e===void 0?this._zoom:e;var s=n.zoom(t*n.scale(e));return isNaN(s)?1/0:s},project:function(t,e){return e=e===void 0?this._zoom:e,this.options.crs.latLngToPoint(D(t),e)},unproject:function(t,e){return e=e===void 0?this._zoom:e,this.options.crs.pointToLatLng(O(t),e)},layerPointToLatLng:function(t){var e=O(t).add(this.getPixelOrigin());return this.unproject(e)},latLngToLayerPoint:function(t){var e=this.project(D(t))._round();return e._subtract(this.getPixelOrigin())},wrapLatLng:function(t){return this.options.crs.wrapLatLng(D(t))},wrapLatLngBounds:function(t){return this.options.crs.wrapLatLngBounds(W(t))},distance:function(t,e){return this.options.crs.distance(D(t),D(e))},containerPointToLayerPoint:function(t){return O(t).subtract(this._getMapPanePos())},layerPointToContainerPoint:function(t){return O(t).add(this._getMapPanePos())},containerPointToLatLng:function(t){var e=this.containerPointToLayerPoint(O(t));return this.layerPointToLatLng(e)},latLngToContainerPoint:function(t){return this.layerPointToContainerPoint(this.latLngToLayerPoint(D(t)))},mouseEventToContainerPoint:function(t){return Kn(t,this._container)},mouseEventToLayerPoint:function(t){return this.containerPointToLayerPoint(this.mouseEventToContainerPoint(t))},mouseEventToLatLng:function(t){return this.layerPointToLatLng(this.mouseEventToLayerPoint(t))},_initContainer:function(t){var e=this._container=$n(t);if(e){if(e._leaflet_id)throw new Error("Map container is already initialized.")}else throw new Error("Map container not found.");M(e,"scroll",this._onScroll,this),this._containerId=g(e)},_initLayout:function(){var t=this._container;this._fadeAnimated=this.options.fadeAnimation&&A.any3d,R(t,"leaflet-container"+(A.touch?" leaflet-touch":"")+(A.retina?" leaflet-retina":"")+(A.ielt9?" leaflet-oldie":"")+(A.safari?" leaflet-safari":"")+(this._fadeAnimated?" leaflet-fade-anim":""));var e=Se(t,"position");e!=="absolute"&&e!=="relative"&&e!=="fixed"&&e!=="sticky"&&(t.style.position="relative"),this._initPanes(),this._initControlPos&&this._initControlPos()},_initPanes:function(){var t=this._panes={};this._paneRenderers={},this._mapPane=this.createPane("mapPane",this._container),X(this._mapPane,new C(0,0)),this.createPane("tilePane"),this.createPane("overlayPane"),this.createPane("shadowPane"),this.createPane("markerPane"),this.createPane("tooltipPane"),this.createPane("popupPane"),this.options.markerZoomAnimation||(R(t.markerPane,"leaflet-zoom-hide"),R(t.shadowPane,"leaflet-zoom-hide"))},_resetView:function(t,e,n){X(this._mapPane,new C(0,0));var s=!this._loaded;this._loaded=!0,e=this._limitZoom(e),this.fire("viewprereset");var l=this._zoom!==e;this._moveStart(l,n)._move(t,e)._moveEnd(l),this.fire("viewreset"),s&&this.fire("load")},_moveStart:function(t,e){return t&&this.fire("zoomstart"),e||this.fire("movestart"),this},_move:function(t,e,n,s){e===void 0&&(e=this._zoom);var l=this._zoom!==e;return this._zoom=e,this._lastCenter=t,this._pixelOrigin=this._getNewPixelOrigin(t),s?n&&n.pinch&&this.fire("zoom",n):((l||n&&n.pinch)&&this.fire("zoom",n),this.fire("move",n)),this},_moveEnd:function(t){return t&&this.fire("zoomend"),this.fire("moveend")},_stop:function(){return st(this._flyToFrame),this._panAnim&&this._panAnim.stop(),this},_rawPanBy:function(t){X(this._mapPane,this._getMapPanePos().subtract(t))},_getZoomSpan:function(){return this.getMaxZoom()-this.getMinZoom()},_panInsideMaxBounds:function(){this._enforcingBounds||this.panInsideBounds(this.options.maxBounds)},_checkIfLoaded:function(){if(!this._loaded)throw new Error("Set map center and zoom first.")},_initEvents:function(t){this._targets={},this._targets[g(this._container)]=this;var e=t?q:M;e(this._container,"click dblclick mousedown mouseup mouseover mouseout mousemove contextmenu keypress keydown keyup",this._handleDOMEvent,this),this.options.trackResize&&e(window,"resize",this._onResize,this),A.any3d&&this.options.transform3DLimit&&(t?this.off:this.on).call(this,"moveend",this._onMoveEnd)},_onResize:function(){st(this._resizeRequest),this._resizeRequest=ot(function(){this.invalidateSize({debounceMoveend:!0})},this)},_onScroll:function(){this._container.scrollTop=0,this._container.scrollLeft=0},_onMoveEnd:function(){var t=this._getMapPanePos();Math.max(Math.abs(t.x),Math.abs(t.y))>=this.options.transform3DLimit&&this._resetView(this.getCenter(),this.getZoom())},_findEventTargets:function(t,e){for(var n=[],s,l=e==="mouseout"||e==="mouseover",u=t.target||t.srcElement,f=!1;u;){if(s=this._targets[g(u)],s&&(e==="click"||e==="preclick")&&this._draggableMoved(s)){f=!0;break}if(s&&s.listens(e,!0)&&(l&&!$i(u,t)||(n.push(s),l))||u===this._container)break;u=u.parentNode}return!n.length&&!f&&!l&&this.listens(e,!0)&&(n=[this]),n},_isClickDisabled:function(t){for(;t&&t!==this._container;){if(t._leaflet_disable_click)return!0;t=t.parentNode}},_handleDOMEvent:function(t){var e=t.target||t.srcElement;if(!(!this._loaded||e._leaflet_disable_events||t.type==="click"&&this._isClickDisabled(e))){var n=t.type;n==="mousedown"&&Fi(e),this._fireDOMEvent(t,n)}},_mouseEvents:["click","dblclick","mouseover","mouseout","contextmenu"],_fireDOMEvent:function(t,e,n){if(t.type==="click"){var s=c({},t);s.type="preclick",this._fireDOMEvent(s,s.type,n)}var l=this._findEventTargets(t,e);if(n){for(var u=[],f=0;f<n.length;f++)n[f].listens(e,!0)&&u.push(n[f]);l=u.concat(l)}if(l.length){e==="contextmenu"&&at(t);var m=l[0],_={originalEvent:t};if(t.type!=="keypress"&&t.type!=="keydown"&&t.type!=="keyup"){var S=m.getLatLng&&(!m._radius||m._radius<=10);_.containerPoint=S?this.latLngToContainerPoint(m.getLatLng()):this.mouseEventToContainerPoint(t),_.layerPoint=this.containerPointToLayerPoint(_.containerPoint),_.latlng=S?m.getLatLng():this.layerPointToLatLng(_.layerPoint)}for(f=0;f<l.length;f++)if(l[f].fire(e,_,!0),_.originalEvent._stopped||l[f].options.bubblingMouseEvents===!1&&et(this._mouseEvents,e)!==-1)return}},_draggableMoved:function(t){return t=t.dragging&&t.dragging.enabled()?t:this,t.dragging&&t.dragging.moved()||this.boxZoom&&this.boxZoom.moved()},_clearHandlers:function(){for(var t=0,e=this._handlers.length;t<e;t++)this._handlers[t].disable()},whenReady:function(t,e){return this._loaded?t.call(e||this,{target:this}):this.on("load",t,e),this},_getMapPanePos:function(){return Kt(this._mapPane)||new C(0,0)},_moved:function(){var t=this._getMapPanePos();return t&&!t.equals([0,0])},_getTopLeftPoint:function(t,e){var n=t&&e!==void 0?this._getNewPixelOrigin(t,e):this.getPixelOrigin();return n.subtract(this._getMapPanePos())},_getNewPixelOrigin:function(t,e){var n=this.getSize()._divideBy(2);return this.project(t,e)._subtract(n)._add(this._getMapPanePos())._round()},_latLngToNewLayerPoint:function(t,e,n){var s=this._getNewPixelOrigin(n,e);return this.project(t,e)._subtract(s)},_latLngBoundsToNewLayerBounds:function(t,e,n){var s=this._getNewPixelOrigin(n,e);return J([this.project(t.getSouthWest(),e)._subtract(s),this.project(t.getNorthWest(),e)._subtract(s),this.project(t.getSouthEast(),e)._subtract(s),this.project(t.getNorthEast(),e)._subtract(s)])},_getCenterLayerPoint:function(){return this.containerPointToLayerPoint(this.getSize()._divideBy(2))},_getCenterOffset:function(t){return this.latLngToLayerPoint(t).subtract(this._getCenterLayerPoint())},_limitCenter:function(t,e,n){if(!n)return t;var s=this.project(t,e),l=this.getSize().divideBy(2),u=new F(s.subtract(l),s.add(l)),f=this._getBoundsOffset(u,n,e);return Math.abs(f.x)<=1&&Math.abs(f.y)<=1?t:this.unproject(s.add(f),e)},_limitOffset:function(t,e){if(!e)return t;var n=this.getPixelBounds(),s=new F(n.min.add(t),n.max.add(t));return t.add(this._getBoundsOffset(s,e))},_getBoundsOffset:function(t,e,n){var s=J(this.project(e.getNorthEast(),n),this.project(e.getSouthWest(),n)),l=s.min.subtract(t.min),u=s.max.subtract(t.max),f=this._rebound(l.x,-u.x),m=this._rebound(l.y,-u.y);return new C(f,m)},_rebound:function(t,e){return t+e>0?Math.round(t-e)/2:Math.max(0,Math.ceil(t))-Math.max(0,Math.floor(e))},_limitZoom:function(t){var e=this.getMinZoom(),n=this.getMaxZoom(),s=A.any3d?this.options.zoomSnap:1;return s&&(t=Math.round(t/s)*s),Math.max(e,Math.min(n,t))},_onPanTransitionStep:function(){this.fire("move")},_onPanTransitionEnd:function(){Y(this._mapPane,"leaflet-pan-anim"),this.fire("moveend")},_tryAnimatedPan:function(t,e){var n=this._getCenterOffset(t)._trunc();return(e&&e.animate)!==!0&&!this.getSize().contains(n)?!1:(this.panBy(n,e),!0)},_createAnimProxy:function(){var t=this._proxy=Z("div","leaflet-proxy leaflet-zoom-animated");this._panes.mapPane.appendChild(t),this.on("zoomanim",function(e){var n=Oi,s=this._proxy.style[n];Gt(this._proxy,this.project(e.center,e.zoom),this.getZoomScale(e.zoom,1)),s===this._proxy.style[n]&&this._animatingZoom&&this._onZoomTransitionEnd()},this),this.on("load moveend",this._animMoveEnd,this),this._on("unload",this._destroyAnimProxy,this)},_destroyAnimProxy:function(){G(this._proxy),this.off("load moveend",this._animMoveEnd,this),delete this._proxy},_animMoveEnd:function(){var t=this.getCenter(),e=this.getZoom();Gt(this._proxy,this.project(t,e),this.getZoomScale(e,1))},_catchTransitionEnd:function(t){this._animatingZoom&&t.propertyName.indexOf("transform")>=0&&this._onZoomTransitionEnd()},_nothingToAnimate:function(){return!this._container.getElementsByClassName("leaflet-zoom-animated").length},_tryAnimatedZoom:function(t,e,n){if(this._animatingZoom)return!0;if(n=n||{},!this._zoomAnimated||n.animate===!1||this._nothingToAnimate()||Math.abs(e-this._zoom)>this.options.zoomAnimationThreshold)return!1;var s=this.getZoomScale(e),l=this._getCenterOffset(t)._divideBy(1-1/s);return n.animate!==!0&&!this.getSize().contains(l)?!1:(ot(function(){this._moveStart(!0,n.noMoveStart||!1)._animateZoom(t,e,!0)},this),!0)},_animateZoom:function(t,e,n,s){this._mapPane&&(n&&(this._animatingZoom=!0,this._animateToCenter=t,this._animateToZoom=e,R(this._mapPane,"leaflet-zoom-anim")),this.fire("zoomanim",{center:t,zoom:e,noUpdate:s}),this._tempFireZoomEvent||(this._tempFireZoomEvent=this._zoom!==this._animateToZoom),this._move(this._animateToCenter,this._animateToZoom,void 0,!0),setTimeout(h(this._onZoomTransitionEnd,this),250))},_onZoomTransitionEnd:function(){this._animatingZoom&&(this._mapPane&&Y(this._mapPane,"leaflet-zoom-anim"),this._animatingZoom=!1,this._move(this._animateToCenter,this._animateToZoom,void 0,!0),this._tempFireZoomEvent&&this.fire("zoom"),delete this._tempFireZoomEvent,this.fire("move"),this._moveEnd(!0))}});function cr(t,e){return new z(t,e)}var Et=rt.extend({options:{position:"topright"},initialize:function(t){x(this,t)},getPosition:function(){return this.options.position},setPosition:function(t){var e=this._map;return e&&e.removeControl(this),this.options.position=t,e&&e.addControl(this),this},getContainer:function(){return this._container},addTo:function(t){this.remove(),this._map=t;var e=this._container=this.onAdd(t),n=this.getPosition(),s=t._controlCorners[n];return R(e,"leaflet-control"),n.indexOf("bottom")!==-1?s.insertBefore(e,s.firstChild):s.appendChild(e),this._map.on("unload",this.remove,this),this},remove:function(){return this._map?(G(this._container),this.onRemove&&this.onRemove(this._map),this._map.off("unload",this.remove,this),this._map=null,this):this},_refocusOnMap:function(t){this._map&&t&&t.screenX>0&&t.screenY>0&&this._map.getContainer().focus()}}),Te=function(t){return new Et(t)};z.include({addControl:function(t){return t.addTo(this),this},removeControl:function(t){return t.remove(),this},_initControlPos:function(){var t=this._controlCorners={},e="leaflet-",n=this._controlContainer=Z("div",e+"control-container",this._container);function s(l,u){var f=e+l+" "+e+u;t[l+u]=Z("div",f,n)}s("top","left"),s("top","right"),s("bottom","left"),s("bottom","right")},_clearControlPos:function(){for(var t in this._controlCorners)G(this._controlCorners[t]);G(this._controlContainer),delete this._controlCorners,delete this._controlContainer}});var Qn=Et.extend({options:{collapsed:!0,position:"topright",autoZIndex:!0,hideSingleBase:!1,sortLayers:!1,sortFunction:function(t,e,n,s){return n<s?-1:s<n?1:0}},initialize:function(t,e,n){x(this,n),this._layerControlInputs=[],this._layers=[],this._lastZIndex=0,this._handlingClick=!1,this._preventClick=!1;for(var s in t)this._addLayer(t[s],s);for(s in e)this._addLayer(e[s],s,!0)},onAdd:function(t){this._initLayout(),this._update(),this._map=t,t.on("zoomend",this._checkDisabledLayers,this);for(var e=0;e<this._layers.length;e++)this._layers[e].layer.on("add remove",this._onLayerChange,this);return this._container},addTo:function(t){return Et.prototype.addTo.call(this,t),this._expandIfNotCollapsed()},onRemove:function(){this._map.off("zoomend",this._checkDisabledLayers,this);for(var t=0;t<this._layers.length;t++)this._layers[t].layer.off("add remove",this._onLayerChange,this)},addBaseLayer:function(t,e){return this._addLayer(t,e),this._map?this._update():this},addOverlay:function(t,e){return this._addLayer(t,e,!0),this._map?this._update():this},removeLayer:function(t){t.off("add remove",this._onLayerChange,this);var e=this._getLayer(g(t));return e&&this._layers.splice(this._layers.indexOf(e),1),this._map?this._update():this},expand:function(){R(this._container,"leaflet-control-layers-expanded"),this._section.style.height=null;var t=this._map.getSize().y-(this._container.offsetTop+50);return t<this._section.clientHeight?(R(this._section,"leaflet-control-layers-scrollbar"),this._section.style.height=t+"px"):Y(this._section,"leaflet-control-layers-scrollbar"),this._checkDisabledLayers(),this},collapse:function(){return Y(this._container,"leaflet-control-layers-expanded"),this},_initLayout:function(){var t="leaflet-control-layers",e=this._container=Z("div",t),n=this.options.collapsed;e.setAttribute("aria-haspopup",!0),Pe(e),Wi(e);var s=this._section=Z("section",t+"-list");n&&(this._map.on("click",this.collapse,this),M(e,{mouseenter:this._expandSafely,mouseleave:this.collapse},this));var l=this._layersLink=Z("a",t+"-toggle",e);l.href="#",l.title="Layers",l.setAttribute("role","button"),M(l,{keydown:function(u){u.keyCode===13&&this._expandSafely()},click:function(u){at(u),this._expandSafely()}},this),n||this.expand(),this._baseLayersList=Z("div",t+"-base",s),this._separator=Z("div",t+"-separator",s),this._overlaysList=Z("div",t+"-overlays",s),e.appendChild(s)},_getLayer:function(t){for(var e=0;e<this._layers.length;e++)if(this._layers[e]&&g(this._layers[e].layer)===t)return this._layers[e]},_addLayer:function(t,e,n){this._map&&t.on("add remove",this._onLayerChange,this),this._layers.push({layer:t,name:e,overlay:n}),this.options.sortLayers&&this._layers.sort(h(function(s,l){return this.options.sortFunction(s.layer,l.layer,s.name,l.name)},this)),this.options.autoZIndex&&t.setZIndex&&(this._lastZIndex++,t.setZIndex(this._lastZIndex)),this._expandIfNotCollapsed()},_update:function(){if(!this._container)return this;Ve(this._baseLayersList),Ve(this._overlaysList),this._layerControlInputs=[];var t,e,n,s,l=0;for(n=0;n<this._layers.length;n++)s=this._layers[n],this._addItem(s),e=e||s.overlay,t=t||!s.overlay,l+=s.overlay?0:1;return this.options.hideSingleBase&&(t=t&&l>1,this._baseLayersList.style.display=t?"":"none"),this._separator.style.display=e&&t?"":"none",this},_onLayerChange:function(t){this._handlingClick||this._update();var e=this._getLayer(g(t.target)),n=e.overlay?t.type==="add"?"overlayadd":"overlayremove":t.type==="add"?"baselayerchange":null;n&&this._map.fire(n,e)},_createRadioElement:function(t,e){var n='<input type="radio" class="leaflet-control-layers-selector" name="'+t+'"'+(e?' checked="checked"':"")+"/>",s=document.createElement("div");return s.innerHTML=n,s.firstChild},_addItem:function(t){var e=document.createElement("label"),n=this._map.hasLayer(t.layer),s;t.overlay?(s=document.createElement("input"),s.type="checkbox",s.className="leaflet-control-layers-selector",s.defaultChecked=n):s=this._createRadioElement("leaflet-base-layers_"+g(this),n),this._layerControlInputs.push(s),s.layerId=g(t.layer),M(s,"click",this._onInputClick,this);var l=document.createElement("span");l.innerHTML=" "+t.name;var u=document.createElement("span");e.appendChild(u),u.appendChild(s),u.appendChild(l);var f=t.overlay?this._overlaysList:this._baseLayersList;return f.appendChild(e),this._checkDisabledLayers(),e},_onInputClick:function(){if(!this._preventClick){var t=this._layerControlInputs,e,n,s=[],l=[];this._handlingClick=!0;for(var u=t.length-1;u>=0;u--)e=t[u],n=this._getLayer(e.layerId).layer,e.checked?s.push(n):e.checked||l.push(n);for(u=0;u<l.length;u++)this._map.hasLayer(l[u])&&this._map.removeLayer(l[u]);for(u=0;u<s.length;u++)this._map.hasLayer(s[u])||this._map.addLayer(s[u]);this._handlingClick=!1,this._refocusOnMap()}},_checkDisabledLayers:function(){for(var t=this._layerControlInputs,e,n,s=this._map.getZoom(),l=t.length-1;l>=0;l--)e=t[l],n=this._getLayer(e.layerId).layer,e.disabled=n.options.minZoom!==void 0&&s<n.options.minZoom||n.options.maxZoom!==void 0&&s>n.options.maxZoom},_expandIfNotCollapsed:function(){return this._map&&!this.options.collapsed&&this.expand(),this},_expandSafely:function(){var t=this._section;this._preventClick=!0,M(t,"click",at),this.expand();var e=this;setTimeout(function(){q(t,"click",at),e._preventClick=!1})}}),ur=function(t,e,n){return new Qn(t,e,n)},ji=Et.extend({options:{position:"topleft",zoomInText:'<span aria-hidden="true">+</span>',zoomInTitle:"Zoom in",zoomOutText:'<span aria-hidden="true">&#x2212;</span>',zoomOutTitle:"Zoom out"},onAdd:function(t){var e="leaflet-control-zoom",n=Z("div",e+" leaflet-bar"),s=this.options;return this._zoomInButton=this._createButton(s.zoomInText,s.zoomInTitle,e+"-in",n,this._zoomIn),this._zoomOutButton=this._createButton(s.zoomOutText,s.zoomOutTitle,e+"-out",n,this._zoomOut),this._updateDisabled(),t.on("zoomend zoomlevelschange",this._updateDisabled,this),n},onRemove:function(t){t.off("zoomend zoomlevelschange",this._updateDisabled,this)},disable:function(){return this._disabled=!0,this._updateDisabled(),this},enable:function(){return this._disabled=!1,this._updateDisabled(),this},_zoomIn:function(t){!this._disabled&&this._map._zoom<this._map.getMaxZoom()&&this._map.zoomIn(this._map.options.zoomDelta*(t.shiftKey?3:1))},_zoomOut:function(t){!this._disabled&&this._map._zoom>this._map.getMinZoom()&&this._map.zoomOut(this._map.options.zoomDelta*(t.shiftKey?3:1))},_createButton:function(t,e,n,s,l){var u=Z("a",n,s);return u.innerHTML=t,u.href="#",u.title=e,u.setAttribute("role","button"),u.setAttribute("aria-label",e),Pe(u),M(u,"click",Yt),M(u,"click",l,this),M(u,"click",this._refocusOnMap,this),u},_updateDisabled:function(){var t=this._map,e="leaflet-disabled";Y(this._zoomInButton,e),Y(this._zoomOutButton,e),this._zoomInButton.setAttribute("aria-disabled","false"),this._zoomOutButton.setAttribute("aria-disabled","false"),(this._disabled||t._zoom===t.getMinZoom())&&(R(this._zoomOutButton,e),this._zoomOutButton.setAttribute("aria-disabled","true")),(this._disabled||t._zoom===t.getMaxZoom())&&(R(this._zoomInButton,e),this._zoomInButton.setAttribute("aria-disabled","true"))}});z.mergeOptions({zoomControl:!0}),z.addInitHook(function(){this.options.zoomControl&&(this.zoomControl=new ji,this.addControl(this.zoomControl))});var hr=function(t){return new ji(t)},Xn=Et.extend({options:{position:"bottomleft",maxWidth:100,metric:!0,imperial:!0},onAdd:function(t){var e="leaflet-control-scale",n=Z("div",e),s=this.options;return this._addScales(s,e+"-line",n),t.on(s.updateWhenIdle?"moveend":"move",this._update,this),t.whenReady(this._update,this),n},onRemove:function(t){t.off(this.options.updateWhenIdle?"moveend":"move",this._update,this)},_addScales:function(t,e,n){t.metric&&(this._mScale=Z("div",e,n)),t.imperial&&(this._iScale=Z("div",e,n))},_update:function(){var t=this._map,e=t.getSize().y/2,n=t.distance(t.containerPointToLatLng([0,e]),t.containerPointToLatLng([this.options.maxWidth,e]));this._updateScales(n)},_updateScales:function(t){this.options.metric&&t&&this._updateMetric(t),this.options.imperial&&t&&this._updateImperial(t)},_updateMetric:function(t){var e=this._getRoundNum(t),n=e<1e3?e+" m":e/1e3+" km";this._updateScale(this._mScale,n,e/t)},_updateImperial:function(t){var e=t*3.2808399,n,s,l;e>5280?(n=e/5280,s=this._getRoundNum(n),this._updateScale(this._iScale,s+" mi",s/n)):(l=this._getRoundNum(e),this._updateScale(this._iScale,l+" ft",l/e))},_updateScale:function(t,e,n){t.style.width=Math.round(this.options.maxWidth*n)+"px",t.innerHTML=e},_getRoundNum:function(t){var e=Math.pow(10,(Math.floor(t)+"").length-1),n=t/e;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:1,e*n}}),dr=function(t){return new Xn(t)},fr='<svg aria-hidden="true" xmlns="http://www.w3.org/2000/svg" width="12" height="8" viewBox="0 0 12 8" class="leaflet-attribution-flag"><path fill="#4C7BE1" d="M0 0h12v4H0z"/><path fill="#FFD500" d="M0 4h12v3H0z"/><path fill="#E0BC00" d="M0 7h12v1H0z"/></svg>',Vi=Et.extend({options:{position:"bottomright",prefix:'<a href="https://leafletjs.com" title="A JavaScript library for interactive maps">'+(A.inlineSvg?fr+" ":"")+"Leaflet</a>"},initialize:function(t){x(this,t),this._attributions={}},onAdd:function(t){t.attributionControl=this,this._container=Z("div","leaflet-control-attribution"),Pe(this._container);for(var e in t._layers)t._layers[e].getAttribution&&this.addAttribution(t._layers[e].getAttribution());return this._update(),t.on("layeradd",this._addAttribution,this),this._container},onRemove:function(t){t.off("layeradd",this._addAttribution,this)},_addAttribution:function(t){t.layer.getAttribution&&(this.addAttribution(t.layer.getAttribution()),t.layer.once("remove",function(){this.removeAttribution(t.layer.getAttribution())},this))},setPrefix:function(t){return this.options.prefix=t,this._update(),this},addAttribution:function(t){return t?(this._attributions[t]||(this._attributions[t]=0),this._attributions[t]++,this._update(),this):this},removeAttribution:function(t){return t?(this._attributions[t]&&(this._attributions[t]--,this._update()),this):this},_update:function(){if(this._map){var t=[];for(var e in this._attributions)this._attributions[e]&&t.push(e);var n=[];this.options.prefix&&n.push(this.options.prefix),t.length&&n.push(t.join(", ")),this._container.innerHTML=n.join(' <span aria-hidden="true">|</span> ')}}});z.mergeOptions({attributionControl:!0}),z.addInitHook(function(){this.options.attributionControl&&new Vi().addTo(this)});var pr=function(t){return new Vi(t)};Et.Layers=Qn,Et.Zoom=ji,Et.Scale=Xn,Et.Attribution=Vi,Te.layers=ur,Te.zoom=hr,Te.scale=dr,Te.attribution=pr;var Ct=rt.extend({initialize:function(t){this._map=t},enable:function(){return this._enabled?this:(this._enabled=!0,this.addHooks(),this)},disable:function(){return this._enabled?(this._enabled=!1,this.removeHooks(),this):this},enabled:function(){return!!this._enabled}});Ct.addTo=function(t,e){return t.addHandler(e,this),this};var mr={Events:j},to=A.touch?"touchstart mousedown":"mousedown",qt=Ut.extend({options:{clickTolerance:3},initialize:function(t,e,n,s){x(this,s),this._element=t,this._dragStartTarget=e||t,this._preventOutline=n},enable:function(){this._enabled||(M(this._dragStartTarget,to,this._onDown,this),this._enabled=!0)},disable:function(){this._enabled&&(qt._dragging===this&&this.finishDrag(!0),q(this._dragStartTarget,to,this._onDown,this),this._enabled=!1,this._moved=!1)},_onDown:function(t){if(this._enabled&&(this._moved=!1,!Mi(this._element,"leaflet-zoom-anim"))){if(t.touches&&t.touches.length!==1){qt._dragging===this&&this.finishDrag();return}if(!(qt._dragging||t.shiftKey||t.which!==1&&t.button!==1&&!t.touches)&&(qt._dragging=this,this._preventOutline&&Fi(this._element),Ni(),Le(),!this._moving)){this.fire("down");var e=t.touches?t.touches[0]:t,n=jn(this._element);this._startPoint=new C(e.clientX,e.clientY),this._startPos=Kt(this._element),this._parentScale=Zi(n);var s=t.type==="mousedown";M(document,s?"mousemove":"touchmove",this._onMove,this),M(document,s?"mouseup":"touchend touchcancel",this._onUp,this)}}},_onMove:function(t){if(this._enabled){if(t.touches&&t.touches.length>1){this._moved=!0;return}var e=t.touches&&t.touches.length===1?t.touches[0]:t,n=new C(e.clientX,e.clientY)._subtract(this._startPoint);!n.x&&!n.y||Math.abs(n.x)+Math.abs(n.y)<this.options.clickTolerance||(n.x/=this._parentScale.x,n.y/=this._parentScale.y,at(t),this._moved||(this.fire("dragstart"),this._moved=!0,R(document.body,"leaflet-dragging"),this._lastTarget=t.target||t.srcElement,window.SVGElementInstance&&this._lastTarget instanceof window.SVGElementInstance&&(this._lastTarget=this._lastTarget.correspondingUseElement),R(this._lastTarget,"leaflet-drag-target")),this._newPos=this._startPos.add(n),this._moving=!0,this._lastEvent=t,this._updatePosition())}},_updatePosition:function(){var t={originalEvent:this._lastEvent};this.fire("predrag",t),X(this._element,this._newPos),this.fire("drag",t)},_onUp:function(){this._enabled&&this.finishDrag()},finishDrag:function(t){Y(document.body,"leaflet-dragging"),this._lastTarget&&(Y(this._lastTarget,"leaflet-drag-target"),this._lastTarget=null),q(document,"mousemove touchmove",this._onMove,this),q(document,"mouseup touchend touchcancel",this._onUp,this),Di(),Ee();var e=this._moved&&this._moving;this._moving=!1,qt._dragging=!1,e&&this.fire("dragend",{noInertia:t,distance:this._newPos.distanceTo(this._startPos)})}});function eo(t,e,n){var s,l=[1,4,2,8],u,f,m,_,S,P,k,N;for(u=0,P=t.length;u<P;u++)t[u]._code=Qt(t[u],e);for(m=0;m<4;m++){for(k=l[m],s=[],u=0,P=t.length,f=P-1;u<P;f=u++)_=t[u],S=t[f],_._code&k?S._code&k||(N=Qe(S,_,k,e,n),N._code=Qt(N,e),s.push(N)):(S._code&k&&(N=Qe(S,_,k,e,n),N._code=Qt(N,e),s.push(N)),s.push(_));t=s}return t}function io(t,e){var n,s,l,u,f,m,_,S,P;if(!t||t.length===0)throw new Error("latlngs not passed");yt(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var k=D([0,0]),N=W(t),dt=N.getNorthWest().distanceTo(N.getSouthWest())*N.getNorthEast().distanceTo(N.getNorthWest());dt<1700&&(k=Gi(t));var nt=t.length,wt=[];for(n=0;n<nt;n++){var ft=D(t[n]);wt.push(e.project(D([ft.lat-k.lat,ft.lng-k.lng])))}for(m=_=S=0,n=0,s=nt-1;n<nt;s=n++)l=wt[n],u=wt[s],f=l.y*u.x-u.y*l.x,_+=(l.x+u.x)*f,S+=(l.y+u.y)*f,m+=f*3;m===0?P=wt[0]:P=[_/m,S/m];var de=e.unproject(O(P));return D([de.lat+k.lat,de.lng+k.lng])}function Gi(t){for(var e=0,n=0,s=0,l=0;l<t.length;l++){var u=D(t[l]);e+=u.lat,n+=u.lng,s++}return D([e/s,n/s])}var gr={__proto__:null,clipPolygon:eo,polygonCenter:io,centroid:Gi};function no(t,e){if(!e||!t.length)return t.slice();var n=e*e;return t=yr(t,n),t=vr(t,n),t}function oo(t,e,n){return Math.sqrt(Ae(t,e,n,!0))}function _r(t,e,n){return Ae(t,e,n)}function vr(t,e){var n=t.length,s=typeof Uint8Array<"u"?Uint8Array:Array,l=new s(n);l[0]=l[n-1]=1,Ki(t,l,e,0,n-1);var u,f=[];for(u=0;u<n;u++)l[u]&&f.push(t[u]);return f}function Ki(t,e,n,s,l){var u=0,f,m,_;for(m=s+1;m<=l-1;m++)_=Ae(t[m],t[s],t[l],!0),_>u&&(f=m,u=_);u>n&&(e[f]=1,Ki(t,e,n,s,f),Ki(t,e,n,f,l))}function yr(t,e){for(var n=[t[0]],s=1,l=0,u=t.length;s<u;s++)wr(t[s],t[l])>e&&(n.push(t[s]),l=s);return l<u-1&&n.push(t[u-1]),n}var so;function ro(t,e,n,s,l){var u=s?so:Qt(t,n),f=Qt(e,n),m,_,S;for(so=f;;){if(!(u|f))return[t,e];if(u&f)return!1;m=u||f,_=Qe(t,e,m,n,l),S=Qt(_,n),m===u?(t=_,u=S):(e=_,f=S)}}function Qe(t,e,n,s,l){var u=e.x-t.x,f=e.y-t.y,m=s.min,_=s.max,S,P;return n&8?(S=t.x+u*(_.y-t.y)/f,P=_.y):n&4?(S=t.x+u*(m.y-t.y)/f,P=m.y):n&2?(S=_.x,P=t.y+f*(_.x-t.x)/u):n&1&&(S=m.x,P=t.y+f*(m.x-t.x)/u),new C(S,P,l)}function Qt(t,e){var n=0;return t.x<e.min.x?n|=1:t.x>e.max.x&&(n|=2),t.y<e.min.y?n|=4:t.y>e.max.y&&(n|=8),n}function wr(t,e){var n=e.x-t.x,s=e.y-t.y;return n*n+s*s}function Ae(t,e,n,s){var l=e.x,u=e.y,f=n.x-l,m=n.y-u,_=f*f+m*m,S;return _>0&&(S=((t.x-l)*f+(t.y-u)*m)/_,S>1?(l=n.x,u=n.y):S>0&&(l+=f*S,u+=m*S)),f=t.x-l,m=t.y-u,s?f*f+m*m:new C(l,u)}function yt(t){return!H(t[0])||typeof t[0][0]!="object"&&typeof t[0][0]<"u"}function ao(t){return console.warn("Deprecated use of _flat, please use L.LineUtil.isFlat instead."),yt(t)}function lo(t,e){var n,s,l,u,f,m,_,S;if(!t||t.length===0)throw new Error("latlngs not passed");yt(t)||(console.warn("latlngs are not flat! Only the first ring will be used"),t=t[0]);var P=D([0,0]),k=W(t),N=k.getNorthWest().distanceTo(k.getSouthWest())*k.getNorthEast().distanceTo(k.getNorthWest());N<1700&&(P=Gi(t));var dt=t.length,nt=[];for(n=0;n<dt;n++){var wt=D(t[n]);nt.push(e.project(D([wt.lat-P.lat,wt.lng-P.lng])))}for(n=0,s=0;n<dt-1;n++)s+=nt[n].distanceTo(nt[n+1])/2;if(s===0)S=nt[0];else for(n=0,u=0;n<dt-1;n++)if(f=nt[n],m=nt[n+1],l=f.distanceTo(m),u+=l,u>s){_=(u-s)/l,S=[m.x-_*(m.x-f.x),m.y-_*(m.y-f.y)];break}var ft=e.unproject(O(S));return D([ft.lat+P.lat,ft.lng+P.lng])}var br={__proto__:null,simplify:no,pointToSegmentDistance:oo,closestPointOnSegment:_r,clipSegment:ro,_getEdgeIntersection:Qe,_getBitCode:Qt,_sqClosestPointOnSegment:Ae,isFlat:yt,_flat:ao,polylineCenter:lo},Ji={project:function(t){return new C(t.lng,t.lat)},unproject:function(t){return new U(t.y,t.x)},bounds:new F([-180,-90],[180,90])},Yi={R:6378137,R_MINOR:6356752314245179e-9,bounds:new F([-2003750834279e-5,-1549657073972e-5],[2003750834279e-5,1876465623138e-5]),project:function(t){var e=Math.PI/180,n=this.R,s=t.lat*e,l=this.R_MINOR/n,u=Math.sqrt(1-l*l),f=u*Math.sin(s),m=Math.tan(Math.PI/4-s/2)/Math.pow((1-f)/(1+f),u/2);return s=-n*Math.log(Math.max(m,1e-10)),new C(t.lng*e*n,s)},unproject:function(t){for(var e=180/Math.PI,n=this.R,s=this.R_MINOR/n,l=Math.sqrt(1-s*s),u=Math.exp(-t.y/n),f=Math.PI/2-2*Math.atan(u),m=0,_=.1,S;m<15&&Math.abs(_)>1e-7;m++)S=l*Math.sin(f),S=Math.pow((1-S)/(1+S),l/2),_=Math.PI/2-2*Math.atan(u*S)-f,f+=_;return new U(f*e,t.x*e/n)}},Sr={__proto__:null,LonLat:Ji,Mercator:Yi,SphericalMercator:Li},Lr=c({},Ht,{code:"EPSG:3395",projection:Yi,transformation:function(){var t=.5/(Math.PI*Yi.R);return ye(t,.5,-t,.5)}()}),co=c({},Ht,{code:"EPSG:4326",projection:Ji,transformation:ye(1/180,1,-1/180,.5)}),Er=c({},Ot,{projection:Ji,transformation:ye(1,0,-1,0),scale:function(t){return Math.pow(2,t)},zoom:function(t){return Math.log(t)/Math.LN2},distance:function(t,e){var n=e.lng-t.lng,s=e.lat-t.lat;return Math.sqrt(n*n+s*s)},infinite:!0});Ot.Earth=Ht,Ot.EPSG3395=Lr,Ot.EPSG3857=xi,Ot.EPSG900913=ks,Ot.EPSG4326=co,Ot.Simple=Er;var xt=Ut.extend({options:{pane:"overlayPane",attribution:null,bubblingMouseEvents:!0},addTo:function(t){return t.addLayer(this),this},remove:function(){return this.removeFrom(this._map||this._mapToAdd)},removeFrom:function(t){return t&&t.removeLayer(this),this},getPane:function(t){return this._map.getPane(t?this.options[t]||t:this.options.pane)},addInteractiveTarget:function(t){return this._map._targets[g(t)]=this,this},removeInteractiveTarget:function(t){return delete this._map._targets[g(t)],this},getAttribution:function(){return this.options.attribution},_layerAdd:function(t){var e=t.target;if(e.hasLayer(this)){if(this._map=e,this._zoomAnimated=e._zoomAnimated,this.getEvents){var n=this.getEvents();e.on(n,this),this.once("remove",function(){e.off(n,this)},this)}this.onAdd(e),this.fire("add"),e.fire("layeradd",{layer:this})}}});z.include({addLayer:function(t){if(!t._layerAdd)throw new Error("The provided object is not a Layer.");var e=g(t);return this._layers[e]?this:(this._layers[e]=t,t._mapToAdd=this,t.beforeAdd&&t.beforeAdd(this),this.whenReady(t._layerAdd,t),this)},removeLayer:function(t){var e=g(t);return this._layers[e]?(this._loaded&&t.onRemove(this),delete this._layers[e],this._loaded&&(this.fire("layerremove",{layer:t}),t.fire("remove")),t._map=t._mapToAdd=null,this):this},hasLayer:function(t){return g(t)in this._layers},eachLayer:function(t,e){for(var n in this._layers)t.call(e,this._layers[n]);return this},_addLayers:function(t){t=t?H(t)?t:[t]:[];for(var e=0,n=t.length;e<n;e++)this.addLayer(t[e])},_addZoomLimit:function(t){(!isNaN(t.options.maxZoom)||!isNaN(t.options.minZoom))&&(this._zoomBoundLayers[g(t)]=t,this._updateZoomLevels())},_removeZoomLimit:function(t){var e=g(t);this._zoomBoundLayers[e]&&(delete this._zoomBoundLayers[e],this._updateZoomLevels())},_updateZoomLevels:function(){var t=1/0,e=-1/0,n=this._getZoomSpan();for(var s in this._zoomBoundLayers){var l=this._zoomBoundLayers[s].options;t=l.minZoom===void 0?t:Math.min(t,l.minZoom),e=l.maxZoom===void 0?e:Math.max(e,l.maxZoom)}this._layersMaxZoom=e===-1/0?void 0:e,this._layersMinZoom=t===1/0?void 0:t,n!==this._getZoomSpan()&&this.fire("zoomlevelschange"),this.options.maxZoom===void 0&&this._layersMaxZoom&&this.getZoom()>this._layersMaxZoom&&this.setZoom(this._layersMaxZoom),this.options.minZoom===void 0&&this._layersMinZoom&&this.getZoom()<this._layersMinZoom&&this.setZoom(this._layersMinZoom)}});var ae=xt.extend({initialize:function(t,e){x(this,e),this._layers={};var n,s;if(t)for(n=0,s=t.length;n<s;n++)this.addLayer(t[n])},addLayer:function(t){var e=this.getLayerId(t);return this._layers[e]=t,this._map&&this._map.addLayer(t),this},removeLayer:function(t){var e=t in this._layers?t:this.getLayerId(t);return this._map&&this._layers[e]&&this._map.removeLayer(this._layers[e]),delete this._layers[e],this},hasLayer:function(t){var e=typeof t=="number"?t:this.getLayerId(t);return e in this._layers},clearLayers:function(){return this.eachLayer(this.removeLayer,this)},invoke:function(t){var e=Array.prototype.slice.call(arguments,1),n,s;for(n in this._layers)s=this._layers[n],s[t]&&s[t].apply(s,e);return this},onAdd:function(t){this.eachLayer(t.addLayer,t)},onRemove:function(t){this.eachLayer(t.removeLayer,t)},eachLayer:function(t,e){for(var n in this._layers)t.call(e,this._layers[n]);return this},getLayer:function(t){return this._layers[t]},getLayers:function(){var t=[];return this.eachLayer(t.push,t),t},setZIndex:function(t){return this.invoke("setZIndex",t)},getLayerId:function(t){return g(t)}}),xr=function(t,e){return new ae(t,e)},Mt=ae.extend({addLayer:function(t){return this.hasLayer(t)?this:(t.addEventParent(this),ae.prototype.addLayer.call(this,t),this.fire("layeradd",{layer:t}))},removeLayer:function(t){return this.hasLayer(t)?(t in this._layers&&(t=this._layers[t]),t.removeEventParent(this),ae.prototype.removeLayer.call(this,t),this.fire("layerremove",{layer:t})):this},setStyle:function(t){return this.invoke("setStyle",t)},bringToFront:function(){return this.invoke("bringToFront")},bringToBack:function(){return this.invoke("bringToBack")},getBounds:function(){var t=new it;for(var e in this._layers){var n=this._layers[e];t.extend(n.getBounds?n.getBounds():n.getLatLng())}return t}}),Pr=function(t,e){return new Mt(t,e)},le=rt.extend({options:{popupAnchor:[0,0],tooltipAnchor:[0,0],crossOrigin:!1},initialize:function(t){x(this,t)},createIcon:function(t){return this._createIcon("icon",t)},createShadow:function(t){return this._createIcon("shadow",t)},_createIcon:function(t,e){var n=this._getIconUrl(t);if(!n){if(t==="icon")throw new Error("iconUrl not set in Icon options (see the docs).");return null}var s=this._createImg(n,e&&e.tagName==="IMG"?e:null);return this._setIconStyles(s,t),(this.options.crossOrigin||this.options.crossOrigin==="")&&(s.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),s},_setIconStyles:function(t,e){var n=this.options,s=n[e+"Size"];typeof s=="number"&&(s=[s,s]);var l=O(s),u=O(e==="shadow"&&n.shadowAnchor||n.iconAnchor||l&&l.divideBy(2,!0));t.className="leaflet-marker-"+e+" "+(n.className||""),u&&(t.style.marginLeft=-u.x+"px",t.style.marginTop=-u.y+"px"),l&&(t.style.width=l.x+"px",t.style.height=l.y+"px")},_createImg:function(t,e){return e=e||document.createElement("img"),e.src=t,e},_getIconUrl:function(t){return A.retina&&this.options[t+"RetinaUrl"]||this.options[t+"Url"]}});function Tr(t){return new le(t)}var Ce=le.extend({options:{iconUrl:"marker-icon.png",iconRetinaUrl:"marker-icon-2x.png",shadowUrl:"marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],tooltipAnchor:[16,-28],shadowSize:[41,41]},_getIconUrl:function(t){return typeof Ce.imagePath!="string"&&(Ce.imagePath=this._detectIconPath()),(this.options.imagePath||Ce.imagePath)+le.prototype._getIconUrl.call(this,t)},_stripUrl:function(t){var e=function(n,s,l){var u=s.exec(n);return u&&u[l]};return t=e(t,/^url\((['"])?(.+)\1\)$/,2),t&&e(t,/^(.*)marker-icon\.png$/,1)},_detectIconPath:function(){var t=Z("div","leaflet-default-icon-path",document.body),e=Se(t,"background-image")||Se(t,"backgroundImage");if(document.body.removeChild(t),e=this._stripUrl(e),e)return e;var n=document.querySelector('link[href$="leaflet.css"]');return n?n.href.substring(0,n.href.length-11-1):""}}),uo=Ct.extend({initialize:function(t){this._marker=t},addHooks:function(){var t=this._marker._icon;this._draggable||(this._draggable=new qt(t,t,!0)),this._draggable.on({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).enable(),R(t,"leaflet-marker-draggable")},removeHooks:function(){this._draggable.off({dragstart:this._onDragStart,predrag:this._onPreDrag,drag:this._onDrag,dragend:this._onDragEnd},this).disable(),this._marker._icon&&Y(this._marker._icon,"leaflet-marker-draggable")},moved:function(){return this._draggable&&this._draggable._moved},_adjustPan:function(t){var e=this._marker,n=e._map,s=this._marker.options.autoPanSpeed,l=this._marker.options.autoPanPadding,u=Kt(e._icon),f=n.getPixelBounds(),m=n.getPixelOrigin(),_=J(f.min._subtract(m).add(l),f.max._subtract(m).subtract(l));if(!_.contains(u)){var S=O((Math.max(_.max.x,u.x)-_.max.x)/(f.max.x-_.max.x)-(Math.min(_.min.x,u.x)-_.min.x)/(f.min.x-_.min.x),(Math.max(_.max.y,u.y)-_.max.y)/(f.max.y-_.max.y)-(Math.min(_.min.y,u.y)-_.min.y)/(f.min.y-_.min.y)).multiplyBy(s);n.panBy(S,{animate:!1}),this._draggable._newPos._add(S),this._draggable._startPos._add(S),X(e._icon,this._draggable._newPos),this._onDrag(t),this._panRequest=ot(this._adjustPan.bind(this,t))}},_onDragStart:function(){this._oldLatLng=this._marker.getLatLng(),this._marker.closePopup&&this._marker.closePopup(),this._marker.fire("movestart").fire("dragstart")},_onPreDrag:function(t){this._marker.options.autoPan&&(st(this._panRequest),this._panRequest=ot(this._adjustPan.bind(this,t)))},_onDrag:function(t){var e=this._marker,n=e._shadow,s=Kt(e._icon),l=e._map.layerPointToLatLng(s);n&&X(n,s),e._latlng=l,t.latlng=l,t.oldLatLng=this._oldLatLng,e.fire("move",t).fire("drag",t)},_onDragEnd:function(t){st(this._panRequest),delete this._oldLatLng,this._marker.fire("moveend").fire("dragend",t)}}),Xe=xt.extend({options:{icon:new Ce,interactive:!0,keyboard:!0,title:"",alt:"Marker",zIndexOffset:0,opacity:1,riseOnHover:!1,riseOffset:250,pane:"markerPane",shadowPane:"shadowPane",bubblingMouseEvents:!1,autoPanOnFocus:!0,draggable:!1,autoPan:!1,autoPanPadding:[50,50],autoPanSpeed:10},initialize:function(t,e){x(this,e),this._latlng=D(t)},onAdd:function(t){this._zoomAnimated=this._zoomAnimated&&t.options.markerZoomAnimation,this._zoomAnimated&&t.on("zoomanim",this._animateZoom,this),this._initIcon(),this.update()},onRemove:function(t){this.dragging&&this.dragging.enabled()&&(this.options.draggable=!0,this.dragging.removeHooks()),delete this.dragging,this._zoomAnimated&&t.off("zoomanim",this._animateZoom,this),this._removeIcon(),this._removeShadow()},getEvents:function(){return{zoom:this.update,viewreset:this.update}},getLatLng:function(){return this._latlng},setLatLng:function(t){var e=this._latlng;return this._latlng=D(t),this.update(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},setZIndexOffset:function(t){return this.options.zIndexOffset=t,this.update()},getIcon:function(){return this.options.icon},setIcon:function(t){return this.options.icon=t,this._map&&(this._initIcon(),this.update()),this._popup&&this.bindPopup(this._popup,this._popup.options),this},getElement:function(){return this._icon},update:function(){if(this._icon&&this._map){var t=this._map.latLngToLayerPoint(this._latlng).round();this._setPos(t)}return this},_initIcon:function(){var t=this.options,e="leaflet-zoom-"+(this._zoomAnimated?"animated":"hide"),n=t.icon.createIcon(this._icon),s=!1;n!==this._icon&&(this._icon&&this._removeIcon(),s=!0,t.title&&(n.title=t.title),n.tagName==="IMG"&&(n.alt=t.alt||"")),R(n,e),t.keyboard&&(n.tabIndex="0",n.setAttribute("role","button")),this._icon=n,t.riseOnHover&&this.on({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&M(n,"focus",this._panOnFocus,this);var l=t.icon.createShadow(this._shadow),u=!1;l!==this._shadow&&(this._removeShadow(),u=!0),l&&(R(l,e),l.alt=""),this._shadow=l,t.opacity<1&&this._updateOpacity(),s&&this.getPane().appendChild(this._icon),this._initInteraction(),l&&u&&this.getPane(t.shadowPane).appendChild(this._shadow)},_removeIcon:function(){this.options.riseOnHover&&this.off({mouseover:this._bringToFront,mouseout:this._resetZIndex}),this.options.autoPanOnFocus&&q(this._icon,"focus",this._panOnFocus,this),G(this._icon),this.removeInteractiveTarget(this._icon),this._icon=null},_removeShadow:function(){this._shadow&&G(this._shadow),this._shadow=null},_setPos:function(t){this._icon&&X(this._icon,t),this._shadow&&X(this._shadow,t),this._zIndex=t.y+this.options.zIndexOffset,this._resetZIndex()},_updateZIndex:function(t){this._icon&&(this._icon.style.zIndex=this._zIndex+t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center).round();this._setPos(e)},_initInteraction:function(){if(this.options.interactive&&(R(this._icon,"leaflet-interactive"),this.addInteractiveTarget(this._icon),uo)){var t=this.options.draggable;this.dragging&&(t=this.dragging.enabled(),this.dragging.disable()),this.dragging=new uo(this),t&&this.dragging.enable()}},setOpacity:function(t){return this.options.opacity=t,this._map&&this._updateOpacity(),this},_updateOpacity:function(){var t=this.options.opacity;this._icon&&vt(this._icon,t),this._shadow&&vt(this._shadow,t)},_bringToFront:function(){this._updateZIndex(this.options.riseOffset)},_resetZIndex:function(){this._updateZIndex(0)},_panOnFocus:function(){var t=this._map;if(t){var e=this.options.icon.options,n=e.iconSize?O(e.iconSize):O(0,0),s=e.iconAnchor?O(e.iconAnchor):O(0,0);t.panInside(this._latlng,{paddingTopLeft:s,paddingBottomRight:n.subtract(s)})}},_getPopupAnchor:function(){return this.options.icon.options.popupAnchor},_getTooltipAnchor:function(){return this.options.icon.options.tooltipAnchor}});function Ar(t,e){return new Xe(t,e)}var Wt=xt.extend({options:{stroke:!0,color:"#3388ff",weight:3,opacity:1,lineCap:"round",lineJoin:"round",dashArray:null,dashOffset:null,fill:!1,fillColor:null,fillOpacity:.2,fillRule:"evenodd",interactive:!0,bubblingMouseEvents:!0},beforeAdd:function(t){this._renderer=t.getRenderer(this)},onAdd:function(){this._renderer._initPath(this),this._reset(),this._renderer._addPath(this)},onRemove:function(){this._renderer._removePath(this)},redraw:function(){return this._map&&this._renderer._updatePath(this),this},setStyle:function(t){return x(this,t),this._renderer&&(this._renderer._updateStyle(this),this.options.stroke&&t&&Object.prototype.hasOwnProperty.call(t,"weight")&&this._updateBounds()),this},bringToFront:function(){return this._renderer&&this._renderer._bringToFront(this),this},bringToBack:function(){return this._renderer&&this._renderer._bringToBack(this),this},getElement:function(){return this._path},_reset:function(){this._project(),this._update()},_clickTolerance:function(){return(this.options.stroke?this.options.weight/2:0)+(this._renderer.options.tolerance||0)}}),ti=Wt.extend({options:{fill:!0,radius:10},initialize:function(t,e){x(this,e),this._latlng=D(t),this._radius=this.options.radius},setLatLng:function(t){var e=this._latlng;return this._latlng=D(t),this.redraw(),this.fire("move",{oldLatLng:e,latlng:this._latlng})},getLatLng:function(){return this._latlng},setRadius:function(t){return this.options.radius=this._radius=t,this.redraw()},getRadius:function(){return this._radius},setStyle:function(t){var e=t&&t.radius||this._radius;return Wt.prototype.setStyle.call(this,t),this.setRadius(e),this},_project:function(){this._point=this._map.latLngToLayerPoint(this._latlng),this._updateBounds()},_updateBounds:function(){var t=this._radius,e=this._radiusY||t,n=this._clickTolerance(),s=[t+n,e+n];this._pxBounds=new F(this._point.subtract(s),this._point.add(s))},_update:function(){this._map&&this._updatePath()},_updatePath:function(){this._renderer._updateCircle(this)},_empty:function(){return this._radius&&!this._renderer._bounds.intersects(this._pxBounds)},_containsPoint:function(t){return t.distanceTo(this._point)<=this._radius+this._clickTolerance()}});function Cr(t,e){return new ti(t,e)}var Qi=ti.extend({initialize:function(t,e,n){if(typeof e=="number"&&(e=c({},n,{radius:e})),x(this,e),this._latlng=D(t),isNaN(this.options.radius))throw new Error("Circle radius cannot be NaN");this._mRadius=this.options.radius},setRadius:function(t){return this._mRadius=t,this.redraw()},getRadius:function(){return this._mRadius},getBounds:function(){var t=[this._radius,this._radiusY||this._radius];return new it(this._map.layerPointToLatLng(this._point.subtract(t)),this._map.layerPointToLatLng(this._point.add(t)))},setStyle:Wt.prototype.setStyle,_project:function(){var t=this._latlng.lng,e=this._latlng.lat,n=this._map,s=n.options.crs;if(s.distance===Ht.distance){var l=Math.PI/180,u=this._mRadius/Ht.R/l,f=n.project([e+u,t]),m=n.project([e-u,t]),_=f.add(m).divideBy(2),S=n.unproject(_).lat,P=Math.acos((Math.cos(u*l)-Math.sin(e*l)*Math.sin(S*l))/(Math.cos(e*l)*Math.cos(S*l)))/l;(isNaN(P)||P===0)&&(P=u/Math.cos(Math.PI/180*e)),this._point=_.subtract(n.getPixelOrigin()),this._radius=isNaN(P)?0:_.x-n.project([S,t-P]).x,this._radiusY=_.y-f.y}else{var k=s.unproject(s.project(this._latlng).subtract([this._mRadius,0]));this._point=n.latLngToLayerPoint(this._latlng),this._radius=this._point.x-n.latLngToLayerPoint(k).x}this._updateBounds()}});function kr(t,e,n){return new Qi(t,e,n)}var Bt=Wt.extend({options:{smoothFactor:1,noClip:!1},initialize:function(t,e){x(this,e),this._setLatLngs(t)},getLatLngs:function(){return this._latlngs},setLatLngs:function(t){return this._setLatLngs(t),this.redraw()},isEmpty:function(){return!this._latlngs.length},closestLayerPoint:function(t){for(var e=1/0,n=null,s=Ae,l,u,f=0,m=this._parts.length;f<m;f++)for(var _=this._parts[f],S=1,P=_.length;S<P;S++){l=_[S-1],u=_[S];var k=s(t,l,u,!0);k<e&&(e=k,n=s(t,l,u))}return n&&(n.distance=Math.sqrt(e)),n},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return lo(this._defaultShape(),this._map.options.crs)},getBounds:function(){return this._bounds},addLatLng:function(t,e){return e=e||this._defaultShape(),t=D(t),e.push(t),this._bounds.extend(t),this.redraw()},_setLatLngs:function(t){this._bounds=new it,this._latlngs=this._convertLatLngs(t)},_defaultShape:function(){return yt(this._latlngs)?this._latlngs:this._latlngs[0]},_convertLatLngs:function(t){for(var e=[],n=yt(t),s=0,l=t.length;s<l;s++)n?(e[s]=D(t[s]),this._bounds.extend(e[s])):e[s]=this._convertLatLngs(t[s]);return e},_project:function(){var t=new F;this._rings=[],this._projectLatlngs(this._latlngs,this._rings,t),this._bounds.isValid()&&t.isValid()&&(this._rawPxBounds=t,this._updateBounds())},_updateBounds:function(){var t=this._clickTolerance(),e=new C(t,t);this._rawPxBounds&&(this._pxBounds=new F([this._rawPxBounds.min.subtract(e),this._rawPxBounds.max.add(e)]))},_projectLatlngs:function(t,e,n){var s=t[0]instanceof U,l=t.length,u,f;if(s){for(f=[],u=0;u<l;u++)f[u]=this._map.latLngToLayerPoint(t[u]),n.extend(f[u]);e.push(f)}else for(u=0;u<l;u++)this._projectLatlngs(t[u],e,n)},_clipPoints:function(){var t=this._renderer._bounds;if(this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(t))){if(this.options.noClip){this._parts=this._rings;return}var e=this._parts,n,s,l,u,f,m,_;for(n=0,l=0,u=this._rings.length;n<u;n++)for(_=this._rings[n],s=0,f=_.length;s<f-1;s++)m=ro(_[s],_[s+1],t,s,!0),m&&(e[l]=e[l]||[],e[l].push(m[0]),(m[1]!==_[s+1]||s===f-2)&&(e[l].push(m[1]),l++))}},_simplifyPoints:function(){for(var t=this._parts,e=this.options.smoothFactor,n=0,s=t.length;n<s;n++)t[n]=no(t[n],e)},_update:function(){this._map&&(this._clipPoints(),this._simplifyPoints(),this._updatePath())},_updatePath:function(){this._renderer._updatePoly(this)},_containsPoint:function(t,e){var n,s,l,u,f,m,_=this._clickTolerance();if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(n=0,u=this._parts.length;n<u;n++)for(m=this._parts[n],s=0,f=m.length,l=f-1;s<f;l=s++)if(!(!e&&s===0)&&oo(t,m[l],m[s])<=_)return!0;return!1}});function Ir(t,e){return new Bt(t,e)}Bt._flat=ao;var ce=Bt.extend({options:{fill:!0},isEmpty:function(){return!this._latlngs.length||!this._latlngs[0].length},getCenter:function(){if(!this._map)throw new Error("Must add layer to map before using getCenter()");return io(this._defaultShape(),this._map.options.crs)},_convertLatLngs:function(t){var e=Bt.prototype._convertLatLngs.call(this,t),n=e.length;return n>=2&&e[0]instanceof U&&e[0].equals(e[n-1])&&e.pop(),e},_setLatLngs:function(t){Bt.prototype._setLatLngs.call(this,t),yt(this._latlngs)&&(this._latlngs=[this._latlngs])},_defaultShape:function(){return yt(this._latlngs[0])?this._latlngs[0]:this._latlngs[0][0]},_clipPoints:function(){var t=this._renderer._bounds,e=this.options.weight,n=new C(e,e);if(t=new F(t.min.subtract(n),t.max.add(n)),this._parts=[],!(!this._pxBounds||!this._pxBounds.intersects(t))){if(this.options.noClip){this._parts=this._rings;return}for(var s=0,l=this._rings.length,u;s<l;s++)u=eo(this._rings[s],t,!0),u.length&&this._parts.push(u)}},_updatePath:function(){this._renderer._updatePoly(this,!0)},_containsPoint:function(t){var e=!1,n,s,l,u,f,m,_,S;if(!this._pxBounds||!this._pxBounds.contains(t))return!1;for(u=0,_=this._parts.length;u<_;u++)for(n=this._parts[u],f=0,S=n.length,m=S-1;f<S;m=f++)s=n[f],l=n[m],s.y>t.y!=l.y>t.y&&t.x<(l.x-s.x)*(t.y-s.y)/(l.y-s.y)+s.x&&(e=!e);return e||Bt.prototype._containsPoint.call(this,t,!0)}});function Or(t,e){return new ce(t,e)}var Rt=Mt.extend({initialize:function(t,e){x(this,e),this._layers={},t&&this.addData(t)},addData:function(t){var e=H(t)?t:t.features,n,s,l;if(e){for(n=0,s=e.length;n<s;n++)l=e[n],(l.geometries||l.geometry||l.features||l.coordinates)&&this.addData(l);return this}var u=this.options;if(u.filter&&!u.filter(t))return this;var f=ei(t,u);return f?(f.feature=oi(t),f.defaultOptions=f.options,this.resetStyle(f),u.onEachFeature&&u.onEachFeature(t,f),this.addLayer(f)):this},resetStyle:function(t){return t===void 0?this.eachLayer(this.resetStyle,this):(t.options=c({},t.defaultOptions),this._setLayerStyle(t,this.options.style),this)},setStyle:function(t){return this.eachLayer(function(e){this._setLayerStyle(e,t)},this)},_setLayerStyle:function(t,e){t.setStyle&&(typeof e=="function"&&(e=e(t.feature)),t.setStyle(e))}});function ei(t,e){var n=t.type==="Feature"?t.geometry:t,s=n?n.coordinates:null,l=[],u=e&&e.pointToLayer,f=e&&e.coordsToLatLng||Xi,m,_,S,P;if(!s&&!n)return null;switch(n.type){case"Point":return m=f(s),ho(u,t,m,e);case"MultiPoint":for(S=0,P=s.length;S<P;S++)m=f(s[S]),l.push(ho(u,t,m,e));return new Mt(l);case"LineString":case"MultiLineString":return _=ii(s,n.type==="LineString"?0:1,f),new Bt(_,e);case"Polygon":case"MultiPolygon":return _=ii(s,n.type==="Polygon"?1:2,f),new ce(_,e);case"GeometryCollection":for(S=0,P=n.geometries.length;S<P;S++){var k=ei({geometry:n.geometries[S],type:"Feature",properties:t.properties},e);k&&l.push(k)}return new Mt(l);case"FeatureCollection":for(S=0,P=n.features.length;S<P;S++){var N=ei(n.features[S],e);N&&l.push(N)}return new Mt(l);default:throw new Error("Invalid GeoJSON object.")}}function ho(t,e,n,s){return t?t(e,n):new Xe(n,s&&s.markersInheritOptions&&s)}function Xi(t){return new U(t[1],t[0],t[2])}function ii(t,e,n){for(var s=[],l=0,u=t.length,f;l<u;l++)f=e?ii(t[l],e-1,n):(n||Xi)(t[l]),s.push(f);return s}function tn(t,e){return t=D(t),t.alt!==void 0?[I(t.lng,e),I(t.lat,e),I(t.alt,e)]:[I(t.lng,e),I(t.lat,e)]}function ni(t,e,n,s){for(var l=[],u=0,f=t.length;u<f;u++)l.push(e?ni(t[u],yt(t[u])?0:e-1,n,s):tn(t[u],s));return!e&&n&&l.length>0&&l.push(l[0].slice()),l}function ue(t,e){return t.feature?c({},t.feature,{geometry:e}):oi(e)}function oi(t){return t.type==="Feature"||t.type==="FeatureCollection"?t:{type:"Feature",properties:{},geometry:t}}var en={toGeoJSON:function(t){return ue(this,{type:"Point",coordinates:tn(this.getLatLng(),t)})}};Xe.include(en),Qi.include(en),ti.include(en),Bt.include({toGeoJSON:function(t){var e=!yt(this._latlngs),n=ni(this._latlngs,e?1:0,!1,t);return ue(this,{type:(e?"Multi":"")+"LineString",coordinates:n})}}),ce.include({toGeoJSON:function(t){var e=!yt(this._latlngs),n=e&&!yt(this._latlngs[0]),s=ni(this._latlngs,n?2:e?1:0,!0,t);return e||(s=[s]),ue(this,{type:(n?"Multi":"")+"Polygon",coordinates:s})}}),ae.include({toMultiPoint:function(t){var e=[];return this.eachLayer(function(n){e.push(n.toGeoJSON(t).geometry.coordinates)}),ue(this,{type:"MultiPoint",coordinates:e})},toGeoJSON:function(t){var e=this.feature&&this.feature.geometry&&this.feature.geometry.type;if(e==="MultiPoint")return this.toMultiPoint(t);var n=e==="GeometryCollection",s=[];return this.eachLayer(function(l){if(l.toGeoJSON){var u=l.toGeoJSON(t);if(n)s.push(u.geometry);else{var f=oi(u);f.type==="FeatureCollection"?s.push.apply(s,f.features):s.push(f)}}}),n?ue(this,{geometries:s,type:"GeometryCollection"}):{type:"FeatureCollection",features:s}}});function fo(t,e){return new Rt(t,e)}var Mr=fo,si=xt.extend({options:{opacity:1,alt:"",interactive:!1,crossOrigin:!1,errorOverlayUrl:"",zIndex:1,className:""},initialize:function(t,e,n){this._url=t,this._bounds=W(e),x(this,n)},onAdd:function(){this._image||(this._initImage(),this.options.opacity<1&&this._updateOpacity()),this.options.interactive&&(R(this._image,"leaflet-interactive"),this.addInteractiveTarget(this._image)),this.getPane().appendChild(this._image),this._reset()},onRemove:function(){G(this._image),this.options.interactive&&this.removeInteractiveTarget(this._image)},setOpacity:function(t){return this.options.opacity=t,this._image&&this._updateOpacity(),this},setStyle:function(t){return t.opacity&&this.setOpacity(t.opacity),this},bringToFront:function(){return this._map&&se(this._image),this},bringToBack:function(){return this._map&&re(this._image),this},setUrl:function(t){return this._url=t,this._image&&(this._image.src=t),this},setBounds:function(t){return this._bounds=W(t),this._map&&this._reset(),this},getEvents:function(){var t={zoom:this._reset,viewreset:this._reset};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},getBounds:function(){return this._bounds},getElement:function(){return this._image},_initImage:function(){var t=this._url.tagName==="IMG",e=this._image=t?this._url:Z("img");if(R(e,"leaflet-image-layer"),this._zoomAnimated&&R(e,"leaflet-zoom-animated"),this.options.className&&R(e,this.options.className),e.onselectstart=b,e.onmousemove=b,e.onload=h(this.fire,this,"load"),e.onerror=h(this._overlayOnError,this,"error"),(this.options.crossOrigin||this.options.crossOrigin==="")&&(e.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),this.options.zIndex&&this._updateZIndex(),t){this._url=e.src;return}e.src=this._url,e.alt=this.options.alt},_animateZoom:function(t){var e=this._map.getZoomScale(t.zoom),n=this._map._latLngBoundsToNewLayerBounds(this._bounds,t.zoom,t.center).min;Gt(this._image,n,e)},_reset:function(){var t=this._image,e=new F(this._map.latLngToLayerPoint(this._bounds.getNorthWest()),this._map.latLngToLayerPoint(this._bounds.getSouthEast())),n=e.getSize();X(t,e.min),t.style.width=n.x+"px",t.style.height=n.y+"px"},_updateOpacity:function(){vt(this._image,this.options.opacity)},_updateZIndex:function(){this._image&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._image.style.zIndex=this.options.zIndex)},_overlayOnError:function(){this.fire("error");var t=this.options.errorOverlayUrl;t&&this._url!==t&&(this._url=t,this._image.src=t)},getCenter:function(){return this._bounds.getCenter()}}),Br=function(t,e,n){return new si(t,e,n)},po=si.extend({options:{autoplay:!0,loop:!0,keepAspectRatio:!0,muted:!1,playsInline:!0},_initImage:function(){var t=this._url.tagName==="VIDEO",e=this._image=t?this._url:Z("video");if(R(e,"leaflet-image-layer"),this._zoomAnimated&&R(e,"leaflet-zoom-animated"),this.options.className&&R(e,this.options.className),e.onselectstart=b,e.onmousemove=b,e.onloadeddata=h(this.fire,this,"load"),t){for(var n=e.getElementsByTagName("source"),s=[],l=0;l<n.length;l++)s.push(n[l].src);this._url=n.length>0?s:[e.src];return}H(this._url)||(this._url=[this._url]),!this.options.keepAspectRatio&&Object.prototype.hasOwnProperty.call(e.style,"objectFit")&&(e.style.objectFit="fill"),e.autoplay=!!this.options.autoplay,e.loop=!!this.options.loop,e.muted=!!this.options.muted,e.playsInline=!!this.options.playsInline;for(var u=0;u<this._url.length;u++){var f=Z("source");f.src=this._url[u],e.appendChild(f)}}});function Rr(t,e,n){return new po(t,e,n)}var mo=si.extend({_initImage:function(){var t=this._image=this._url;R(t,"leaflet-image-layer"),this._zoomAnimated&&R(t,"leaflet-zoom-animated"),this.options.className&&R(t,this.options.className),t.onselectstart=b,t.onmousemove=b}});function Nr(t,e,n){return new mo(t,e,n)}var kt=xt.extend({options:{interactive:!1,offset:[0,0],className:"",pane:void 0,content:""},initialize:function(t,e){t&&(t instanceof U||H(t))?(this._latlng=D(t),x(this,e)):(x(this,t),this._source=e),this.options.content&&(this._content=this.options.content)},openOn:function(t){return t=arguments.length?t:this._source._map,t.hasLayer(this)||t.addLayer(this),this},close:function(){return this._map&&this._map.removeLayer(this),this},toggle:function(t){return this._map?this.close():(arguments.length?this._source=t:t=this._source,this._prepareOpen(),this.openOn(t._map)),this},onAdd:function(t){this._zoomAnimated=t._zoomAnimated,this._container||this._initLayout(),t._fadeAnimated&&vt(this._container,0),clearTimeout(this._removeTimeout),this.getPane().appendChild(this._container),this.update(),t._fadeAnimated&&vt(this._container,1),this.bringToFront(),this.options.interactive&&(R(this._container,"leaflet-interactive"),this.addInteractiveTarget(this._container))},onRemove:function(t){t._fadeAnimated?(vt(this._container,0),this._removeTimeout=setTimeout(h(G,void 0,this._container),200)):G(this._container),this.options.interactive&&(Y(this._container,"leaflet-interactive"),this.removeInteractiveTarget(this._container))},getLatLng:function(){return this._latlng},setLatLng:function(t){return this._latlng=D(t),this._map&&(this._updatePosition(),this._adjustPan()),this},getContent:function(){return this._content},setContent:function(t){return this._content=t,this.update(),this},getElement:function(){return this._container},update:function(){this._map&&(this._container.style.visibility="hidden",this._updateContent(),this._updateLayout(),this._updatePosition(),this._container.style.visibility="",this._adjustPan())},getEvents:function(){var t={zoom:this._updatePosition,viewreset:this._updatePosition};return this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},isOpen:function(){return!!this._map&&this._map.hasLayer(this)},bringToFront:function(){return this._map&&se(this._container),this},bringToBack:function(){return this._map&&re(this._container),this},_prepareOpen:function(t){var e=this._source;if(!e._map)return!1;if(e instanceof Mt){e=null;var n=this._source._layers;for(var s in n)if(n[s]._map){e=n[s];break}if(!e)return!1;this._source=e}if(!t)if(e.getCenter)t=e.getCenter();else if(e.getLatLng)t=e.getLatLng();else if(e.getBounds)t=e.getBounds().getCenter();else throw new Error("Unable to get source layer LatLng.");return this.setLatLng(t),this._map&&this.update(),!0},_updateContent:function(){if(this._content){var t=this._contentNode,e=typeof this._content=="function"?this._content(this._source||this):this._content;if(typeof e=="string")t.innerHTML=e;else{for(;t.hasChildNodes();)t.removeChild(t.firstChild);t.appendChild(e)}this.fire("contentupdate")}},_updatePosition:function(){if(this._map){var t=this._map.latLngToLayerPoint(this._latlng),e=O(this.options.offset),n=this._getAnchor();this._zoomAnimated?X(this._container,t.add(n)):e=e.add(t).add(n);var s=this._containerBottom=-e.y,l=this._containerLeft=-Math.round(this._containerWidth/2)+e.x;this._container.style.bottom=s+"px",this._container.style.left=l+"px"}},_getAnchor:function(){return[0,0]}});z.include({_initOverlay:function(t,e,n,s){var l=e;return l instanceof t||(l=new t(s).setContent(e)),n&&l.setLatLng(n),l}}),xt.include({_initOverlay:function(t,e,n,s){var l=n;return l instanceof t?(x(l,s),l._source=this):(l=e&&!s?e:new t(s,this),l.setContent(n)),l}});var ri=kt.extend({options:{pane:"popupPane",offset:[0,7],maxWidth:300,minWidth:50,maxHeight:null,autoPan:!0,autoPanPaddingTopLeft:null,autoPanPaddingBottomRight:null,autoPanPadding:[5,5],keepInView:!1,closeButton:!0,autoClose:!0,closeOnEscapeKey:!0,className:""},openOn:function(t){return t=arguments.length?t:this._source._map,!t.hasLayer(this)&&t._popup&&t._popup.options.autoClose&&t.removeLayer(t._popup),t._popup=this,kt.prototype.openOn.call(this,t)},onAdd:function(t){kt.prototype.onAdd.call(this,t),t.fire("popupopen",{popup:this}),this._source&&(this._source.fire("popupopen",{popup:this},!0),this._source instanceof Wt||this._source.on("preclick",Jt))},onRemove:function(t){kt.prototype.onRemove.call(this,t),t.fire("popupclose",{popup:this}),this._source&&(this._source.fire("popupclose",{popup:this},!0),this._source instanceof Wt||this._source.off("preclick",Jt))},getEvents:function(){var t=kt.prototype.getEvents.call(this);return(this.options.closeOnClick!==void 0?this.options.closeOnClick:this._map.options.closePopupOnClick)&&(t.preclick=this.close),this.options.keepInView&&(t.moveend=this._adjustPan),t},_initLayout:function(){var t="leaflet-popup",e=this._container=Z("div",t+" "+(this.options.className||"")+" leaflet-zoom-animated"),n=this._wrapper=Z("div",t+"-content-wrapper",e);if(this._contentNode=Z("div",t+"-content",n),Pe(e),Wi(this._contentNode),M(e,"contextmenu",Jt),this._tipContainer=Z("div",t+"-tip-container",e),this._tip=Z("div",t+"-tip",this._tipContainer),this.options.closeButton){var s=this._closeButton=Z("a",t+"-close-button",e);s.setAttribute("role","button"),s.setAttribute("aria-label","Close popup"),s.href="#close",s.innerHTML='<span aria-hidden="true">&#215;</span>',M(s,"click",function(l){at(l),this.close()},this)}},_updateLayout:function(){var t=this._contentNode,e=t.style;e.width="",e.whiteSpace="nowrap";var n=t.offsetWidth;n=Math.min(n,this.options.maxWidth),n=Math.max(n,this.options.minWidth),e.width=n+1+"px",e.whiteSpace="",e.height="";var s=t.offsetHeight,l=this.options.maxHeight,u="leaflet-popup-scrolled";l&&s>l?(e.height=l+"px",R(t,u)):Y(t,u),this._containerWidth=this._container.offsetWidth},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center),n=this._getAnchor();X(this._container,e.add(n))},_adjustPan:function(){if(this.options.autoPan){if(this._map._panAnim&&this._map._panAnim.stop(),this._autopanning){this._autopanning=!1;return}var t=this._map,e=parseInt(Se(this._container,"marginBottom"),10)||0,n=this._container.offsetHeight+e,s=this._containerWidth,l=new C(this._containerLeft,-n-this._containerBottom);l._add(Kt(this._container));var u=t.layerPointToContainerPoint(l),f=O(this.options.autoPanPadding),m=O(this.options.autoPanPaddingTopLeft||f),_=O(this.options.autoPanPaddingBottomRight||f),S=t.getSize(),P=0,k=0;u.x+s+_.x>S.x&&(P=u.x+s-S.x+_.x),u.x-P-m.x<0&&(P=u.x-m.x),u.y+n+_.y>S.y&&(k=u.y+n-S.y+_.y),u.y-k-m.y<0&&(k=u.y-m.y),(P||k)&&(this.options.keepInView&&(this._autopanning=!0),t.fire("autopanstart").panBy([P,k]))}},_getAnchor:function(){return O(this._source&&this._source._getPopupAnchor?this._source._getPopupAnchor():[0,0])}}),Dr=function(t,e){return new ri(t,e)};z.mergeOptions({closePopupOnClick:!0}),z.include({openPopup:function(t,e,n){return this._initOverlay(ri,t,e,n).openOn(this),this},closePopup:function(t){return t=arguments.length?t:this._popup,t&&t.close(),this}}),xt.include({bindPopup:function(t,e){return this._popup=this._initOverlay(ri,this._popup,t,e),this._popupHandlersAdded||(this.on({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!0),this},unbindPopup:function(){return this._popup&&(this.off({click:this._openPopup,keypress:this._onKeyPress,remove:this.closePopup,move:this._movePopup}),this._popupHandlersAdded=!1,this._popup=null),this},openPopup:function(t){return this._popup&&(this instanceof Mt||(this._popup._source=this),this._popup._prepareOpen(t||this._latlng)&&this._popup.openOn(this._map)),this},closePopup:function(){return this._popup&&this._popup.close(),this},togglePopup:function(){return this._popup&&this._popup.toggle(this),this},isPopupOpen:function(){return this._popup?this._popup.isOpen():!1},setPopupContent:function(t){return this._popup&&this._popup.setContent(t),this},getPopup:function(){return this._popup},_openPopup:function(t){if(!(!this._popup||!this._map)){Yt(t);var e=t.layer||t.target;if(this._popup._source===e&&!(e instanceof Wt)){this._map.hasLayer(this._popup)?this.closePopup():this.openPopup(t.latlng);return}this._popup._source=e,this.openPopup(t.latlng)}},_movePopup:function(t){this._popup.setLatLng(t.latlng)},_onKeyPress:function(t){t.originalEvent.keyCode===13&&this._openPopup(t)}});var ai=kt.extend({options:{pane:"tooltipPane",offset:[0,0],direction:"auto",permanent:!1,sticky:!1,opacity:.9},onAdd:function(t){kt.prototype.onAdd.call(this,t),this.setOpacity(this.options.opacity),t.fire("tooltipopen",{tooltip:this}),this._source&&(this.addEventParent(this._source),this._source.fire("tooltipopen",{tooltip:this},!0))},onRemove:function(t){kt.prototype.onRemove.call(this,t),t.fire("tooltipclose",{tooltip:this}),this._source&&(this.removeEventParent(this._source),this._source.fire("tooltipclose",{tooltip:this},!0))},getEvents:function(){var t=kt.prototype.getEvents.call(this);return this.options.permanent||(t.preclick=this.close),t},_initLayout:function(){var t="leaflet-tooltip",e=t+" "+(this.options.className||"")+" leaflet-zoom-"+(this._zoomAnimated?"animated":"hide");this._contentNode=this._container=Z("div",e),this._container.setAttribute("role","tooltip"),this._container.setAttribute("id","leaflet-tooltip-"+g(this))},_updateLayout:function(){},_adjustPan:function(){},_setPosition:function(t){var e,n,s=this._map,l=this._container,u=s.latLngToContainerPoint(s.getCenter()),f=s.layerPointToContainerPoint(t),m=this.options.direction,_=l.offsetWidth,S=l.offsetHeight,P=O(this.options.offset),k=this._getAnchor();m==="top"?(e=_/2,n=S):m==="bottom"?(e=_/2,n=0):m==="center"?(e=_/2,n=S/2):m==="right"?(e=0,n=S/2):m==="left"?(e=_,n=S/2):f.x<u.x?(m="right",e=0,n=S/2):(m="left",e=_+(P.x+k.x)*2,n=S/2),t=t.subtract(O(e,n,!0)).add(P).add(k),Y(l,"leaflet-tooltip-right"),Y(l,"leaflet-tooltip-left"),Y(l,"leaflet-tooltip-top"),Y(l,"leaflet-tooltip-bottom"),R(l,"leaflet-tooltip-"+m),X(l,t)},_updatePosition:function(){var t=this._map.latLngToLayerPoint(this._latlng);this._setPosition(t)},setOpacity:function(t){this.options.opacity=t,this._container&&vt(this._container,t)},_animateZoom:function(t){var e=this._map._latLngToNewLayerPoint(this._latlng,t.zoom,t.center);this._setPosition(e)},_getAnchor:function(){return O(this._source&&this._source._getTooltipAnchor&&!this.options.sticky?this._source._getTooltipAnchor():[0,0])}}),zr=function(t,e){return new ai(t,e)};z.include({openTooltip:function(t,e,n){return this._initOverlay(ai,t,e,n).openOn(this),this},closeTooltip:function(t){return t.close(),this}}),xt.include({bindTooltip:function(t,e){return this._tooltip&&this.isTooltipOpen()&&this.unbindTooltip(),this._tooltip=this._initOverlay(ai,this._tooltip,t,e),this._initTooltipInteractions(),this._tooltip.options.permanent&&this._map&&this._map.hasLayer(this)&&this.openTooltip(),this},unbindTooltip:function(){return this._tooltip&&(this._initTooltipInteractions(!0),this.closeTooltip(),this._tooltip=null),this},_initTooltipInteractions:function(t){if(!(!t&&this._tooltipHandlersAdded)){var e=t?"off":"on",n={remove:this.closeTooltip,move:this._moveTooltip};this._tooltip.options.permanent?n.add=this._openTooltip:(n.mouseover=this._openTooltip,n.mouseout=this.closeTooltip,n.click=this._openTooltip,this._map?this._addFocusListeners():n.add=this._addFocusListeners),this._tooltip.options.sticky&&(n.mousemove=this._moveTooltip),this[e](n),this._tooltipHandlersAdded=!t}},openTooltip:function(t){return this._tooltip&&(this instanceof Mt||(this._tooltip._source=this),this._tooltip._prepareOpen(t)&&(this._tooltip.openOn(this._map),this.getElement?this._setAriaDescribedByOnLayer(this):this.eachLayer&&this.eachLayer(this._setAriaDescribedByOnLayer,this))),this},closeTooltip:function(){if(this._tooltip)return this._tooltip.close()},toggleTooltip:function(){return this._tooltip&&this._tooltip.toggle(this),this},isTooltipOpen:function(){return this._tooltip.isOpen()},setTooltipContent:function(t){return this._tooltip&&this._tooltip.setContent(t),this},getTooltip:function(){return this._tooltip},_addFocusListeners:function(){this.getElement?this._addFocusListenersOnLayer(this):this.eachLayer&&this.eachLayer(this._addFocusListenersOnLayer,this)},_addFocusListenersOnLayer:function(t){var e=typeof t.getElement=="function"&&t.getElement();e&&(M(e,"focus",function(){this._tooltip._source=t,this.openTooltip()},this),M(e,"blur",this.closeTooltip,this))},_setAriaDescribedByOnLayer:function(t){var e=typeof t.getElement=="function"&&t.getElement();e&&e.setAttribute("aria-describedby",this._tooltip._container.id)},_openTooltip:function(t){if(!(!this._tooltip||!this._map)){if(this._map.dragging&&this._map.dragging.moving()&&!this._openOnceFlag){this._openOnceFlag=!0;var e=this;this._map.once("moveend",function(){e._openOnceFlag=!1,e._openTooltip(t)});return}this._tooltip._source=t.layer||t.target,this.openTooltip(this._tooltip.options.sticky?t.latlng:void 0)}},_moveTooltip:function(t){var e=t.latlng,n,s;this._tooltip.options.sticky&&t.originalEvent&&(n=this._map.mouseEventToContainerPoint(t.originalEvent),s=this._map.containerPointToLayerPoint(n),e=this._map.layerPointToLatLng(s)),this._tooltip.setLatLng(e)}});var go=le.extend({options:{iconSize:[12,12],html:!1,bgPos:null,className:"leaflet-div-icon"},createIcon:function(t){var e=t&&t.tagName==="DIV"?t:document.createElement("div"),n=this.options;if(n.html instanceof Element?(Ve(e),e.appendChild(n.html)):e.innerHTML=n.html!==!1?n.html:"",n.bgPos){var s=O(n.bgPos);e.style.backgroundPosition=-s.x+"px "+-s.y+"px"}return this._setIconStyles(e,"icon"),e},createShadow:function(){return null}});function Fr(t){return new go(t)}le.Default=Ce;var ke=xt.extend({options:{tileSize:256,opacity:1,updateWhenIdle:A.mobile,updateWhenZooming:!0,updateInterval:200,zIndex:1,bounds:null,minZoom:0,maxZoom:void 0,maxNativeZoom:void 0,minNativeZoom:void 0,noWrap:!1,pane:"tilePane",className:"",keepBuffer:2},initialize:function(t){x(this,t)},onAdd:function(){this._initContainer(),this._levels={},this._tiles={},this._resetView()},beforeAdd:function(t){t._addZoomLimit(this)},onRemove:function(t){this._removeAllTiles(),G(this._container),t._removeZoomLimit(this),this._container=null,this._tileZoom=void 0},bringToFront:function(){return this._map&&(se(this._container),this._setAutoZIndex(Math.max)),this},bringToBack:function(){return this._map&&(re(this._container),this._setAutoZIndex(Math.min)),this},getContainer:function(){return this._container},setOpacity:function(t){return this.options.opacity=t,this._updateOpacity(),this},setZIndex:function(t){return this.options.zIndex=t,this._updateZIndex(),this},isLoading:function(){return this._loading},redraw:function(){if(this._map){this._removeAllTiles();var t=this._clampZoom(this._map.getZoom());t!==this._tileZoom&&(this._tileZoom=t,this._updateLevels()),this._update()}return this},getEvents:function(){var t={viewprereset:this._invalidateAll,viewreset:this._resetView,zoom:this._resetView,moveend:this._onMoveEnd};return this.options.updateWhenIdle||(this._onMove||(this._onMove=w(this._onMoveEnd,this.options.updateInterval,this)),t.move=this._onMove),this._zoomAnimated&&(t.zoomanim=this._animateZoom),t},createTile:function(){return document.createElement("div")},getTileSize:function(){var t=this.options.tileSize;return t instanceof C?t:new C(t,t)},_updateZIndex:function(){this._container&&this.options.zIndex!==void 0&&this.options.zIndex!==null&&(this._container.style.zIndex=this.options.zIndex)},_setAutoZIndex:function(t){for(var e=this.getPane().children,n=-t(-1/0,1/0),s=0,l=e.length,u;s<l;s++)u=e[s].style.zIndex,e[s]!==this._container&&u&&(n=t(n,+u));isFinite(n)&&(this.options.zIndex=n+t(-1,1),this._updateZIndex())},_updateOpacity:function(){if(this._map&&!A.ielt9){vt(this._container,this.options.opacity);var t=+new Date,e=!1,n=!1;for(var s in this._tiles){var l=this._tiles[s];if(!(!l.current||!l.loaded)){var u=Math.min(1,(t-l.loaded)/200);vt(l.el,u),u<1?e=!0:(l.active?n=!0:this._onOpaqueTile(l),l.active=!0)}}n&&!this._noPrune&&this._pruneTiles(),e&&(st(this._fadeFrame),this._fadeFrame=ot(this._updateOpacity,this))}},_onOpaqueTile:b,_initContainer:function(){this._container||(this._container=Z("div","leaflet-layer "+(this.options.className||"")),this._updateZIndex(),this.options.opacity<1&&this._updateOpacity(),this.getPane().appendChild(this._container))},_updateLevels:function(){var t=this._tileZoom,e=this.options.maxZoom;if(t!==void 0){for(var n in this._levels)n=Number(n),this._levels[n].el.children.length||n===t?(this._levels[n].el.style.zIndex=e-Math.abs(t-n),this._onUpdateLevel(n)):(G(this._levels[n].el),this._removeTilesAtZoom(n),this._onRemoveLevel(n),delete this._levels[n]);var s=this._levels[t],l=this._map;return s||(s=this._levels[t]={},s.el=Z("div","leaflet-tile-container leaflet-zoom-animated",this._container),s.el.style.zIndex=e,s.origin=l.project(l.unproject(l.getPixelOrigin()),t).round(),s.zoom=t,this._setZoomTransform(s,l.getCenter(),l.getZoom()),b(s.el.offsetWidth),this._onCreateLevel(s)),this._level=s,s}},_onUpdateLevel:b,_onRemoveLevel:b,_onCreateLevel:b,_pruneTiles:function(){if(this._map){var t,e,n=this._map.getZoom();if(n>this.options.maxZoom||n<this.options.minZoom){this._removeAllTiles();return}for(t in this._tiles)e=this._tiles[t],e.retain=e.current;for(t in this._tiles)if(e=this._tiles[t],e.current&&!e.active){var s=e.coords;this._retainParent(s.x,s.y,s.z,s.z-5)||this._retainChildren(s.x,s.y,s.z,s.z+2)}for(t in this._tiles)this._tiles[t].retain||this._removeTile(t)}},_removeTilesAtZoom:function(t){for(var e in this._tiles)this._tiles[e].coords.z===t&&this._removeTile(e)},_removeAllTiles:function(){for(var t in this._tiles)this._removeTile(t)},_invalidateAll:function(){for(var t in this._levels)G(this._levels[t].el),this._onRemoveLevel(Number(t)),delete this._levels[t];this._removeAllTiles(),this._tileZoom=void 0},_retainParent:function(t,e,n,s){var l=Math.floor(t/2),u=Math.floor(e/2),f=n-1,m=new C(+l,+u);m.z=+f;var _=this._tileCoordsToKey(m),S=this._tiles[_];return S&&S.active?(S.retain=!0,!0):(S&&S.loaded&&(S.retain=!0),f>s?this._retainParent(l,u,f,s):!1)},_retainChildren:function(t,e,n,s){for(var l=2*t;l<2*t+2;l++)for(var u=2*e;u<2*e+2;u++){var f=new C(l,u);f.z=n+1;var m=this._tileCoordsToKey(f),_=this._tiles[m];if(_&&_.active){_.retain=!0;continue}else _&&_.loaded&&(_.retain=!0);n+1<s&&this._retainChildren(l,u,n+1,s)}},_resetView:function(t){var e=t&&(t.pinch||t.flyTo);this._setView(this._map.getCenter(),this._map.getZoom(),e,e)},_animateZoom:function(t){this._setView(t.center,t.zoom,!0,t.noUpdate)},_clampZoom:function(t){var e=this.options;return e.minNativeZoom!==void 0&&t<e.minNativeZoom?e.minNativeZoom:e.maxNativeZoom!==void 0&&e.maxNativeZoom<t?e.maxNativeZoom:t},_setView:function(t,e,n,s){var l=Math.round(e);this.options.maxZoom!==void 0&&l>this.options.maxZoom||this.options.minZoom!==void 0&&l<this.options.minZoom?l=void 0:l=this._clampZoom(l);var u=this.options.updateWhenZooming&&l!==this._tileZoom;(!s||u)&&(this._tileZoom=l,this._abortLoading&&this._abortLoading(),this._updateLevels(),this._resetGrid(),l!==void 0&&this._update(t),n||this._pruneTiles(),this._noPrune=!!n),this._setZoomTransforms(t,e)},_setZoomTransforms:function(t,e){for(var n in this._levels)this._setZoomTransform(this._levels[n],t,e)},_setZoomTransform:function(t,e,n){var s=this._map.getZoomScale(n,t.zoom),l=t.origin.multiplyBy(s).subtract(this._map._getNewPixelOrigin(e,n)).round();A.any3d?Gt(t.el,l,s):X(t.el,l)},_resetGrid:function(){var t=this._map,e=t.options.crs,n=this._tileSize=this.getTileSize(),s=this._tileZoom,l=this._map.getPixelWorldBounds(this._tileZoom);l&&(this._globalTileRange=this._pxBoundsToTileRange(l)),this._wrapX=e.wrapLng&&!this.options.noWrap&&[Math.floor(t.project([0,e.wrapLng[0]],s).x/n.x),Math.ceil(t.project([0,e.wrapLng[1]],s).x/n.y)],this._wrapY=e.wrapLat&&!this.options.noWrap&&[Math.floor(t.project([e.wrapLat[0],0],s).y/n.x),Math.ceil(t.project([e.wrapLat[1],0],s).y/n.y)]},_onMoveEnd:function(){!this._map||this._map._animatingZoom||this._update()},_getTiledPixelBounds:function(t){var e=this._map,n=e._animatingZoom?Math.max(e._animateToZoom,e.getZoom()):e.getZoom(),s=e.getZoomScale(n,this._tileZoom),l=e.project(t,this._tileZoom).floor(),u=e.getSize().divideBy(s*2);return new F(l.subtract(u),l.add(u))},_update:function(t){var e=this._map;if(e){var n=this._clampZoom(e.getZoom());if(t===void 0&&(t=e.getCenter()),this._tileZoom!==void 0){var s=this._getTiledPixelBounds(t),l=this._pxBoundsToTileRange(s),u=l.getCenter(),f=[],m=this.options.keepBuffer,_=new F(l.getBottomLeft().subtract([m,-m]),l.getTopRight().add([m,-m]));if(!(isFinite(l.min.x)&&isFinite(l.min.y)&&isFinite(l.max.x)&&isFinite(l.max.y)))throw new Error("Attempted to load an infinite number of tiles");for(var S in this._tiles){var P=this._tiles[S].coords;(P.z!==this._tileZoom||!_.contains(new C(P.x,P.y)))&&(this._tiles[S].current=!1)}if(Math.abs(n-this._tileZoom)>1){this._setView(t,n);return}for(var k=l.min.y;k<=l.max.y;k++)for(var N=l.min.x;N<=l.max.x;N++){var dt=new C(N,k);if(dt.z=this._tileZoom,!!this._isValidTile(dt)){var nt=this._tiles[this._tileCoordsToKey(dt)];nt?nt.current=!0:f.push(dt)}}if(f.sort(function(ft,de){return ft.distanceTo(u)-de.distanceTo(u)}),f.length!==0){this._loading||(this._loading=!0,this.fire("loading"));var wt=document.createDocumentFragment();for(N=0;N<f.length;N++)this._addTile(f[N],wt);this._level.el.appendChild(wt)}}}},_isValidTile:function(t){var e=this._map.options.crs;if(!e.infinite){var n=this._globalTileRange;if(!e.wrapLng&&(t.x<n.min.x||t.x>n.max.x)||!e.wrapLat&&(t.y<n.min.y||t.y>n.max.y))return!1}if(!this.options.bounds)return!0;var s=this._tileCoordsToBounds(t);return W(this.options.bounds).overlaps(s)},_keyToBounds:function(t){return this._tileCoordsToBounds(this._keyToTileCoords(t))},_tileCoordsToNwSe:function(t){var e=this._map,n=this.getTileSize(),s=t.scaleBy(n),l=s.add(n),u=e.unproject(s,t.z),f=e.unproject(l,t.z);return[u,f]},_tileCoordsToBounds:function(t){var e=this._tileCoordsToNwSe(t),n=new it(e[0],e[1]);return this.options.noWrap||(n=this._map.wrapLatLngBounds(n)),n},_tileCoordsToKey:function(t){return t.x+":"+t.y+":"+t.z},_keyToTileCoords:function(t){var e=t.split(":"),n=new C(+e[0],+e[1]);return n.z=+e[2],n},_removeTile:function(t){var e=this._tiles[t];e&&(G(e.el),delete this._tiles[t],this.fire("tileunload",{tile:e.el,coords:this._keyToTileCoords(t)}))},_initTile:function(t){R(t,"leaflet-tile");var e=this.getTileSize();t.style.width=e.x+"px",t.style.height=e.y+"px",t.onselectstart=b,t.onmousemove=b,A.ielt9&&this.options.opacity<1&&vt(t,this.options.opacity)},_addTile:function(t,e){var n=this._getTilePos(t),s=this._tileCoordsToKey(t),l=this.createTile(this._wrapCoords(t),h(this._tileReady,this,t));this._initTile(l),this.createTile.length<2&&ot(h(this._tileReady,this,t,null,l)),X(l,n),this._tiles[s]={el:l,coords:t,current:!0},e.appendChild(l),this.fire("tileloadstart",{tile:l,coords:t})},_tileReady:function(t,e,n){e&&this.fire("tileerror",{error:e,tile:n,coords:t});var s=this._tileCoordsToKey(t);n=this._tiles[s],n&&(n.loaded=+new Date,this._map._fadeAnimated?(vt(n.el,0),st(this._fadeFrame),this._fadeFrame=ot(this._updateOpacity,this)):(n.active=!0,this._pruneTiles()),e||(R(n.el,"leaflet-tile-loaded"),this.fire("tileload",{tile:n.el,coords:t})),this._noTilesToLoad()&&(this._loading=!1,this.fire("load"),A.ielt9||!this._map._fadeAnimated?ot(this._pruneTiles,this):setTimeout(h(this._pruneTiles,this),250)))},_getTilePos:function(t){return t.scaleBy(this.getTileSize()).subtract(this._level.origin)},_wrapCoords:function(t){var e=new C(this._wrapX?y(t.x,this._wrapX):t.x,this._wrapY?y(t.y,this._wrapY):t.y);return e.z=t.z,e},_pxBoundsToTileRange:function(t){var e=this.getTileSize();return new F(t.min.unscaleBy(e).floor(),t.max.unscaleBy(e).ceil().subtract([1,1]))},_noTilesToLoad:function(){for(var t in this._tiles)if(!this._tiles[t].loaded)return!1;return!0}});function Zr(t){return new ke(t)}var he=ke.extend({options:{minZoom:0,maxZoom:18,subdomains:"abc",errorTileUrl:"",zoomOffset:0,tms:!1,zoomReverse:!1,detectRetina:!1,crossOrigin:!1,referrerPolicy:!1},initialize:function(t,e){this._url=t,e=x(this,e),e.detectRetina&&A.retina&&e.maxZoom>0?(e.tileSize=Math.floor(e.tileSize/2),e.zoomReverse?(e.zoomOffset--,e.minZoom=Math.min(e.maxZoom,e.minZoom+1)):(e.zoomOffset++,e.maxZoom=Math.max(e.minZoom,e.maxZoom-1)),e.minZoom=Math.max(0,e.minZoom)):e.zoomReverse?e.minZoom=Math.min(e.maxZoom,e.minZoom):e.maxZoom=Math.max(e.minZoom,e.maxZoom),typeof e.subdomains=="string"&&(e.subdomains=e.subdomains.split("")),this.on("tileunload",this._onTileRemove)},setUrl:function(t,e){return this._url===t&&e===void 0&&(e=!0),this._url=t,e||this.redraw(),this},createTile:function(t,e){var n=document.createElement("img");return M(n,"load",h(this._tileOnLoad,this,e,n)),M(n,"error",h(this._tileOnError,this,e,n)),(this.options.crossOrigin||this.options.crossOrigin==="")&&(n.crossOrigin=this.options.crossOrigin===!0?"":this.options.crossOrigin),typeof this.options.referrerPolicy=="string"&&(n.referrerPolicy=this.options.referrerPolicy),n.alt="",n.src=this.getTileUrl(t),n},getTileUrl:function(t){var e={r:A.retina?"@2x":"",s:this._getSubdomain(t),x:t.x,y:t.y,z:this._getZoomForUrl()};if(this._map&&!this._map.options.crs.infinite){var n=this._globalTileRange.max.y-t.y;this.options.tms&&(e.y=n),e["-y"]=n}return ut(this._url,c(e,this.options))},_tileOnLoad:function(t,e){A.ielt9?setTimeout(h(t,this,null,e),0):t(null,e)},_tileOnError:function(t,e,n){var s=this.options.errorTileUrl;s&&e.getAttribute("src")!==s&&(e.src=s),t(n,e)},_onTileRemove:function(t){t.tile.onload=null},_getZoomForUrl:function(){var t=this._tileZoom,e=this.options.maxZoom,n=this.options.zoomReverse,s=this.options.zoomOffset;return n&&(t=e-t),t+s},_getSubdomain:function(t){var e=Math.abs(t.x+t.y)%this.options.subdomains.length;return this.options.subdomains[e]},_abortLoading:function(){var t,e;for(t in this._tiles)if(this._tiles[t].coords.z!==this._tileZoom&&(e=this._tiles[t].el,e.onload=b,e.onerror=b,!e.complete)){e.src=lt;var n=this._tiles[t].coords;G(e),delete this._tiles[t],this.fire("tileabort",{tile:e,coords:n})}},_removeTile:function(t){var e=this._tiles[t];if(e)return e.el.setAttribute("src",lt),ke.prototype._removeTile.call(this,t)},_tileReady:function(t,e,n){if(!(!this._map||n&&n.getAttribute("src")===lt))return ke.prototype._tileReady.call(this,t,e,n)}});function _o(t,e){return new he(t,e)}var vo=he.extend({defaultWmsParams:{service:"WMS",request:"GetMap",layers:"",styles:"",format:"image/jpeg",transparent:!1,version:"1.1.1"},options:{crs:null,uppercase:!1},initialize:function(t,e){this._url=t;var n=c({},this.defaultWmsParams);for(var s in e)s in this.options||(n[s]=e[s]);e=x(this,e);var l=e.detectRetina&&A.retina?2:1,u=this.getTileSize();n.width=u.x*l,n.height=u.y*l,this.wmsParams=n},onAdd:function(t){this._crs=this.options.crs||t.options.crs,this._wmsVersion=parseFloat(this.wmsParams.version);var e=this._wmsVersion>=1.3?"crs":"srs";this.wmsParams[e]=this._crs.code,he.prototype.onAdd.call(this,t)},getTileUrl:function(t){var e=this._tileCoordsToNwSe(t),n=this._crs,s=J(n.project(e[0]),n.project(e[1])),l=s.min,u=s.max,f=(this._wmsVersion>=1.3&&this._crs===co?[l.y,l.x,u.y,u.x]:[l.x,l.y,u.x,u.y]).join(","),m=he.prototype.getTileUrl.call(this,t);return m+T(this.wmsParams,m,this.options.uppercase)+(this.options.uppercase?"&BBOX=":"&bbox=")+f},setParams:function(t,e){return c(this.wmsParams,t),e||this.redraw(),this}});function Ur(t,e){return new vo(t,e)}he.WMS=vo,_o.wms=Ur;var Nt=xt.extend({options:{padding:.1},initialize:function(t){x(this,t),g(this),this._layers=this._layers||{}},onAdd:function(){this._container||(this._initContainer(),R(this._container,"leaflet-zoom-animated")),this.getPane().appendChild(this._container),this._update(),this.on("update",this._updatePaths,this)},onRemove:function(){this.off("update",this._updatePaths,this),this._destroyContainer()},getEvents:function(){var t={viewreset:this._reset,zoom:this._onZoom,moveend:this._update,zoomend:this._onZoomEnd};return this._zoomAnimated&&(t.zoomanim=this._onAnimZoom),t},_onAnimZoom:function(t){this._updateTransform(t.center,t.zoom)},_onZoom:function(){this._updateTransform(this._map.getCenter(),this._map.getZoom())},_updateTransform:function(t,e){var n=this._map.getZoomScale(e,this._zoom),s=this._map.getSize().multiplyBy(.5+this.options.padding),l=this._map.project(this._center,e),u=s.multiplyBy(-n).add(l).subtract(this._map._getNewPixelOrigin(t,e));A.any3d?Gt(this._container,u,n):X(this._container,u)},_reset:function(){this._update(),this._updateTransform(this._center,this._zoom);for(var t in this._layers)this._layers[t]._reset()},_onZoomEnd:function(){for(var t in this._layers)this._layers[t]._project()},_updatePaths:function(){for(var t in this._layers)this._layers[t]._update()},_update:function(){var t=this.options.padding,e=this._map.getSize(),n=this._map.containerPointToLayerPoint(e.multiplyBy(-t)).round();this._bounds=new F(n,n.add(e.multiplyBy(1+t*2)).round()),this._center=this._map.getCenter(),this._zoom=this._map.getZoom()}}),yo=Nt.extend({options:{tolerance:0},getEvents:function(){var t=Nt.prototype.getEvents.call(this);return t.viewprereset=this._onViewPreReset,t},_onViewPreReset:function(){this._postponeUpdatePaths=!0},onAdd:function(){Nt.prototype.onAdd.call(this),this._draw()},_initContainer:function(){var t=this._container=document.createElement("canvas");M(t,"mousemove",this._onMouseMove,this),M(t,"click dblclick mousedown mouseup contextmenu",this._onClick,this),M(t,"mouseout",this._handleMouseOut,this),t._leaflet_disable_events=!0,this._ctx=t.getContext("2d")},_destroyContainer:function(){st(this._redrawRequest),delete this._ctx,G(this._container),q(this._container),delete this._container},_updatePaths:function(){if(!this._postponeUpdatePaths){var t;this._redrawBounds=null;for(var e in this._layers)t=this._layers[e],t._update();this._redraw()}},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Nt.prototype._update.call(this);var t=this._bounds,e=this._container,n=t.getSize(),s=A.retina?2:1;X(e,t.min),e.width=s*n.x,e.height=s*n.y,e.style.width=n.x+"px",e.style.height=n.y+"px",A.retina&&this._ctx.scale(2,2),this._ctx.translate(-t.min.x,-t.min.y),this.fire("update")}},_reset:function(){Nt.prototype._reset.call(this),this._postponeUpdatePaths&&(this._postponeUpdatePaths=!1,this._updatePaths())},_initPath:function(t){this._updateDashArray(t),this._layers[g(t)]=t;var e=t._order={layer:t,prev:this._drawLast,next:null};this._drawLast&&(this._drawLast.next=e),this._drawLast=e,this._drawFirst=this._drawFirst||this._drawLast},_addPath:function(t){this._requestRedraw(t)},_removePath:function(t){var e=t._order,n=e.next,s=e.prev;n?n.prev=s:this._drawLast=s,s?s.next=n:this._drawFirst=n,delete t._order,delete this._layers[g(t)],this._requestRedraw(t)},_updatePath:function(t){this._extendRedrawBounds(t),t._project(),t._update(),this._requestRedraw(t)},_updateStyle:function(t){this._updateDashArray(t),this._requestRedraw(t)},_updateDashArray:function(t){if(typeof t.options.dashArray=="string"){var e=t.options.dashArray.split(/[, ]+/),n=[],s,l;for(l=0;l<e.length;l++){if(s=Number(e[l]),isNaN(s))return;n.push(s)}t.options._dashArray=n}else t.options._dashArray=t.options.dashArray},_requestRedraw:function(t){this._map&&(this._extendRedrawBounds(t),this._redrawRequest=this._redrawRequest||ot(this._redraw,this))},_extendRedrawBounds:function(t){if(t._pxBounds){var e=(t.options.weight||0)+1;this._redrawBounds=this._redrawBounds||new F,this._redrawBounds.extend(t._pxBounds.min.subtract([e,e])),this._redrawBounds.extend(t._pxBounds.max.add([e,e]))}},_redraw:function(){this._redrawRequest=null,this._redrawBounds&&(this._redrawBounds.min._floor(),this._redrawBounds.max._ceil()),this._clear(),this._draw(),this._redrawBounds=null},_clear:function(){var t=this._redrawBounds;if(t){var e=t.getSize();this._ctx.clearRect(t.min.x,t.min.y,e.x,e.y)}else this._ctx.save(),this._ctx.setTransform(1,0,0,1,0,0),this._ctx.clearRect(0,0,this._container.width,this._container.height),this._ctx.restore()},_draw:function(){var t,e=this._redrawBounds;if(this._ctx.save(),e){var n=e.getSize();this._ctx.beginPath(),this._ctx.rect(e.min.x,e.min.y,n.x,n.y),this._ctx.clip()}this._drawing=!0;for(var s=this._drawFirst;s;s=s.next)t=s.layer,(!e||t._pxBounds&&t._pxBounds.intersects(e))&&t._updatePath();this._drawing=!1,this._ctx.restore()},_updatePoly:function(t,e){if(this._drawing){var n,s,l,u,f=t._parts,m=f.length,_=this._ctx;if(m){for(_.beginPath(),n=0;n<m;n++){for(s=0,l=f[n].length;s<l;s++)u=f[n][s],_[s?"lineTo":"moveTo"](u.x,u.y);e&&_.closePath()}this._fillStroke(_,t)}}},_updateCircle:function(t){if(!(!this._drawing||t._empty())){var e=t._point,n=this._ctx,s=Math.max(Math.round(t._radius),1),l=(Math.max(Math.round(t._radiusY),1)||s)/s;l!==1&&(n.save(),n.scale(1,l)),n.beginPath(),n.arc(e.x,e.y/l,s,0,Math.PI*2,!1),l!==1&&n.restore(),this._fillStroke(n,t)}},_fillStroke:function(t,e){var n=e.options;n.fill&&(t.globalAlpha=n.fillOpacity,t.fillStyle=n.fillColor||n.color,t.fill(n.fillRule||"evenodd")),n.stroke&&n.weight!==0&&(t.setLineDash&&t.setLineDash(e.options&&e.options._dashArray||[]),t.globalAlpha=n.opacity,t.lineWidth=n.weight,t.strokeStyle=n.color,t.lineCap=n.lineCap,t.lineJoin=n.lineJoin,t.stroke())},_onClick:function(t){for(var e=this._map.mouseEventToLayerPoint(t),n,s,l=this._drawFirst;l;l=l.next)n=l.layer,n.options.interactive&&n._containsPoint(e)&&(!(t.type==="click"||t.type==="preclick")||!this._map._draggableMoved(n))&&(s=n);this._fireEvent(s?[s]:!1,t)},_onMouseMove:function(t){if(!(!this._map||this._map.dragging.moving()||this._map._animatingZoom)){var e=this._map.mouseEventToLayerPoint(t);this._handleMouseHover(t,e)}},_handleMouseOut:function(t){var e=this._hoveredLayer;e&&(Y(this._container,"leaflet-interactive"),this._fireEvent([e],t,"mouseout"),this._hoveredLayer=null,this._mouseHoverThrottled=!1)},_handleMouseHover:function(t,e){if(!this._mouseHoverThrottled){for(var n,s,l=this._drawFirst;l;l=l.next)n=l.layer,n.options.interactive&&n._containsPoint(e)&&(s=n);s!==this._hoveredLayer&&(this._handleMouseOut(t),s&&(R(this._container,"leaflet-interactive"),this._fireEvent([s],t,"mouseover"),this._hoveredLayer=s)),this._fireEvent(this._hoveredLayer?[this._hoveredLayer]:!1,t),this._mouseHoverThrottled=!0,setTimeout(h(function(){this._mouseHoverThrottled=!1},this),32)}},_fireEvent:function(t,e,n){this._map._fireDOMEvent(e,n||e.type,t)},_bringToFront:function(t){var e=t._order;if(e){var n=e.next,s=e.prev;if(n)n.prev=s;else return;s?s.next=n:n&&(this._drawFirst=n),e.prev=this._drawLast,this._drawLast.next=e,e.next=null,this._drawLast=e,this._requestRedraw(t)}},_bringToBack:function(t){var e=t._order;if(e){var n=e.next,s=e.prev;if(s)s.next=n;else return;n?n.prev=s:s&&(this._drawLast=s),e.prev=null,e.next=this._drawFirst,this._drawFirst.prev=e,this._drawFirst=e,this._requestRedraw(t)}}});function wo(t){return A.canvas?new yo(t):null}var Ie=function(){try{return document.namespaces.add("lvml","urn:schemas-microsoft-com:vml"),function(t){return document.createElement("<lvml:"+t+' class="lvml">')}}catch{}return function(t){return document.createElement("<"+t+' xmlns="urn:schemas-microsoft.com:vml" class="lvml">')}}(),Hr={_initContainer:function(){this._container=Z("div","leaflet-vml-container")},_update:function(){this._map._animatingZoom||(Nt.prototype._update.call(this),this.fire("update"))},_initPath:function(t){var e=t._container=Ie("shape");R(e,"leaflet-vml-shape "+(this.options.className||"")),e.coordsize="1 1",t._path=Ie("path"),e.appendChild(t._path),this._updateStyle(t),this._layers[g(t)]=t},_addPath:function(t){var e=t._container;this._container.appendChild(e),t.options.interactive&&t.addInteractiveTarget(e)},_removePath:function(t){var e=t._container;G(e),t.removeInteractiveTarget(e),delete this._layers[g(t)]},_updateStyle:function(t){var e=t._stroke,n=t._fill,s=t.options,l=t._container;l.stroked=!!s.stroke,l.filled=!!s.fill,s.stroke?(e||(e=t._stroke=Ie("stroke")),l.appendChild(e),e.weight=s.weight+"px",e.color=s.color,e.opacity=s.opacity,s.dashArray?e.dashStyle=H(s.dashArray)?s.dashArray.join(" "):s.dashArray.replace(/( *, *)/g," "):e.dashStyle="",e.endcap=s.lineCap.replace("butt","flat"),e.joinstyle=s.lineJoin):e&&(l.removeChild(e),t._stroke=null),s.fill?(n||(n=t._fill=Ie("fill")),l.appendChild(n),n.color=s.fillColor||s.color,n.opacity=s.fillOpacity):n&&(l.removeChild(n),t._fill=null)},_updateCircle:function(t){var e=t._point.round(),n=Math.round(t._radius),s=Math.round(t._radiusY||n);this._setPath(t,t._empty()?"M0 0":"AL "+e.x+","+e.y+" "+n+","+s+" 0,"+65535*360)},_setPath:function(t,e){t._path.v=e},_bringToFront:function(t){se(t._container)},_bringToBack:function(t){re(t._container)}},li=A.vml?Ie:Ln,Oe=Nt.extend({_initContainer:function(){this._container=li("svg"),this._container.setAttribute("pointer-events","none"),this._rootGroup=li("g"),this._container.appendChild(this._rootGroup)},_destroyContainer:function(){G(this._container),q(this._container),delete this._container,delete this._rootGroup,delete this._svgSize},_update:function(){if(!(this._map._animatingZoom&&this._bounds)){Nt.prototype._update.call(this);var t=this._bounds,e=t.getSize(),n=this._container;(!this._svgSize||!this._svgSize.equals(e))&&(this._svgSize=e,n.setAttribute("width",e.x),n.setAttribute("height",e.y)),X(n,t.min),n.setAttribute("viewBox",[t.min.x,t.min.y,e.x,e.y].join(" ")),this.fire("update")}},_initPath:function(t){var e=t._path=li("path");t.options.className&&R(e,t.options.className),t.options.interactive&&R(e,"leaflet-interactive"),this._updateStyle(t),this._layers[g(t)]=t},_addPath:function(t){this._rootGroup||this._initContainer(),this._rootGroup.appendChild(t._path),t.addInteractiveTarget(t._path)},_removePath:function(t){G(t._path),t.removeInteractiveTarget(t._path),delete this._layers[g(t)]},_updatePath:function(t){t._project(),t._update()},_updateStyle:function(t){var e=t._path,n=t.options;e&&(n.stroke?(e.setAttribute("stroke",n.color),e.setAttribute("stroke-opacity",n.opacity),e.setAttribute("stroke-width",n.weight),e.setAttribute("stroke-linecap",n.lineCap),e.setAttribute("stroke-linejoin",n.lineJoin),n.dashArray?e.setAttribute("stroke-dasharray",n.dashArray):e.removeAttribute("stroke-dasharray"),n.dashOffset?e.setAttribute("stroke-dashoffset",n.dashOffset):e.removeAttribute("stroke-dashoffset")):e.setAttribute("stroke","none"),n.fill?(e.setAttribute("fill",n.fillColor||n.color),e.setAttribute("fill-opacity",n.fillOpacity),e.setAttribute("fill-rule",n.fillRule||"evenodd")):e.setAttribute("fill","none"))},_updatePoly:function(t,e){this._setPath(t,En(t._parts,e))},_updateCircle:function(t){var e=t._point,n=Math.max(Math.round(t._radius),1),s=Math.max(Math.round(t._radiusY),1)||n,l="a"+n+","+s+" 0 1,0 ",u=t._empty()?"M0 0":"M"+(e.x-n)+","+e.y+l+n*2+",0 "+l+-n*2+",0 ";this._setPath(t,u)},_setPath:function(t,e){t._path.setAttribute("d",e)},_bringToFront:function(t){se(t._path)},_bringToBack:function(t){re(t._path)}});A.vml&&Oe.include(Hr);function bo(t){return A.svg||A.vml?new Oe(t):null}z.include({getRenderer:function(t){var e=t.options.renderer||this._getPaneRenderer(t.options.pane)||this.options.renderer||this._renderer;return e||(e=this._renderer=this._createRenderer()),this.hasLayer(e)||this.addLayer(e),e},_getPaneRenderer:function(t){if(t==="overlayPane"||t===void 0)return!1;var e=this._paneRenderers[t];return e===void 0&&(e=this._createRenderer({pane:t}),this._paneRenderers[t]=e),e},_createRenderer:function(t){return this.options.preferCanvas&&wo(t)||bo(t)}});var So=ce.extend({initialize:function(t,e){ce.prototype.initialize.call(this,this._boundsToLatLngs(t),e)},setBounds:function(t){return this.setLatLngs(this._boundsToLatLngs(t))},_boundsToLatLngs:function(t){return t=W(t),[t.getSouthWest(),t.getNorthWest(),t.getNorthEast(),t.getSouthEast()]}});function qr(t,e){return new So(t,e)}Oe.create=li,Oe.pointsToPath=En,Rt.geometryToLayer=ei,Rt.coordsToLatLng=Xi,Rt.coordsToLatLngs=ii,Rt.latLngToCoords=tn,Rt.latLngsToCoords=ni,Rt.getFeature=ue,Rt.asFeature=oi,z.mergeOptions({boxZoom:!0});var Lo=Ct.extend({initialize:function(t){this._map=t,this._container=t._container,this._pane=t._panes.overlayPane,this._resetStateTimeout=0,t.on("unload",this._destroy,this)},addHooks:function(){M(this._container,"mousedown",this._onMouseDown,this)},removeHooks:function(){q(this._container,"mousedown",this._onMouseDown,this)},moved:function(){return this._moved},_destroy:function(){G(this._pane),delete this._pane},_resetState:function(){this._resetStateTimeout=0,this._moved=!1},_clearDeferredResetState:function(){this._resetStateTimeout!==0&&(clearTimeout(this._resetStateTimeout),this._resetStateTimeout=0)},_onMouseDown:function(t){if(!t.shiftKey||t.which!==1&&t.button!==1)return!1;this._clearDeferredResetState(),this._resetState(),Le(),Ni(),this._startPoint=this._map.mouseEventToContainerPoint(t),M(document,{contextmenu:Yt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseMove:function(t){this._moved||(this._moved=!0,this._box=Z("div","leaflet-zoom-box",this._container),R(this._container,"leaflet-crosshair"),this._map.fire("boxzoomstart")),this._point=this._map.mouseEventToContainerPoint(t);var e=new F(this._point,this._startPoint),n=e.getSize();X(this._box,e.min),this._box.style.width=n.x+"px",this._box.style.height=n.y+"px"},_finish:function(){this._moved&&(G(this._box),Y(this._container,"leaflet-crosshair")),Ee(),Di(),q(document,{contextmenu:Yt,mousemove:this._onMouseMove,mouseup:this._onMouseUp,keydown:this._onKeyDown},this)},_onMouseUp:function(t){if(!(t.which!==1&&t.button!==1)&&(this._finish(),!!this._moved)){this._clearDeferredResetState(),this._resetStateTimeout=setTimeout(h(this._resetState,this),0);var e=new it(this._map.containerPointToLatLng(this._startPoint),this._map.containerPointToLatLng(this._point));this._map.fitBounds(e).fire("boxzoomend",{boxZoomBounds:e})}},_onKeyDown:function(t){t.keyCode===27&&(this._finish(),this._clearDeferredResetState(),this._resetState())}});z.addInitHook("addHandler","boxZoom",Lo),z.mergeOptions({doubleClickZoom:!0});var Eo=Ct.extend({addHooks:function(){this._map.on("dblclick",this._onDoubleClick,this)},removeHooks:function(){this._map.off("dblclick",this._onDoubleClick,this)},_onDoubleClick:function(t){var e=this._map,n=e.getZoom(),s=e.options.zoomDelta,l=t.originalEvent.shiftKey?n-s:n+s;e.options.doubleClickZoom==="center"?e.setZoom(l):e.setZoomAround(t.containerPoint,l)}});z.addInitHook("addHandler","doubleClickZoom",Eo),z.mergeOptions({dragging:!0,inertia:!0,inertiaDeceleration:3400,inertiaMaxSpeed:1/0,easeLinearity:.2,worldCopyJump:!1,maxBoundsViscosity:0});var xo=Ct.extend({addHooks:function(){if(!this._draggable){var t=this._map;this._draggable=new qt(t._mapPane,t._container),this._draggable.on({dragstart:this._onDragStart,drag:this._onDrag,dragend:this._onDragEnd},this),this._draggable.on("predrag",this._onPreDragLimit,this),t.options.worldCopyJump&&(this._draggable.on("predrag",this._onPreDragWrap,this),t.on("zoomend",this._onZoomEnd,this),t.whenReady(this._onZoomEnd,this))}R(this._map._container,"leaflet-grab leaflet-touch-drag"),this._draggable.enable(),this._positions=[],this._times=[]},removeHooks:function(){Y(this._map._container,"leaflet-grab"),Y(this._map._container,"leaflet-touch-drag"),this._draggable.disable()},moved:function(){return this._draggable&&this._draggable._moved},moving:function(){return this._draggable&&this._draggable._moving},_onDragStart:function(){var t=this._map;if(t._stop(),this._map.options.maxBounds&&this._map.options.maxBoundsViscosity){var e=W(this._map.options.maxBounds);this._offsetLimit=J(this._map.latLngToContainerPoint(e.getNorthWest()).multiplyBy(-1),this._map.latLngToContainerPoint(e.getSouthEast()).multiplyBy(-1).add(this._map.getSize())),this._viscosity=Math.min(1,Math.max(0,this._map.options.maxBoundsViscosity))}else this._offsetLimit=null;t.fire("movestart").fire("dragstart"),t.options.inertia&&(this._positions=[],this._times=[])},_onDrag:function(t){if(this._map.options.inertia){var e=this._lastTime=+new Date,n=this._lastPos=this._draggable._absPos||this._draggable._newPos;this._positions.push(n),this._times.push(e),this._prunePositions(e)}this._map.fire("move",t).fire("drag",t)},_prunePositions:function(t){for(;this._positions.length>1&&t-this._times[0]>50;)this._positions.shift(),this._times.shift()},_onZoomEnd:function(){var t=this._map.getSize().divideBy(2),e=this._map.latLngToLayerPoint([0,0]);this._initialWorldOffset=e.subtract(t).x,this._worldWidth=this._map.getPixelWorldBounds().getSize().x},_viscousLimit:function(t,e){return t-(t-e)*this._viscosity},_onPreDragLimit:function(){if(!(!this._viscosity||!this._offsetLimit)){var t=this._draggable._newPos.subtract(this._draggable._startPos),e=this._offsetLimit;t.x<e.min.x&&(t.x=this._viscousLimit(t.x,e.min.x)),t.y<e.min.y&&(t.y=this._viscousLimit(t.y,e.min.y)),t.x>e.max.x&&(t.x=this._viscousLimit(t.x,e.max.x)),t.y>e.max.y&&(t.y=this._viscousLimit(t.y,e.max.y)),this._draggable._newPos=this._draggable._startPos.add(t)}},_onPreDragWrap:function(){var t=this._worldWidth,e=Math.round(t/2),n=this._initialWorldOffset,s=this._draggable._newPos.x,l=(s-e+n)%t+e-n,u=(s+e+n)%t-e-n,f=Math.abs(l+n)<Math.abs(u+n)?l:u;this._draggable._absPos=this._draggable._newPos.clone(),this._draggable._newPos.x=f},_onDragEnd:function(t){var e=this._map,n=e.options,s=!n.inertia||t.noInertia||this._times.length<2;if(e.fire("dragend",t),s)e.fire("moveend");else{this._prunePositions(+new Date);var l=this._lastPos.subtract(this._positions[0]),u=(this._lastTime-this._times[0])/1e3,f=n.easeLinearity,m=l.multiplyBy(f/u),_=m.distanceTo([0,0]),S=Math.min(n.inertiaMaxSpeed,_),P=m.multiplyBy(S/_),k=S/(n.inertiaDeceleration*f),N=P.multiplyBy(-k/2).round();!N.x&&!N.y?e.fire("moveend"):(N=e._limitOffset(N,e.options.maxBounds),ot(function(){e.panBy(N,{duration:k,easeLinearity:f,noMoveStart:!0,animate:!0})}))}}});z.addInitHook("addHandler","dragging",xo),z.mergeOptions({keyboard:!0,keyboardPanDelta:80});var Po=Ct.extend({keyCodes:{left:[37],right:[39],down:[40],up:[38],zoomIn:[187,107,61,171],zoomOut:[189,109,54,173]},initialize:function(t){this._map=t,this._setPanDelta(t.options.keyboardPanDelta),this._setZoomDelta(t.options.zoomDelta)},addHooks:function(){var t=this._map._container;t.tabIndex<=0&&(t.tabIndex="0"),M(t,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.on({focus:this._addHooks,blur:this._removeHooks},this)},removeHooks:function(){this._removeHooks(),q(this._map._container,{focus:this._onFocus,blur:this._onBlur,mousedown:this._onMouseDown},this),this._map.off({focus:this._addHooks,blur:this._removeHooks},this)},_onMouseDown:function(){if(!this._focused){var t=document.body,e=document.documentElement,n=t.scrollTop||e.scrollTop,s=t.scrollLeft||e.scrollLeft;this._map._container.focus(),window.scrollTo(s,n)}},_onFocus:function(){this._focused=!0,this._map.fire("focus")},_onBlur:function(){this._focused=!1,this._map.fire("blur")},_setPanDelta:function(t){var e=this._panKeys={},n=this.keyCodes,s,l;for(s=0,l=n.left.length;s<l;s++)e[n.left[s]]=[-1*t,0];for(s=0,l=n.right.length;s<l;s++)e[n.right[s]]=[t,0];for(s=0,l=n.down.length;s<l;s++)e[n.down[s]]=[0,t];for(s=0,l=n.up.length;s<l;s++)e[n.up[s]]=[0,-1*t]},_setZoomDelta:function(t){var e=this._zoomKeys={},n=this.keyCodes,s,l;for(s=0,l=n.zoomIn.length;s<l;s++)e[n.zoomIn[s]]=t;for(s=0,l=n.zoomOut.length;s<l;s++)e[n.zoomOut[s]]=-t},_addHooks:function(){M(document,"keydown",this._onKeyDown,this)},_removeHooks:function(){q(document,"keydown",this._onKeyDown,this)},_onKeyDown:function(t){if(!(t.altKey||t.ctrlKey||t.metaKey)){var e=t.keyCode,n=this._map,s;if(e in this._panKeys){if(!n._panAnim||!n._panAnim._inProgress)if(s=this._panKeys[e],t.shiftKey&&(s=O(s).multiplyBy(3)),n.options.maxBounds&&(s=n._limitOffset(O(s),n.options.maxBounds)),n.options.worldCopyJump){var l=n.wrapLatLng(n.unproject(n.project(n.getCenter()).add(s)));n.panTo(l)}else n.panBy(s)}else if(e in this._zoomKeys)n.setZoom(n.getZoom()+(t.shiftKey?3:1)*this._zoomKeys[e]);else if(e===27&&n._popup&&n._popup.options.closeOnEscapeKey)n.closePopup();else return;Yt(t)}}});z.addInitHook("addHandler","keyboard",Po),z.mergeOptions({scrollWheelZoom:!0,wheelDebounceTime:40,wheelPxPerZoomLevel:60});var To=Ct.extend({addHooks:function(){M(this._map._container,"wheel",this._onWheelScroll,this),this._delta=0},removeHooks:function(){q(this._map._container,"wheel",this._onWheelScroll,this)},_onWheelScroll:function(t){var e=Jn(t),n=this._map.options.wheelDebounceTime;this._delta+=e,this._lastMousePos=this._map.mouseEventToContainerPoint(t),this._startTime||(this._startTime=+new Date);var s=Math.max(n-(+new Date-this._startTime),0);clearTimeout(this._timer),this._timer=setTimeout(h(this._performZoom,this),s),Yt(t)},_performZoom:function(){var t=this._map,e=t.getZoom(),n=this._map.options.zoomSnap||0;t._stop();var s=this._delta/(this._map.options.wheelPxPerZoomLevel*4),l=4*Math.log(2/(1+Math.exp(-Math.abs(s))))/Math.LN2,u=n?Math.ceil(l/n)*n:l,f=t._limitZoom(e+(this._delta>0?u:-u))-e;this._delta=0,this._startTime=null,f&&(t.options.scrollWheelZoom==="center"?t.setZoom(e+f):t.setZoomAround(this._lastMousePos,e+f))}});z.addInitHook("addHandler","scrollWheelZoom",To);var Wr=600;z.mergeOptions({tapHold:A.touchNative&&A.safari&&A.mobile,tapTolerance:15});var Ao=Ct.extend({addHooks:function(){M(this._map._container,"touchstart",this._onDown,this)},removeHooks:function(){q(this._map._container,"touchstart",this._onDown,this)},_onDown:function(t){if(clearTimeout(this._holdTimeout),t.touches.length===1){var e=t.touches[0];this._startPos=this._newPos=new C(e.clientX,e.clientY),this._holdTimeout=setTimeout(h(function(){this._cancel(),this._isTapValid()&&(M(document,"touchend",at),M(document,"touchend touchcancel",this._cancelClickPrevent),this._simulateEvent("contextmenu",e))},this),Wr),M(document,"touchend touchcancel contextmenu",this._cancel,this),M(document,"touchmove",this._onMove,this)}},_cancelClickPrevent:function t(){q(document,"touchend",at),q(document,"touchend touchcancel",t)},_cancel:function(){clearTimeout(this._holdTimeout),q(document,"touchend touchcancel contextmenu",this._cancel,this),q(document,"touchmove",this._onMove,this)},_onMove:function(t){var e=t.touches[0];this._newPos=new C(e.clientX,e.clientY)},_isTapValid:function(){return this._newPos.distanceTo(this._startPos)<=this._map.options.tapTolerance},_simulateEvent:function(t,e){var n=new MouseEvent(t,{bubbles:!0,cancelable:!0,view:window,screenX:e.screenX,screenY:e.screenY,clientX:e.clientX,clientY:e.clientY});n._simulated=!0,e.target.dispatchEvent(n)}});z.addInitHook("addHandler","tapHold",Ao),z.mergeOptions({touchZoom:A.touch,bounceAtZoomLimits:!0});var Co=Ct.extend({addHooks:function(){R(this._map._container,"leaflet-touch-zoom"),M(this._map._container,"touchstart",this._onTouchStart,this)},removeHooks:function(){Y(this._map._container,"leaflet-touch-zoom"),q(this._map._container,"touchstart",this._onTouchStart,this)},_onTouchStart:function(t){var e=this._map;if(!(!t.touches||t.touches.length!==2||e._animatingZoom||this._zooming)){var n=e.mouseEventToContainerPoint(t.touches[0]),s=e.mouseEventToContainerPoint(t.touches[1]);this._centerPoint=e.getSize()._divideBy(2),this._startLatLng=e.containerPointToLatLng(this._centerPoint),e.options.touchZoom!=="center"&&(this._pinchStartLatLng=e.containerPointToLatLng(n.add(s)._divideBy(2))),this._startDist=n.distanceTo(s),this._startZoom=e.getZoom(),this._moved=!1,this._zooming=!0,e._stop(),M(document,"touchmove",this._onTouchMove,this),M(document,"touchend touchcancel",this._onTouchEnd,this),at(t)}},_onTouchMove:function(t){if(!(!t.touches||t.touches.length!==2||!this._zooming)){var e=this._map,n=e.mouseEventToContainerPoint(t.touches[0]),s=e.mouseEventToContainerPoint(t.touches[1]),l=n.distanceTo(s)/this._startDist;if(this._zoom=e.getScaleZoom(l,this._startZoom),!e.options.bounceAtZoomLimits&&(this._zoom<e.getMinZoom()&&l<1||this._zoom>e.getMaxZoom()&&l>1)&&(this._zoom=e._limitZoom(this._zoom)),e.options.touchZoom==="center"){if(this._center=this._startLatLng,l===1)return}else{var u=n._add(s)._divideBy(2)._subtract(this._centerPoint);if(l===1&&u.x===0&&u.y===0)return;this._center=e.unproject(e.project(this._pinchStartLatLng,this._zoom).subtract(u),this._zoom)}this._moved||(e._moveStart(!0,!1),this._moved=!0),st(this._animRequest);var f=h(e._move,e,this._center,this._zoom,{pinch:!0,round:!1},void 0);this._animRequest=ot(f,this,!0),at(t)}},_onTouchEnd:function(){if(!this._moved||!this._zooming){this._zooming=!1;return}this._zooming=!1,st(this._animRequest),q(document,"touchmove",this._onTouchMove,this),q(document,"touchend touchcancel",this._onTouchEnd,this),this._map.options.zoomAnimation?this._map._animateZoom(this._center,this._map._limitZoom(this._zoom),!0,this._map.options.zoomSnap):this._map._resetView(this._center,this._map._limitZoom(this._zoom))}});z.addInitHook("addHandler","touchZoom",Co),z.BoxZoom=Lo,z.DoubleClickZoom=Eo,z.Drag=xo,z.Keyboard=Po,z.ScrollWheelZoom=To,z.TapHold=Ao,z.TouchZoom=Co,o.Bounds=F,o.Browser=A,o.CRS=Ot,o.Canvas=yo,o.Circle=Qi,o.CircleMarker=ti,o.Class=rt,o.Control=Et,o.DivIcon=go,o.DivOverlay=kt,o.DomEvent=lr,o.DomUtil=rr,o.Draggable=qt,o.Evented=Ut,o.FeatureGroup=Mt,o.GeoJSON=Rt,o.GridLayer=ke,o.Handler=Ct,o.Icon=le,o.ImageOverlay=si,o.LatLng=U,o.LatLngBounds=it,o.Layer=xt,o.LayerGroup=ae,o.LineUtil=br,o.Map=z,o.Marker=Xe,o.Mixin=mr,o.Path=Wt,o.Point=C,o.PolyUtil=gr,o.Polygon=ce,o.Polyline=Bt,o.Popup=ri,o.PosAnimation=Yn,o.Projection=Sr,o.Rectangle=So,o.Renderer=Nt,o.SVG=Oe,o.SVGOverlay=mo,o.TileLayer=he,o.Tooltip=ai,o.Transformation=Ei,o.Util=Vt,o.VideoOverlay=po,o.bind=h,o.bounds=J,o.canvas=wo,o.circle=kr,o.circleMarker=Cr,o.control=Te,o.divIcon=Fr,o.extend=c,o.featureGroup=Pr,o.geoJSON=fo,o.geoJson=Mr,o.gridLayer=Zr,o.icon=Tr,o.imageOverlay=Br,o.latLng=D,o.latLngBounds=W,o.layerGroup=xr,o.map=cr,o.marker=Ar,o.point=O,o.polygon=Or,o.polyline=Ir,o.popup=Dr,o.rectangle=qr,o.setOptions=x,o.stamp=g,o.svg=bo,o.svgOverlay=Nr,o.tileLayer=_o,o.tooltip=zr,o.transformation=ye,o.version=r,o.videoOverlay=Rr;var $r=window.L;o.noConflict=function(){return window.L=$r,this},window.L=o})}(De,De.exports)),De.exports}var Ul=Zl();const gt=zl(Ul);class Ps{constructor(i){this.containerId=i,this.map=null,this.markers=new Map,this.markerClickCallback=null,this.activeMarkerId=null,this.layerControl=null,this.tileLayers={},this.tempMarker=null}async initMap(i=bt.DEFAULT_CENTER,o=bt.DEFAULT_ZOOM){try{const r=document.getElementById(this.containerId);if(!r)throw new Error(`Map container with id '${this.containerId}' not found`);return this.map?(console.log("Map already initialized, reusing existing instance"),this.map):(r._leaflet_id&&(console.log("Container already has a map, removing existing instance"),r._leaflet_id=null,r.innerHTML=""),this.map=gt.map(this.containerId,{center:i,zoom:o,zoomControl:!0,scrollWheelZoom:!0,doubleClickZoom:!0,touchZoom:!0,keyboard:!0,keyboardPanDelta:80}),this.createTileLayers(),this.tileLayers.openstreetmap.addTo(this.map),this.addLayerControl(),gt.control.scale({metric:!0,imperial:!1,position:"bottomleft"}).addTo(this.map),this.setupAccessibility(),console.log("Map initialized successfully"),this.map)}catch(r){throw console.error("Failed to initialize map:",r),r}}createTileLayers(){this.tileLayers.openstreetmap=gt.tileLayer(bt.TILE_LAYERS.OPENSTREETMAP.url,{attribution:bt.TILE_LAYERS.OPENSTREETMAP.attribution,maxZoom:19}),this.tileLayers.satellite=gt.tileLayer(bt.TILE_LAYERS.SATELLITE.url,{attribution:bt.TILE_LAYERS.SATELLITE.attribution,maxZoom:19}),this.tileLayers.terrain=gt.tileLayer(bt.TILE_LAYERS.TERRAIN.url,{attribution:bt.TILE_LAYERS.TERRAIN.attribution,maxZoom:17})}addLayerControl(){const i={[bt.TILE_LAYERS.OPENSTREETMAP.name]:this.tileLayers.openstreetmap,[bt.TILE_LAYERS.SATELLITE.name]:this.tileLayers.satellite,[bt.TILE_LAYERS.TERRAIN.name]:this.tileLayers.terrain};this.layerControl=gt.control.layers(i,null,{position:"topright",collapsed:!1}).addTo(this.map)}setupAccessibility(){const i=this.map.getContainer();i.setAttribute("tabindex","0"),i.setAttribute("role","application"),i.setAttribute("aria-label","Peta interaktif cerita"),i.addEventListener("keydown",o=>{const c=this.map.getZoom();switch(o.key){case"ArrowUp":o.preventDefault(),this.map.panBy([0,-50]);break;case"ArrowDown":o.preventDefault(),this.map.panBy([0,50]);break;case"ArrowLeft":o.preventDefault(),this.map.panBy([-50,0]);break;case"ArrowRight":o.preventDefault(),this.map.panBy([50,0]);break;case"+":case"=":o.preventDefault(),this.map.setZoom(c+1);break;case"-":o.preventDefault(),this.map.setZoom(c-1);break}})}addStoryMarker(i){if(!i.lat||!i.lon)return null;const o=gt.divIcon({className:"custom-marker",html:`
        <div class="marker-pin" data-story-id="${i.id}">
          <div class="marker-icon">üìö</div>
        </div>
      `,iconSize:[30,30],iconAnchor:[15,15]}),r=gt.marker([i.lat,i.lon],{icon:o,title:i.name||"Cerita",alt:`Lokasi cerita: ${i.name||"Tanpa judul"}`}),c=`
      <div class="marker-popup">
        <div class="popup-image">
          <img src="${i.photoUrl}" alt="${i.description||"Foto cerita"}" loading="lazy">
        </div>
        <div class="popup-content">
          <h4>${i.name||"Cerita Tanpa Judul"}</h4>
          <p>${i.description||"Tidak ada deskripsi"}</p>
          <div class="popup-meta">
            <small>üìÖ ${new Date(i.createdAt).toLocaleDateString("id-ID")}</small>
          </div>
        </div>
      </div>
    `;return r.bindPopup(c,{maxWidth:300,className:"custom-popup"}),r.on("click",()=>{this.activeMarkerId=i.id,this.markerClickCallback&&this.markerClickCallback(i)}),r.on("add",()=>{const d=r.getElement();d&&(d.setAttribute("tabindex","0"),d.setAttribute("role","button"),d.setAttribute("aria-label",`Marker cerita: ${i.name||"Tanpa judul"}`),d.addEventListener("keydown",h=>{(h.key==="Enter"||h.key===" ")&&(h.preventDefault(),r.fire("click"))}))}),r.addTo(this.map),this.markers.set(i.id,r),r}addClickableMarker(i,o,r){const c=gt.divIcon({className:"temp-marker",html:'<div class="temp-marker-pin">üìç</div>',iconSize:[30,30],iconAnchor:[15,30]}),d=gt.marker([i,o],{icon:c,title:"Lokasi yang dipilih"});return d.on("click",()=>{r&&r(i,o)}),d}onMarkerClick(i){this.markerClickCallback=i}highlightMarker(i){this.clearHighlight();const o=this.markers.get(i);if(o){const r=o.getElement();r&&r.classList.add("highlighted"),this.activeMarkerId=i}}clearHighlight(){if(this.activeMarkerId){const i=this.markers.get(this.activeMarkerId);if(i){const o=i.getElement();o&&o.classList.remove("highlighted")}this.activeMarkerId=null}}clearMarkers(){this.markers.forEach(i=>{this.map.removeLayer(i)}),this.markers.clear()}fitBoundsToMarkers(){if(this.markers.size>0){const i=new gt.featureGroup(Array.from(this.markers.values()));this.map.fitBounds(i.getBounds(),{padding:[20,20]})}}setView(i,o,r=bt.DEFAULT_ZOOM){this.map&&this.map.setView([i,o],r)}onClick(i){this.map&&this.map.on("click",o=>{const{lat:r,lng:c}=o.latlng;i(r,c)})}addTemporaryMarker(i,o){if(!this.map)return null;this.tempMarker&&this.map.removeLayer(this.tempMarker);const r=gt.divIcon({className:"temp-marker",html:'<div class="temp-marker-pin">üìç</div>',iconSize:[30,30],iconAnchor:[15,30]});return this.tempMarker=gt.marker([i,o],{icon:r,title:"Lokasi yang dipilih"}).addTo(this.map),this.tempMarker}removeTemporaryMarker(){this.tempMarker&&this.map&&(this.map.removeLayer(this.tempMarker),this.tempMarker=null)}isInitialized(){return this.map!==null}reset(){this.map&&(this.map.remove(),this.map=null,this.markers.clear(),this.tempMarker=null,this.activeMarkerId=null)}destroy(){this.reset()}}class Hl extends _i{constructor(i){super(i),this.stories=[],this.mapService=null,this.currentFilter="all"}async init(){await this.loadStories(),await this.initMap(),this.setupEventListeners()}async loadStories(){try{this.showLoading();let i=[];if(window.syncService)i=await window.syncService.getStories(!1);else{const o=await zt.getStoriesWithLocation();o.error===!1&&(i=o.listStory||[])}this.stories=i,this.view.displayStories(this.stories),this.hideLoading()}catch(i){if(this.hideLoading(),window.indexedDBService)try{const o=await window.indexedDBService.getAllStories();this.stories=o,this.view.displayStories(this.stories),this.showSuccess("Loaded stories from local cache")}catch{this.showError("Unable to load stories: "+i.message)}else this.showError("An error occurred: "+i.message)}}async initMap(){document.getElementById("stories-map")&&this.stories.length>0&&(this.mapService=new Ps("stories-map"),await this.mapService.initMap(),this.stories.forEach(o=>{o.lat&&o.lon&&this.mapService.addStoryMarker(o)}),this.mapService.onMarkerClick(o=>{this.highlightStoryCard(o.id),this.view.scrollToStory(o.id)}))}setupEventListeners(){const i=document.querySelectorAll(".filter-btn");i.forEach(d=>{d.addEventListener("click",h=>{const p=h.target.dataset.filter;this.applyFilter(p),i.forEach(g=>g.classList.remove("active")),h.target.classList.add("active")})}),document.querySelectorAll(".story-card").forEach(d=>{d.addEventListener("mouseenter",()=>{const h=d.dataset.storyId;this.mapService&&this.mapService.highlightMarker(h)}),d.addEventListener("mouseleave",()=>{this.mapService&&this.mapService.clearHighlight()}),d.addEventListener("click",()=>{const h=d.dataset.storyId;this.viewStoryDetails(h)})}),document.querySelectorAll(".favorite-btn").forEach(d=>{d.addEventListener("click",async h=>{h.stopPropagation();const p=h.target.dataset.storyId;await this.toggleFavorite(p,h.target)})});const c=document.getElementById("refresh-stories");c&&c.addEventListener("click",()=>{this.refreshStories()})}async toggleFavorite(i,o){if(!window.indexedDBService){this.showError("IndexedDB service is unavailable");return}try{const r=this.stories.find(d=>d.id===i);if(!r)return;await window.indexedDBService.isFavorite(i)?(await window.indexedDBService.removeFromFavorites(i),o.innerHTML="ü§ç",o.setAttribute("aria-label","Add to favorites"),o.classList.remove("favorite-active"),this.showSuccess("Removed from favorites")):(await window.indexedDBService.addToFavorites(i,r),o.innerHTML="‚ù§Ô∏è",o.setAttribute("aria-label","Remove from favorites"),o.classList.add("favorite-active"),this.showSuccess("Saved to favorites"))}catch(r){console.error("Error toggling favorite:",r),this.showError("Failed to update favorite status")}}async refreshStories(){if(window.syncService)try{await window.syncService.getStories(!0),await this.loadStories(),await this.initMap(),this.showSuccess("Stories refreshed successfully")}catch(i){this.showError("Failed to refresh stories: "+i.message)}else await this.loadStories(),await this.initMap()}viewStoryDetails(i){console.log("Open story details for:",i)}applyFilter(i){this.currentFilter=i;let o=this.stories;i==="with-location"?o=this.stories.filter(r=>r.lat&&r.lon):i==="recent"&&(o=this.stories.slice().sort((r,c)=>new Date(c.createdAt)-new Date(r.createdAt)).slice(0,10)),this.view.displayStories(o),this.mapService&&(this.mapService.clearMarkers(),o.forEach(r=>{r.lat&&r.lon&&this.mapService.addStoryMarker(r)}))}highlightStoryCard(i){document.querySelectorAll(".story-card.highlighted").forEach(r=>{r.classList.remove("highlighted")});const o=document.querySelector(`[data-story-id="${i}"]`);o&&o.classList.add("highlighted")}}class ql extends jt{constructor(){super(),this.title="Stories - App",this.presenter=new Hl(this)}async render(){return`
      <div class="container">
        <div class="page-header">
          <h1 class="page-title">üìö Story Map</h1>
          <p class="page-description">Browse compelling accounts submitted from many places</p>
        </div>

        <!-- Filter Controls -->
        <div class="filter-controls" role="tablist" aria-label="Story filters">
          <button class="filter-btn btn btn-outline active" data-filter="all" role="tab" aria-selected="true">
            All Stories
          </button>
        </div>

        <!-- Map Section -->
        <div class="card">
          <div class="card-header">
            <h2 class="card-title">üó∫Ô∏è Stories Map</h2>
            <p>Click a marker to open that story's summary</p>
          </div>
          <div id="stories-map" class="map-container" role="application" aria-label="Stories location map"></div>
        </div>

        <!-- Stories Grid -->
        <div class="stories-section">
          <h2 class="section-title">Story Listings</h2>
          <div id="stories-grid" class="story-grid" role="region" aria-label="Stories list">
            <!-- Stories will be injected here -->
          </div>
        </div>

        <!-- Empty state -->
        <div id="empty-state" class="empty-state" style="display: none;">
          <div class="empty-state-content">
            <div class="empty-icon"></div>
            <h3>No stories yet</h3>
            <p>There are currently no stories available.</p>
            <a href="#/add-story" class="btn btn-primary">Add Your First Story</a>
          </div>
        </div>
      </div>
    `}async afterRender(){await super.afterRender()}async displayStories(i){const o=document.getElementById("stories-grid"),r=document.getElementById("empty-state");if(!i||i.length===0){o.style.display="none",r.style.display="block";return}o.style.display="grid",r.style.display="none";const c=await Promise.all(i.map(async d=>{let h=!1;if(window.indexedDBService)try{h=await window.indexedDBService.isFavorite(d.id)}catch(b){console.warn("Failed to check favorite flag:",b)}const p=!!d.isOffline,g=!!d.syncPending,w=d.photoUrl||(p?d.photo:"/placeholder-image.jpg"),y=d.description||"Story image";return`
        <article class="story-card ${p?"offline-story":""}" data-story-id="${d.id}" tabindex="0" role="article">
          <div class="story-image-container">
            <img 
              src="${w}" 
              alt="${y}"
              class="story-image"
              loading="lazy"
            >
            <div class="story-actions">
              <button 
                class="favorite-btn ${h?"favorite-active":""}" 
                data-story-id="${d.id}"
                aria-label="${h?"Remove from favorites":"Add to favorites"}"
              >
                ${h?"‚ù§Ô∏è":"ü§ç"}
              </button>
            </div>
            ${g?'<div class="sync-indicator">üîÑ Sync Pending</div>':""}
          </div>
          <div class="story-content">
            <h3 class="story-title">${d.name||"Untitled Story"}</h3>
            <p class="story-description">${d.description||"No description provided"}</p>
            <div class="story-meta">
              <span class="story-author">üìù ${d.name||"Unknown author"}</span>
              <span class="story-date">üìÖ ${d.createdAt?new Date(d.createdAt).toLocaleDateString("en-US"):"‚Äî"}</span>
              ${p?'<span class="offline-badge">üì± Offline</span>':""}
            </div>
            ${d.lat&&d.lon?`
              <div class="story-location">
                üìç Lat: ${Number(d.lat).toFixed(4)}, Lon: ${Number(d.lon).toFixed(4)}
              </div>
            `:""}
          </div>
        </article>
      `}));o.innerHTML=c.join(""),this.presenter.setupEventListeners()}scrollToStory(i){const o=document.querySelector(`[data-story-id="${i}"]`);o&&(o.scrollIntoView({behavior:"smooth",block:"center"}),o.focus())}}class Wl{constructor(){this.stream=null,this.video=null,this.canvas=null,this.modal=null}async takePhoto(){return new Promise((i,o)=>{this.createCameraModal().then(()=>{this.setupCameraHandlers(i,o)}).catch(o)})}async createCameraModal(){const i=document.getElementById("camera-modal");i&&i.remove(),document.body.insertAdjacentHTML("beforeend",`
      <div id="camera-modal" class="camera-modal" role="dialog" aria-modal="true" aria-labelledby="camera-title">
        <div class="camera-modal-content">
          <div class="camera-header">
            <h3 id="camera-title">üì∑ Take Photo</h3>
            <button id="close-camera" class="close-btn" aria-label="Close camera">&times;</button>
          </div>
          
          <div class="camera-body">
            <div id="camera-container" class="camera-container">
              <video id="camera-video" autoplay playsinline aria-label="Camera preview"></video>
              <canvas id="camera-canvas" style="display: none;"></canvas>
              
              <div class="camera-overlay">
                <div class="camera-frame"></div>
              </div>
            </div>
            
            <div id="photo-preview" class="photo-preview" style="display: none;">
              <img id="captured-photo" src="" alt="Captured photo">
            </div>
          </div>
          
          <div class="camera-controls">
            <button id="capture-btn" class="btn btn-primary">
              üì∏ Capture Photo
            </button>
            <button id="retake-btn" class="btn btn-secondary" style="display: none;">
              üîÑ Retake
            </button>
            <button id="use-photo-btn" class="btn btn-success" style="display: none;">
              ‚úÖ Use Photo
            </button>
            <button id="cancel-camera" class="btn btn-outline">
              ‚ùå Cancel
            </button>
          </div>
          
          <div id="camera-error" class="camera-error" style="display: none;"></div>
        </div>
      </div>
    `),this.modal=document.getElementById("camera-modal"),this.video=document.getElementById("camera-video"),this.canvas=document.getElementById("camera-canvas"),document.body.style.overflow="hidden",this.modal.style.display="flex",document.getElementById("close-camera").focus(),await this.initCamera()}async initCamera(){try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new Error("Camera is not supported by your browser");const i={video:{width:{ideal:1280},height:{ideal:720},facingMode:"environment"},audio:!1};this.stream=await navigator.mediaDevices.getUserMedia(i),this.video.srcObject=this.stream,this.video.addEventListener("loadedmetadata",()=>{this.canvas.width=this.video.videoWidth,this.canvas.height=this.video.videoHeight});const o=document.getElementById("camera-error");o&&(o.style.display="none")}catch(i){throw console.error("Camera initialization failed:",i),this.showCameraError(this.getCameraErrorMessage(i)),i}}setupCameraHandlers(i,o){const r=document.getElementById("capture-btn"),c=document.getElementById("retake-btn"),d=document.getElementById("use-photo-btn"),h=document.getElementById("cancel-camera"),p=document.getElementById("close-camera");let g=null;r.addEventListener("click",()=>{try{this.canvas.getContext("2d").drawImage(this.video,0,0),this.canvas.toBlob(I=>{I&&(g=I,this.showPhotoPreview(),r.style.display="none",c.style.display="inline-flex",d.style.display="inline-flex")},"image/jpeg",.8)}catch(b){console.error("Failed to capture photo:",b),this.showCameraError("Failed to capture photo")}}),c.addEventListener("click",()=>{this.hidePhotoPreview(),g=null,r.style.display="inline-flex",c.style.display="none",d.style.display="none"}),d.addEventListener("click",()=>{if(g){const b=new File([g],`camera-photo-${Date.now()}.jpg`,{type:"image/jpeg"});this.closeCamera(),i(b)}});const w=()=>{this.closeCamera(),o(new Error("Photo capture cancelled"))};h.addEventListener("click",w),p.addEventListener("click",w);const y=b=>{b.key==="Escape"&&w()};document.addEventListener("keydown",y),this.modal.addEventListener("remove",()=>{document.removeEventListener("keydown",y)}),this.modal.addEventListener("click",b=>{b.target===this.modal&&w()})}showPhotoPreview(){const i=document.getElementById("camera-container"),o=document.getElementById("photo-preview"),r=document.getElementById("captured-photo"),c=this.canvas.toDataURL("image/jpeg",.8);r.src=c,i.style.display="none",o.style.display="block"}hidePhotoPreview(){const i=document.getElementById("camera-container"),o=document.getElementById("photo-preview");i.style.display="block",o.style.display="none"}showCameraError(i){const o=document.getElementById("camera-error");o&&(o.textContent=i,o.style.display="block");const r=document.getElementById("capture-btn");r&&(r.disabled=!0,r.textContent="Camera Not Available")}getCameraErrorMessage(i){return i.name==="NotAllowedError"?"Camera access denied. Please allow camera access and try again.":i.name==="NotFoundError"?"Camera not found on your device.":i.name==="NotSupportedError"?"Camera is not supported by your browser.":i.name==="NotReadableError"?"Camera is being used by another application.":i.message||"An error occurred while accessing the camera."}closeCamera(){this.stream&&(this.stream.getTracks().forEach(i=>{i.stop()}),this.stream=null),this.modal&&(this.modal.remove(),this.modal=null),document.body.style.overflow="",this.video=null,this.canvas=null}static isSupported(){return!!(navigator.mediaDevices&&navigator.mediaDevices.getUserMedia)}static async checkPermissions(){try{return navigator.permissions?(await navigator.permissions.query({name:"camera"})).state:"unknown"}catch(i){return console.warn("Could not check camera permissions:",i),"unknown"}}}class $l extends _i{constructor(i){super(i),this.mapService=null,this.cameraService=null,this.selectedLocation=null,this.selectedImage=null}async init(){if(!zt.isAuthenticated()){this.showError("You must log in first"),setTimeout(()=>{window.location.hash="#/login"},1500);return}await this.initMap(),this.initCamera(),this.setupEventListeners()}async initMap(){try{this.mapService&&this.mapService.reset(),this.mapService=new Ps("location-map"),await this.mapService.initMap(),this.mapService.onClick((i,o)=>{this.selectLocation(i,o)}),console.log("Map initialized successfully")}catch(i){console.error("Failed to initialize map:",i),this.showError("Failed to load map")}}initCamera(){this.cameraService=new Wl}selectLocation(i,o){this.selectedLocation={lat:i,lon:o},this.mapService.addTemporaryMarker(i,o),document.getElementById("latitude").value=i.toFixed(6),document.getElementById("longitude").value=o.toFixed(6),this.view.updateLocationInfo(i,o),this.showSuccess(`Location selected: ${i.toFixed(4)}, ${o.toFixed(4)}`)}setupEventListeners(){const i=document.getElementById("image");document.getElementById("image-preview"),i.addEventListener("change",d=>{const h=d.target.files[0];h&&this.handleImageSelect(h)});const o=document.getElementById("camera-btn");o&&o.addEventListener("click",()=>{this.openCamera()});const r=document.getElementById("current-location-btn");r&&r.addEventListener("click",()=>{this.getCurrentLocation()});const c=document.getElementById("add-story-form");c&&c.addEventListener("submit",d=>{d.preventDefault(),this.handleSubmit(new FormData(c))})}handleImageSelect(i){if(!i.type.startsWith("image/")){this.showError("File must be an image");return}if(i.size>5*1024*1024){this.showError("Maximum file size is 5MB");return}this.selectedImage=i,this.view.updateImagePreview(i)}async openCamera(){try{const i=await this.cameraService.takePhoto();i&&(this.selectedImage=i,this.view.updateImagePreview(i),this.showSuccess("Photo captured successfully!"))}catch(i){this.showError("Failed to access camera: "+i.message)}}getCurrentLocation(){if(!navigator.geolocation){this.showError("Geolocation is not supported by your browser");return}this.showLoading(),navigator.geolocation.getCurrentPosition(i=>{this.hideLoading();const{latitude:o,longitude:r}=i.coords;this.selectLocation(o,r),this.mapService.setView(o,r,15)},i=>{this.hideLoading();let o="Failed to get location";switch(i.code){case i.PERMISSION_DENIED:o="Location access denied. Please select a location manually on the map.";break;case i.POSITION_UNAVAILABLE:o="Location information is unavailable";break;case i.TIMEOUT:o="Location request timed out";break}this.showError(o)},{enableHighAccuracy:!0,timeout:1e4,maximumAge:6e4})}async handleSubmit(i){try{if(!this.selectedImage){this.showError("Please pick or capture a photo first");return}if(!this.selectedLocation){this.showError("Please select a location on the map");return}const o=i.get("description");if(!o||o.trim().length<10){this.showError("Description must be at least 10 characters");return}this.showLoading();const r={description:o.trim(),photo:this.selectedImage,lat:this.selectedLocation.lat,lon:this.selectedLocation.lon,name:o.trim().split(" ").slice(0,5).join(" ")};if(navigator.onLine)try{const d=new FormData;d.append("description",r.description),d.append("photo",r.photo),d.append("lat",r.lat),d.append("lon",r.lon);const h=await zt.addStory(d);if(h.error===!1){this.hideLoading(),this.showSuccess("Story added successfully!"),this.showLocalNotification(r),setTimeout(()=>{window.location.hash="#/stories"},2e3);return}else throw new Error(h.message||"Failed to submit story online")}catch(d){console.warn("Online submission failed, falling back to offline mode:",d)}await this.handleOfflineSubmission(r)}catch(o){this.hideLoading(),this.showError("An error occurred: "+o.message)}}async handleOfflineSubmission(i){try{if(window.syncService&&typeof window.syncService.addStoryOffline=="function")await window.syncService.addStoryOffline(i),this.hideLoading(),this.showSuccess("Story saved offline! It will be synchronized when connection is restored."),this.showLocalNotification({...i,name:i.name+" (Offline)"}),setTimeout(()=>{window.location.hash="#/stories"},2e3);else throw new Error("Offline service is not available")}catch(o){this.hideLoading(),this.showError("Failed to save story: "+o.message)}}showLocalNotification(i){try{if(console.log("üì¢ Attempting to show local notification..."),window.pushNotificationService){if(typeof window.pushNotificationService.simulateNewStoryNotification=="function"){window.pushNotificationService.simulateNewStoryNotification(i);return}else if(typeof window.pushNotificationService.showLocalNotification=="function"){window.pushNotificationService.showLocalNotification("New Story Added",i.description,{id:i.id||Date.now().toString()});return}}if("Notification"in window&&Notification.permission==="granted"){const o=new Notification("üìñ New Story Added",{body:i.description.substring(0,100)+"...",icon:"/images/story.png",tag:"new-story"});o.onclick=()=>{window.focus(),window.location.hash="#/stories",o.close()},console.log("‚úÖ Local notification shown successfully")}else console.log("‚ÑπÔ∏è Notification not available or permission not granted")}catch(o){console.warn("‚ö†Ô∏è Failed to show local notification:",o)}}}class jl extends jt{constructor(){super(),this.title="Add Story - App",this.presenter=new $l(this)}async render(){return`
      <div class="container">
        <div class="page-header">
          <h1 class="page-title">Add New Story</h1>
          <p class="page-description">Share your experience or memorable moments</p>
        </div>

        <div class="add-story-container">
          <form id="add-story-form" class="story-form" novalidate>
            
            <!-- Image Upload Section -->
            <div class="card">
              <div class="card-header">
                <h2 class="card-title">üì∑ Choose Photo</h2>
                <p>Upload an image or capture directly using your camera</p>
              </div>
              
              <div class="image-upload-section">
                <div class="upload-options">
                  <label for="image" class="upload-btn btn btn-outline">
                    üìÅ Choose Photo
                    <input 
                      type="file" 
                      id="image" 
                      name="image" 
                      accept="image/*" 
                      hidden 
                      required
                      aria-describedby="image-help"
                    >
                  </label>
                  
                <div id="image-preview" class="image-preview" style="display: none;">
                  <img id="preview-img" src="" alt="Selected photo preview">
                  <div class="preview-info">
                    <span id="preview-name"></span>
                    <span id="preview-size"></span>
                  </div>
                </div>
              </div>
            </div>

            <!-- Story Details Section -->
            <div class="card">
              <div class="card-header">
                <h2 class="card-title">Details</h2>
              </div>
              
              <div class="form-group">
                <label for="description" class="form-label">Story Description</label>
                <textarea 
                  id="description" 
                  name="description" 
                  class="form-textarea" 
                  required 
                  aria-describedby="description-help description-error"
                  placeholder="Tell your memorable experience..."
                  minlength="10"
                  maxlength="1000"
                ></textarea>
                <div id="description-help" class="form-help">
                  Minimum 10 characters, maximum 1000 characters
                </div>
                <div id="description-error" class="form-error" aria-live="polite"></div>
              </div>
            </div>

            <!-- Location Selection Section -->
            <div class="card">
              <div class="card-header">
                <h2 class="card-title">üìç Pick Location</h2>
                <p>Click on the map to choose the location for your story</p>
              </div>
              
              <div class="location-controls">
                <button type="button" id="current-location-btn" class="btn btn-outline">
                  üéØ Use Current Location
                </button>
              </div>
              
              <div id="location-map" class="map-container" role="application" aria-label="Map to choose story location"></div>
              
              <div class="location-info">
                <div class="location-fields">
                  <div class="form-group">
                    <label for="latitude" class="form-label">Latitude</label>
                    <input 
                      type="number" 
                      id="latitude" 
                      name="latitude" 
                      class="form-input" 
                      step="any" 
                      readonly
                      aria-describedby="latitude-help"
                    >
                    <div id="latitude-help" class="form-help">Automatically selected from the map</div>
                  </div>
                  
                  <div class="form-group">
                    <label for="longitude" class="form-label">Longitude</label>
                    <input 
                      type="number" 
                      id="longitude" 
                      name="longitude" 
                      class="form-input" 
                      step="any" 
                      readonly
                      aria-describedby="longitude-help"
                    >
                    <div id="longitude-help" class="form-help">Automatically selected from the map</div>
                  </div>
                </div>
                
                <div id="location-display" class="location-display">
                  <span class="location-status">Click on the map to choose a location</span>
                </div>
              </div>
            </div>

            <!-- Submit Section -->
            <div class="form-actions">
              <button type="submit" class="btn btn-primary">
                ‚úÖ Publish Story
              </button>
              <a href="#/stories" class="btn btn-outline">
                ‚ùå Cancel
              </a>
            </div>
            
          </form>
        </div>
      </div>
    `}async afterRender(){await super.afterRender(),await this.presenter.init()}updateImagePreview(i){const o=document.getElementById("image-preview"),r=document.getElementById("preview-img"),c=document.getElementById("preview-name"),d=document.getElementById("preview-size"),h=new FileReader;h.onload=p=>{r.src=p.target.result,c.textContent=i.name,d.textContent=this.formatFileSize(i.size),o.style.display="block"},h.readAsDataURL(i)}updateLocationInfo(i,o){const r=document.getElementById("location-display");r.innerHTML=`
      <span class="location-status success">
        ‚úÖ Location selected: ${i.toFixed(4)}, ${o.toFixed(4)}
      </span>
    `}formatFileSize(i){if(i===0)return"0 Bytes";const o=1024,r=["Bytes","KB","MB","GB"],c=Math.floor(Math.log(i)/Math.log(o));return parseFloat((i/Math.pow(o,c)).toFixed(2))+" "+r[c]}}class Vl extends jt{constructor(){super(),this.favorites=[],this.filteredFavorites=[],this.currentSort="addedAt",this.sortOrder="desc",this.searchQuery=""}async render(){return`
      <div class="favorites-page">
        <div class="page-header">
          <h1>üìö Favorite Stories</h1>
          <p>Manage and explore your favorite stories</p>
        </div>

        <div class="favorites-controls">
          <div class="search-section">
            <label for="search-favorites" class="sr-only">Search favorites</label>
            <input 
              type="search" 
              id="search-favorites" 
              placeholder="Search favorite stories..."
              class="search-input"
              aria-describedby="search-help"
            />
            <span id="search-help" class="sr-only">Type to search stories by title or description</span>
          </div>

          <div class="filter-section">
            <label for="sort-favorites">Sort by:</label>
            <select id="sort-favorites" class="sort-select">
              <option value="addedAt-desc">Newest added</option>
              <option value="addedAt-asc">Oldest added</option>
              <option value="name-asc">Name A-Z</option>
              <option value="name-desc">Name Z-A</option>
              <option value="createdAt-desc">Newest story date</option>
              <option value="createdAt-asc">Oldest story date</option>
            </select>
          </div>

          <div class="action-buttons">
            <button id="refresh-favorites" class="btn btn-secondary" aria-label="Reload favorites list">
              üîÑ Refresh
            </button>
            <button id="clear-favorites" class="btn btn-danger" aria-label="Clear all favorites">
              üóëÔ∏è Clear All
            </button>
            <button id="export-favorites" class="btn btn-info" aria-label="Export favorites to JSON">
              üíæ Export
            </button>
          </div>
        </div>

        <div class="sync-status-card">
          <div class="sync-info">
            <span id="sync-status" class="sync-status">Checking...</span>
            <button id="force-sync" class="btn btn-sm btn-primary" style="display: none;">
              üîÑ Sync Now
            </button>
          </div>
          <div class="offline-indicator" id="offline-indicator" style="display: none;">
            üì± Offline Mode - Some features limited
          </div>
        </div>

        <div class="favorites-stats">
          <div class="stats-grid">
            <div class="stat-card">
              <h3 id="total-favorites">0</h3>
              <p>Total Favorites</p>
            </div>
            <div class="stat-card">
              <h3 id="this-month">0</h3>
              <p>This Month</p>
            </div>
            <div class="stat-card">
              <h3 id="storage-used">0 KB</h3>
              <p>Storage</p>
            </div>
          </div>
        </div>

        <div class="favorites-grid" id="favorites-grid" role="region" aria-label="Favorite stories list">
          <div class="loading-message">Loading favorites...</div>
        </div>

        <div class="empty-state" id="empty-state" style="display: none;">
          <div class="empty-icon">üìö</div>
          <h2>No favorite stories yet</h2>
          <p>Add stories to favorites by clicking the ‚ù§Ô∏è icon on the stories page</p>
          <a href="#/stories" class="btn btn-primary">Explore Stories</a>
        </div>

        <!-- Push Notification Controls -->
        <div class="push-notification-section">
          <h2>üîî Notifications</h2>
          <div class="notification-controls">
            <div class="notification-status">
              <span id="push-status" class="status-inactive">Push notifications inactive</span>
            </div>
            <button id="push-toggle-btn" class="btn btn-secondary">
              üîï Enable Notifications
            </button>
            <button id="test-notification" class="btn btn-info">
              üß™ Test Notification
            </button>
          </div>
        </div>
      </div>
    `}async afterRender(){await this.loadFavorites(),this.setupEventListeners(),this.updateSyncStatus(),this.updateStats()}setupEventListeners(){var r,c,d,h,p,g;const i=document.getElementById("search-favorites");i==null||i.addEventListener("input",w=>{this.searchQuery=w.target.value.toLowerCase(),this.filterAndDisplayFavorites()});const o=document.getElementById("sort-favorites");o==null||o.addEventListener("change",w=>{const[y,b]=w.target.value.split("-");this.currentSort=y,this.sortOrder=b,this.filterAndDisplayFavorites()}),(r=document.getElementById("refresh-favorites"))==null||r.addEventListener("click",()=>{this.loadFavorites()}),(c=document.getElementById("clear-favorites"))==null||c.addEventListener("click",()=>{this.clearAllFavorites()}),(d=document.getElementById("export-favorites"))==null||d.addEventListener("click",()=>{this.exportFavorites()}),(h=document.getElementById("force-sync"))==null||h.addEventListener("click",()=>{this.forceSync()}),(p=document.getElementById("push-toggle-btn"))==null||p.addEventListener("click",()=>{var w;(w=window.pushNotificationService)==null||w.toggleSubscription()}),(g=document.getElementById("test-notification"))==null||g.addEventListener("click",()=>{var w;(w=window.pushNotificationService)==null||w.testNotification()}),window.addEventListener("online",()=>this.updateSyncStatus()),window.addEventListener("offline",()=>this.updateSyncStatus())}async loadFavorites(){try{if(this.showLoading(!0),!window.indexedDBService)throw new Error("IndexedDB service not available");this.favorites=await window.indexedDBService.getFavorites(),console.log("Loaded favorites:",this.favorites.length),this.filterAndDisplayFavorites(),this.updateStats()}catch(i){console.error("Error loading favorites:",i),this.showError("Failed to load favorites: "+i.message)}finally{this.showLoading(!1)}}filterAndDisplayFavorites(){this.filteredFavorites=this.favorites.filter(i=>{var r,c;if(!this.searchQuery)return!0;const o=i.storyData;return((r=o.name)==null?void 0:r.toLowerCase().includes(this.searchQuery))||((c=o.description)==null?void 0:c.toLowerCase().includes(this.searchQuery))}),this.filteredFavorites.sort((i,o)=>{var d,h;let r,c;return this.currentSort==="addedAt"?(r=new Date(i.addedAt),c=new Date(o.addedAt)):this.currentSort==="createdAt"?(r=new Date(i.storyData.createdAt),c=new Date(o.storyData.createdAt)):this.currentSort==="name"&&(r=((d=i.storyData.name)==null?void 0:d.toLowerCase())||"",c=((h=o.storyData.name)==null?void 0:h.toLowerCase())||""),this.sortOrder==="asc"?r>c?1:-1:r<c?1:-1}),this.displayFavorites()}displayFavorites(){const i=document.getElementById("favorites-grid"),o=document.getElementById("empty-state");if(i){if(this.filteredFavorites.length===0){i.style.display="none",o.style.display="block";return}o.style.display="none",i.style.display="grid",i.innerHTML=this.filteredFavorites.map(r=>this.renderFavoriteCard(r)).join(""),this.setupFavoriteCardListeners()}}renderFavoriteCard(i){const o=i.storyData,r=new Date(i.addedAt).toLocaleDateString("en-US"),c=new Date(o.createdAt).toLocaleDateString("en-US");return`
      <article class="favorite-card" data-story-id="${o.id}">
        <div class="favorite-image">
          ${o.photoUrl?`<img src="${o.photoUrl}" alt="Story photo ${o.name}" loading="lazy" />`:'<div class="placeholder-image">üì∑</div>'}
        </div>
        
        <div class="favorite-content">
          <h3 class="favorite-title">${this.escapeHtml(o.name||"Untitled story")}</h3>
          <p class="favorite-description">
            ${this.escapeHtml(this.truncateText(o.description||"",100))}
          </p>
          
          <div class="favorite-meta">
            <span class="story-date">üìÖ ${c}</span>
            <span class="added-date">‚ù§Ô∏è ${r}</span>
            ${o.lat&&o.lon?'<span class="has-location">üìç Location</span>':""}
          </div>
        </div>
        
        <div class="favorite-actions">
          <button class="btn btn-sm btn-primary view-story" data-story-id="${o.id}">
            üëÅÔ∏è View
          </button>
          ${o.lat&&o.lon?`<button class="btn btn-sm btn-info view-map" data-lat="${o.lat}" data-lon="${o.lon}">
                 üó∫Ô∏è Map
               </button>`:""}
          <button class="btn btn-sm btn-danger remove-favorite" data-story-id="${o.id}">
            üóëÔ∏è Remove
          </button>
        </div>
      </article>
    `}setupFavoriteCardListeners(){document.querySelectorAll(".view-story").forEach(i=>{i.addEventListener("click",o=>{const r=o.target.getAttribute("data-story-id");window.location.hash=`#/stories/${r}`})}),document.querySelectorAll(".view-map").forEach(i=>{i.addEventListener("click",o=>{const r=o.target.getAttribute("data-lat"),c=o.target.getAttribute("data-lon");window.location.hash=`#/stories?lat=${r}&lon=${c}`})}),document.querySelectorAll(".remove-favorite").forEach(i=>{i.addEventListener("click",async o=>{const r=o.target.getAttribute("data-story-id");await this.removeFavorite(r)})})}async removeFavorite(i){if(confirm("Are you sure you want to remove this story from favorites?"))try{await window.indexedDBService.removeFromFavorites(i),this.showMessage("Story removed from favorites","success"),await this.loadFavorites()}catch(o){console.error("Error removing favorite:",o),this.showMessage("Failed to remove favorite: "+o.message,"error")}}async clearAllFavorites(){if(confirm("Are you sure you want to remove ALL favorite stories? This action cannot be undone."))try{for(const i of this.favorites)await window.indexedDBService.removeFromFavorites(i.storyId);this.showMessage("All favorites removed successfully","success"),await this.loadFavorites()}catch(i){console.error("Error clearing favorites:",i),this.showMessage("Failed to remove all favorites: "+i.message,"error")}}async exportFavorites(){try{const i={exportDate:new Date().toISOString(),totalFavorites:this.favorites.length,favorites:this.favorites},o=new Blob([JSON.stringify(i,null,2)],{type:"application/json"}),r=URL.createObjectURL(o),c=document.createElement("a");c.href=r,c.download=`app-favorites-${new Date().toISOString().split("T")[0]}.json`,document.body.appendChild(c),c.click(),document.body.removeChild(c),URL.revokeObjectURL(r),this.showMessage("Favorites exported successfully","success")}catch(i){console.error("Error exporting favorites:",i),this.showMessage("Failed to export favorites: "+i.message,"error")}}async forceSync(){var i;try{this.showMessage("Starting synchronization...","info"),await((i=window.syncService)==null?void 0:i.forcSync()),this.showMessage("Synchronization completed","success"),this.updateSyncStatus()}catch(o){console.error("Error during force sync:",o),this.showMessage("Failed to synchronize: "+o.message,"error")}}updateSyncStatus(){var d;const i=document.getElementById("sync-status"),o=document.getElementById("offline-indicator"),r=document.getElementById("force-sync");if(!i)return;navigator.onLine?(i.textContent="üü¢ Online",i.className="sync-status online",o.style.display="none",(d=window.syncService)==null||d.hasPendingChanges().then(h=>{r&&(r.style.display=h?"inline-block":"none")})):(i.textContent="üî¥ Offline",i.className="sync-status offline",o.style.display="block",r&&(r.style.display="none"))}async updateStats(){try{const i=document.getElementById("total-favorites"),o=document.getElementById("this-month"),r=document.getElementById("storage-used");i&&(i.textContent=this.favorites.length);const c=new Date,d=new Date(c.getFullYear(),c.getMonth(),1),h=this.favorites.filter(p=>new Date(p.addedAt)>=d).length;if(o&&(o.textContent=h),window.indexedDBService){const p=await window.indexedDBService.getDBStats();r&&(r.textContent=`${p.totalSize} KB`)}}catch(i){console.error("Error updating stats:",i)}}showLoading(i){const o=document.getElementById("favorites-grid");o&&i&&(o.innerHTML='<div class="loading-message">Memuat favorit...</div>')}showError(i){const o=document.getElementById("favorites-grid");o&&(o.innerHTML=`
      <div class="error-message">
        <p>‚ùå ${i}</p>
        <button onclick="location.reload()" class="btn btn-primary">Muat Ulang</button>
      </div>
    `)}showMessage(i,o="info"){typeof window.showMessage=="function"?window.showMessage(i,o):console.log(`[${o.toUpperCase()}] ${i}`)}truncateText(i,o){return i.length<=o?i:i.substring(0,o)+"..."}escapeHtml(i){const o=document.createElement("div");return o.textContent=i,o.innerHTML}}async function pn(){var i,o;const a="https://story-api.dicoding.dev/v1";console.log("=== Testing Story API ==="),console.log(`
1. Testing Registration...`);try{const r={name:"Test User "+Date.now(),email:`test${Date.now()}@example.com`,password:"testpass123"};console.log("Sending registration data:",r);const c=await fetch(`${a}/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)}),d=await c.json();if(console.log("Registration response status:",c.status),console.log("Registration response:",d),c.ok){console.log("‚úÖ Registration successful"),console.log(`
2. Testing Login...`);const h={email:r.email,password:r.password};console.log("Sending login data:",h);const p=await fetch(`${a}/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),g=await p.json();if(console.log("Login response status:",p.status),console.log("Login response:",g),p.ok&&((i=g.loginResult)!=null&&i.token)){console.log("‚úÖ Login successful");const w=g.loginResult.token;console.log(`
3. Testing Get Stories...`);const y=await fetch(`${a}/stories`,{headers:{Authorization:`Bearer ${w}`}}),b=await y.json();console.log("Stories response status:",y.status),console.log("Stories count:",((o=b.listStory)==null?void 0:o.length)||0),y.ok?console.log("‚úÖ Get stories successful"):console.log("‚ùå Get stories failed:",b)}else console.log("‚ùå Login failed:",g)}else console.log("‚ùå Registration failed:",d)}catch(r){console.error("‚ùå API Test failed:",r)}}async function mn(){var a,i;console.log(`
=== Testing Public Stories ===`);try{const o=await fetch("https://story-api.dicoding.dev/v1/stories"),r=await o.json();console.log("Public stories response status:",o.status),console.log("Public stories count:",((a=r.listStory)==null?void 0:a.length)||0),o.ok?(console.log("‚úÖ Public stories accessible"),r.listStory&&r.listStory.length>0&&console.log("Sample story:",{id:r.listStory[0].id,name:r.listStory[0].name,description:((i=r.listStory[0].description)==null?void 0:i.substring(0,100))+"...",hasLocation:!!(r.listStory[0].lat&&r.listStory[0].lon)})):console.log("‚ùå Public stories failed:",r)}catch(o){console.error("‚ùå Public stories test failed:",o)}}typeof window<"u"?(window.testStoryAPI=pn,window.testPublicStories=mn,console.log("API Test functions loaded. Run in console:"),console.log("- testStoryAPI()"),console.log("- testPublicStories()")):mn().then(()=>pn());class Gl extends jt{constructor(){super(),this.title="API Test - App"}async render(){return`
      <div class="container">
        <div class="page-header">
          <h1 class="page-title">üîß API Test Page</h1>
          <p class="page-description">Debug dan test Story API endpoints</p>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Manual API Tests</h2>
          </div>
          
          <div style="display: flex; gap: 12px; flex-wrap: wrap; margin-bottom: 20px;">
            <button id="test-public-btn" class="btn btn-primary">Test Public Stories</button>
            <button id="test-register-btn" class="btn btn-secondary">Test Registration & Login</button>
            <button id="clear-console-btn" class="btn btn-outline">Clear Console</button>
          </div>
          
          <div id="test-results" class="test-results">
            <p>Hasil test akan muncul di console browser. Tekan F12 untuk melihat console.</p>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Manual Registration Test</h2>
          </div>
          
          <form id="manual-register-form">
            <div class="form-group">
              <label for="test-name" class="form-label">Name</label>
              <input type="text" id="test-name" class="form-input" value="Test User">
            </div>
            
            <div class="form-group">
              <label for="test-email" class="form-label">Email</label>
              <input type="email" id="test-email" class="form-input" value="">
            </div>
            
            <div class="form-group">
              <label for="test-password" class="form-label">Password</label>
              <input type="password" id="test-password" class="form-input" value="testpass123">
            </div>
            
            <button type="submit" class="btn btn-primary">Test Manual Register</button>
          </form>
          
          <div id="manual-result" style="margin-top: 20px; padding: 16px; background: #f8f9fa; border-radius: 8px; display: none;">
            <pre id="manual-result-text"></pre>
          </div>
        </div>

        <div class="card">
          <div class="card-header">
            <h2 class="card-title">Current App State</h2>
          </div>
          
          <div id="app-state">
            <p><strong>Current URL:</strong> <span id="current-url">${window.location.href}</span></p>
            <p><strong>Auth Token:</strong> <span id="auth-token">${localStorage.getItem("token")?"‚úÖ Present":"‚ùå Not found"}</span></p>
            <p><strong>Browser:</strong> <span id="browser-info">${navigator.userAgent}</span></p>
            <button id="clear-token-btn" class="btn btn-outline">Clear Token</button>
          </div>
        </div>
      </div>
    `}async afterRender(){await super.afterRender(),this.setupEventListeners(),this.generateTestEmail()}generateTestEmail(){const o=`test${Date.now()}@example.com`;document.getElementById("test-email").value=o}setupEventListeners(){document.getElementById("test-public-btn").addEventListener("click",async()=>{console.log("üîç Testing Public Stories..."),await mn()}),document.getElementById("test-register-btn").addEventListener("click",async()=>{console.log("üîç Testing Registration & Login..."),await pn()}),document.getElementById("clear-console-btn").addEventListener("click",()=>{console.clear(),console.log("üßπ Console cleared")}),document.getElementById("clear-token-btn").addEventListener("click",()=>{localStorage.removeItem("token"),document.getElementById("auth-token").textContent="‚ùå Not found",console.log("üßπ Token cleared")}),document.getElementById("manual-register-form").addEventListener("submit",async i=>{i.preventDefault(),await this.testManualRegister()})}async testManualRegister(){const i=document.getElementById("test-name").value,o=document.getElementById("test-email").value,r=document.getElementById("test-password").value,c=document.getElementById("manual-result"),d=document.getElementById("manual-result-text");try{console.log("üîç Manual Registration Test Started...");const h={name:i,email:o,password:r};console.log("Sending data:",h);const p=await fetch("https://story-api.dicoding.dev/v1/register",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(h)}),g=await p.json();console.log("Response status:",p.status),console.log("Response data:",g),c.style.display="block",d.textContent=JSON.stringify({status:p.status,statusText:p.statusText,data:g},null,2),p.ok?this.showSuccess("Registration test successful!"):this.showError(`Registration test failed: ${g.message||"Unknown error"}`)}catch(h){console.error("Manual registration test error:",h),c.style.display="block",d.textContent=`Error: ${h.message}`,this.showError(`Test failed: ${h.message}`)}}}const ln={"/":new Ol,"/about":new Ml,"/login":new Rl,"/register":new Dl,"/stories":new ql,"/add-story":new jl,"/favorites":new Vl,"/test":new Gl};function Kl(a){const i=a.split("/");return{resource:i[1]||null,id:i[2]||null}}function Jl(a){let i="";return a.resource&&(i=i.concat(`/${a.resource}`)),a.id&&(i=i.concat("/:id")),i||"/"}function Yl(){return location.hash.replace("#","")||"/"}function Ql(){const a=Yl(),i=Kl(a);return Jl(i)}class Qo{static isSupported(){return"startViewTransition"in document}static async transitionTo(i){return this.isSupported()?document.startViewTransition(i):i()}static async slideTransition(i,o="right"){if(!this.isSupported())return i();const r=document.getElementById("main-content");r&&(r.style.viewTransitionName=`slide-${o}`);try{await document.startViewTransition(i).finished}catch(c){console.warn("View transition failed:",c)}finally{r&&(r.style.viewTransitionName="")}}static async fadeTransition(i){if(!this.isSupported())return i();const o=document.getElementById("main-content");o&&(o.style.viewTransitionName="fade");try{await document.startViewTransition(i).finished}catch(r){console.warn("View transition failed:",r)}finally{o&&(o.style.viewTransitionName="")}}}const Xl={"/":{type:"fade",duration:300},"/stories":{type:"slide",direction:"left",duration:400},"/add-story":{type:"slide",direction:"up",duration:350},"/login":{type:"fade",duration:250},"/register":{type:"fade",duration:250},"/about":{type:"slide",direction:"right",duration:300}};var Dt,St,_t,Fe,Ft,Ts,As,gn;class tc{constructor({navigationDrawer:i,drawerButton:o,content:r}){fe(this,Ft);fe(this,Dt,null);fe(this,St,null);fe(this,_t,null);fe(this,Fe,null);Me(this,Dt,r),Me(this,St,o),Me(this,_t,i),Be(this,Ft,Ts).call(this),Be(this,Ft,As).call(this)}async renderPage(){try{const i=Ql();console.log("Rendering page for URL:",i);const o=ln[i];if(!o){console.error("Page not found for route:",i),console.log("Available routes:",Object.keys(ln)),V(this,Dt).innerHTML=`
          <div style="text-align: center; padding: 2rem;">
            <h1>404 - Page Not Found</h1>
            <p>Route "${i}" not found</p>
            <p>Available routes: ${Object.keys(ln).join(", ")}</p>
            <a href="#/" style="color: blue; text-decoration: underline;">Go Home</a>
          </div>
        `;return}console.log("Page found:",o.constructor.name);const r=Xl[i]||{type:"fade"},c=async()=>{console.log("Updating content for:",o.constructor.name),document.title=o.title||"App";const d=await o.render();console.log("Content rendered, length:",d.length);const h=document.getElementById("initialization-status");h&&h.remove(),V(this,Dt).innerHTML=d,V(this,Dt).setAttribute("tabindex","-1"),V(this,Dt).focus(),await o.afterRender(),console.log("After render completed"),Me(this,Fe,i)};try{r.type==="slide"?await Qo.slideTransition(c,r.direction):await Qo.fadeTransition(c)}catch(d){console.warn("View transition failed, falling back to regular update:",d),await c()}console.log("Page render completed successfully")}catch(i){console.error("Error in renderPage:",i),V(this,Dt).innerHTML=`
        <div style="text-align: center; padding: 2rem; color: red;">
          <h1>‚ö†Ô∏è Render Error</h1>
          <p>Failed to render page</p>
          <p>Error: ${i.message}</p>
          <button onclick="location.reload()">üîÑ Reload</button>
        </div>
      `}}getCurrentRoute(){return V(this,Fe)}}Dt=new WeakMap,St=new WeakMap,_t=new WeakMap,Fe=new WeakMap,Ft=new WeakSet,Ts=function(){const i=()=>{const o=V(this,_t).classList.contains("open");V(this,_t).classList.toggle("open"),V(this,St).setAttribute("aria-expanded",(!o).toString());const r=o?"Navigation drawer closed":"Navigation drawer opened";Be(this,Ft,gn).call(this,r)};V(this,St).addEventListener("click",i),V(this,St).addEventListener("keydown",o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),i())}),document.body.addEventListener("click",o=>{!V(this,_t).contains(o.target)&&!V(this,St).contains(o.target)&&(V(this,_t).classList.remove("open"),V(this,St).setAttribute("aria-expanded","false")),V(this,_t).querySelectorAll("a").forEach(r=>{r.contains(o.target)&&(V(this,_t).classList.remove("open"),V(this,St).setAttribute("aria-expanded","false"))})}),document.addEventListener("keydown",o=>{o.key==="Escape"&&V(this,_t).classList.contains("open")&&(V(this,_t).classList.remove("open"),V(this,St).setAttribute("aria-expanded","false"),V(this,St).focus(),Be(this,Ft,gn).call(this,"Navigation drawer closed"))})},As=function(){const i=V(this,_t).querySelectorAll('a[role="menuitem"]');i.forEach((o,r)=>{o.addEventListener("keydown",c=>{switch(c.key){case"ArrowDown":c.preventDefault();const d=(r+1)%i.length;i[d].focus();break;case"ArrowUp":c.preventDefault();const h=(r-1+i.length)%i.length;i[h].focus();break;case"Home":c.preventDefault(),i[0].focus();break;case"End":c.preventDefault(),i[i.length-1].focus();break}})})},gn=function(i){const o=document.createElement("div");o.setAttribute("aria-live","polite"),o.setAttribute("aria-atomic","true"),o.className="sr-only",o.textContent=i,document.body.appendChild(o),setTimeout(()=>{document.body.removeChild(o)},1e3)};class pi{static manageFocus(){document.addEventListener("keydown",i=>{const o=document.querySelector('.camera-modal[style*="flex"]');o&&i.key==="Tab"&&this.trapFocus(i,o)})}static trapFocus(i,o){const r=o.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])'),c=r[0],d=r[r.length-1];i.shiftKey?document.activeElement===c&&(d.focus(),i.preventDefault()):document.activeElement===d&&(c.focus(),i.preventDefault())}static announce(i,o="polite"){const r=document.getElementById("live-announcer")||this.createAnnouncer();r.setAttribute("aria-live",o),r.textContent=i,setTimeout(()=>{r.textContent=""},1e3)}static createAnnouncer(){const i=document.createElement("div");return i.id="live-announcer",i.setAttribute("aria-live","polite"),i.setAttribute("aria-atomic","true"),i.className="sr-only",document.body.appendChild(i),i}static enhanceKeyboardNavigation(){document.addEventListener("keydown",i=>{const o=i.target;o.classList.contains("story-card")&&this.handleCardKeyboard(i,o),o.classList.contains("filter-btn")&&this.handleFilterKeyboard(i,o)}),this.addFocusIndicators()}static handleCardKeyboard(i,o){var d;const r=Array.from(document.querySelectorAll(".story-card")),c=r.indexOf(o);switch(i.key){case"ArrowRight":case"ArrowDown":i.preventDefault();const h=(c+1)%r.length;r[h].focus();break;case"ArrowLeft":case"ArrowUp":i.preventDefault();const p=(c-1+r.length)%r.length;r[p].focus();break;case"Home":i.preventDefault(),r[0].focus();break;case"End":i.preventDefault(),r[r.length-1].focus();break;case"Enter":case" ":i.preventDefault();const g=o.dataset.storyId;if(g){this.announce(`Cerita ${(d=o.querySelector(".story-title"))==null?void 0:d.textContent} dipilih`);const w=new CustomEvent("highlightMarker",{detail:g});document.dispatchEvent(w)}break}}static handleFilterKeyboard(i,o){const r=Array.from(document.querySelectorAll(".filter-btn")),c=r.indexOf(o);switch(i.key){case"ArrowRight":i.preventDefault();const d=(c+1)%r.length;r[d].focus();break;case"ArrowLeft":i.preventDefault();const h=(c-1+r.length)%r.length;r[h].focus();break;case"Home":i.preventDefault(),r[0].focus();break;case"End":i.preventDefault(),r[r.length-1].focus();break;case"Enter":case" ":i.preventDefault(),o.click(),this.announce(`Filter ${o.textContent} diterapkan`);break}}static addFocusIndicators(){const i=document.createElement("style");i.textContent=`
      .story-card:focus,
      .feature-card:focus,
      .filter-btn:focus,
      .marker-pin:focus {
        outline: 3px solid var(--primary-color);
        outline-offset: 2px;
      }
      
      .story-card:focus {
        transform: translateY(-2px);
        box-shadow: 0 8px 25px rgba(37, 99, 235, 0.2);
      }
      
      /* High contrast mode support */
      @media (prefers-contrast: high) {
        .story-card:focus,
        .feature-card:focus,
        .btn:focus {
          outline: 3px solid currentColor;
        }
      }
      
      /* Reduced motion support */
      @media (prefers-reduced-motion: reduce) {
        .story-card,
        .feature-card,
        .btn {
          transition: none;
        }
        
        .spinner {
          animation: none;
        }
        
        .marker-pin {
          animation: none;
        }
      }
    `,document.head.appendChild(i)}static announceFormErrors(i){const o=i.querySelectorAll(".form-error:not(:empty)");if(o.length>0){const r=Array.from(o).map(c=>c.textContent);this.announce(`${o.length} kesalahan ditemukan: ${r.join(", ")}`,"assertive")}}static announcePageChange(i){this.announce(`Halaman ${i} dimuat`,"polite")}static announceLoadingState(i,o=""){i?this.announce(`Memuat${o?" "+o:""}...`,"polite"):this.announce(`Selesai memuat${o?" "+o:""}`,"polite")}static checkColorContrast(){window.matchMedia("(prefers-contrast: high)").matches&&document.body.classList.add("high-contrast-mode")}static respectMotionPreference(){window.matchMedia("(prefers-reduced-motion: reduce)").matches&&document.body.classList.add("reduced-motion")}static init(){this.manageFocus(),this.enhanceKeyboardNavigation(),this.createAnnouncer(),this.addFocusIndicators(),this.checkColorContrast(),this.respectMotionPreference(),window.matchMedia("(prefers-contrast: high)").addEventListener("change",this.checkColorContrast),window.matchMedia("(prefers-reduced-motion: reduce)").addEventListener("change",this.respectMotionPreference)}static setupSkipLinks(){const i=document.querySelector(".skip-to-content");i&&i.addEventListener("click",o=>{o.preventDefault();const r=document.querySelector(i.getAttribute("href"));r&&(r.focus(),r.scrollIntoView({behavior:"smooth"}))})}}const ze=Object.freeze(Object.defineProperty({__proto__:null,AccessibilityUtils:pi},Symbol.toStringTag,{value:"Module"}));class ec{constructor(){this.navContainer=null,this.authListeners=[]}init(){this.navContainer=document.getElementById("nav-list"),this.refreshMenu(),window.addEventListener("authStatusChanged",()=>{this.refreshMenu()}),window.addEventListener("storage",i=>{i.key==="token"&&this.refreshMenu()})}refreshMenu(){if(!this.navContainer)return;const i=zt.isAuthenticated();i?this.showUserMenu():this.showGuestMenu(),this.authListeners.forEach(o=>o(i))}showGuestMenu(){this.navContainer.innerHTML=`
      <li role="none"><a href="#/" role="menuitem" tabindex="0">üè† Halaman Utama</a></li>
      <li role="none"><a href="#/stories" role="menuitem" tabindex="0">üìö Daftar Cerita</a></li>
      <li role="none"><a href="#/login" role="menuitem" tabindex="0">üîê Login</a></li>
      <li role="none"><a href="#/register" role="menuitem" tabindex="0">üìù Buat Akun</a></li>
      <li role="none"><a href="#/about" role="menuitem" tabindex="0">‚ÑπÔ∏è Info Aplikasi</a></li>
    `}showUserMenu(){this.navContainer.innerHTML=`
      <li role="none"><a href="#/" role="menuitem" tabindex="0">üè† Halaman Utama</a></li>
      <li role="none"><a href="#/stories" role="menuitem" tabindex="0">üìö Daftar Cerita</a></li>
      <li role="none"><a href="#/add-story" role="menuitem" tabindex="0">‚ûï Buat Cerita Baru</a></li>
      <li role="none">
        <button id="logout-btn" class="nav-logout-btn" role="menuitem" tabindex="0" aria-label="Keluar dari aplikasi">
          üö™ Keluar
        </button>
      </li>
      <li role="none"><a href="#/about" role="menuitem" tabindex="0">‚ÑπÔ∏è Info Aplikasi</a></li>
    `;const i=document.getElementById("logout-btn");i&&(i.addEventListener("click",this.logoutHandler.bind(this)),i.addEventListener("keydown",o=>{(o.key==="Enter"||o.key===" ")&&(o.preventDefault(),this.logoutHandler())}))}logoutHandler(){confirm("Yakin ingin keluar dari akun ini?")&&(zt.logout(),this.refreshMenu())}onAuthStatusChange(i){this.authListeners.push(i)}static notifyAuthChange(){window.dispatchEvent(new CustomEvent("authStatusChanged"))}}const cn=new ec;class Xo{constructor(){this.vapidPublicKey="BCCs2eonMI-6H2ctvFaWg-UYdDv387Vno_bzUzALpB442r2lCnsHmtrx8biyPi_E-1fSGABK_Qs_GlvPoJJqxbk",this.isSubscribed=!1,this.registration=null,this.subscription=null,this.isSupported=this.checkSupport()}checkSupport(){const i="serviceWorker"in navigator&&"PushManager"in window;return console.log("üì± Push Notification Support Check:",{serviceWorker:"serviceWorker"in navigator,PushManager:"PushManager"in window,Notification:"Notification"in window,supported:i}),i}async initialize(){try{return console.log("üîÑ Initializing Push Notification Service..."),this.isSupported?(console.log("üìã Getting service worker registration..."),this.registration=await navigator.serviceWorker.ready,this.registration?(console.log("‚úÖ Service Worker ready:",{scope:this.registration.scope,active:!!this.registration.active}),await this.checkSubscription(),console.log("‚úÖ Push Notification Service initialized successfully"),!0):(console.warn("‚ùå Service Worker registration not available"),this.showMessage("Service Worker not ready","warning"),!1)):(console.warn("‚ùå Push notifications not supported in this browser"),this.showMessage("Browser does not support push notifications","warning"),!1)}catch(i){return console.error("‚ùå Failed to initialize push notifications:",i),this.showMessage("Failed to initialize push notifications","error"),!1}}async checkSubscription(){var i;try{return this.registration?(console.log("üîç Checking current subscription..."),this.subscription=await this.registration.pushManager.getSubscription(),this.isSubscribed=!!this.subscription,console.log("üìä Subscription status:",this.isSubscribed),this.subscription&&(console.log("üìù Subscription details:",{endpoint:((i=this.subscription.endpoint)==null?void 0:i.substring(0,50))+"..."}),await this.verifySubscription(this.subscription)||(console.log("üîÑ Subscription invalid, unsubscribing..."),await this.unsubscribe())),this.updateUI(),this.isSubscribed):(console.warn("‚ö†Ô∏è No service worker registration available"),!1)}catch(o){return console.error("‚ùå Error checking subscription:",o),!1}}async verifySubscription(i){try{return i&&i.endpoint&&i.endpoint.startsWith("https://")}catch(o){return console.error("Error verifying subscription:",o),!1}}async subscribe(){try{console.log("üöÄ Starting push subscription process..."),console.log("üîî Requesting notification permission...");const i=await this.requestPermission();if(console.log("üìä Notification permission result:",i),i!=="granted")throw new Error(`Notification permission: ${i}`)}catch(i){console.error("‚ùå Failed to subscribe to push notifications:",i);let o="Failed to enable notifications: ";return i.permission==="denied"?o=`
        ‚ùå Notification permission denied.
        
        How to fix:
        1. Click the üîí or ‚ÑπÔ∏è icon in the address bar
        2. Select "Site settings" or "Permissions"
        3. Find "Notifications" 
        4. Select "Allow"
        5. Refresh the page and try again
      `:i.message.includes("not supported")?o="Browser does not support push notifications.":o+=i.message,this.showMessage(o,"error"),null}}async unsubscribe(){try{if(!this.subscription)return console.log("‚ÑπÔ∏è No subscription to unsubscribe"),this.isSubscribed=!1,this.updateUI(),!0;console.log("üö´ Unsubscribing from push notifications...");let i=!1;try{i=await this.subscription.unsubscribe()}catch(o){console.warn("Unsubscribe method failed, manually removing:",o),i=!0}return i&&(console.log("‚úÖ Successfully unsubscribed from push notifications"),this.subscription=null,this.isSubscribed=!1,this.updateUI(),this.showMessage("üîï Push notifications disabled","info")),i}catch(i){return console.error("‚ùå Failed to unsubscribe:",i),this.showMessage("Failed to disable notifications","error"),!1}}async toggleSubscription(){console.log("üîÑ Toggling subscription, current status:",this.isSubscribed),this.isSubscribed?await this.unsubscribe():await this.subscribe()}async requestPermission(){if(!("Notification"in window))throw new Error("Browser does not support notifications");const i=Notification.permission;if(console.log("üìä Current notification permission:",i),i==="denied"){const o=new Error("Notification permission denied. Click the lock icon in the address bar ‚Üí Site settings ‚Üí Notifications ‚Üí Allow.");throw o.permission="denied",o}if(i==="granted")return"granted";try{const o=await Notification.requestPermission();if(console.log("üîî Permission request result:",o),o==="denied"){const r=new Error("You denied notification permission. To change, open browser settings.");throw r.permission="denied",r}return o}catch(o){throw console.error("Error requesting notification permission:",o),new Error("Failed to request notification permission")}}async sendSubscriptionToServer(i){var o;try{console.log("üåê Sending subscription to server...");const r=i.toJSON?i.toJSON():{endpoint:i.endpoint,keys:i.keys},c={endpoint:r.endpoint,keys:r.keys};console.log("üì¶ Subscription data:",{endpoint:((o=c.endpoint)==null?void 0:o.substring(0,50))+"...",hasKeys:!!c.keys});const d=this.getAuthToken(),h={"Content-Type":"application/json"};d&&(h.Authorization=`Bearer ${d}`);const p=await fetch("https://story-api.dicoding.dev/v1/notifications/subscribe",{method:"POST",headers:h,body:JSON.stringify(c)});if(console.log("üì° Server response status:",p.status),!p.ok){const w=await p.text();throw new Error(`Server error: ${p.status}`)}const g=await p.json();return console.log("‚úÖ Subscription sent to server successfully"),g}catch(r){throw console.error("‚ùå Failed to send subscription to server:",r),r}}getAuthToken(){try{const i=localStorage.getItem("authData");return i?JSON.parse(i).token:null}catch(i){return console.error("Error getting auth token:",i),null}}urlB64ToUint8Array(i){const o="=".repeat((4-i.length%4)%4),r=(i+o).replace(/\-/g,"+").replace(/_/g,"/"),c=window.atob(r),d=new Uint8Array(c.length);for(let h=0;h<c.length;++h)d[h]=c.charCodeAt(h);return d}updateUI(){const i=document.getElementById("notification-toggle-btn");if(!i){console.warn("‚ùå Notification button not found for UI update");return}if(!this.isSupported){i.innerHTML="‚ùå Not Supported",i.setAttribute("title","Browser does not support push notifications"),i.disabled=!0;return}i.innerHTML=this.isSubscribed?"üîî Notifications":"üîï Notifications",i.classList.toggle("active",this.isSubscribed),i.setAttribute("aria-label",this.isSubscribed?"Disable notifications":"Enable notifications"),i.setAttribute("title",this.isSubscribed?"Notifications active":"Notifications inactive"),i.disabled=!1}showMessage(i,o="info"){if(console.log(`üí¨ [${o}]: ${i}`),window.showMessage){window.showMessage(i,o);return}let r=document.getElementById("push-message");r||(r=document.createElement("div"),r.id="push-message",r.className="global-message",document.body.appendChild(r)),r.textContent=i,r.className=`global-message ${o} show`,setTimeout(()=>{r.classList.remove("show")},5e3)}simulateNewStoryNotification(i){var o;if(console.log("üì¢ Simulating new story notification:",i),!("Notification"in window))return console.warn("‚ùå Notification API not supported"),!1;if(Notification.permission!=="granted")return console.warn("‚ùå Notification permission not granted"),!1;try{const r=new Notification("üìñ New Story Added!",{body:`"${i.name||"Untitled Story"}" - ${(o=i.description)==null?void 0:o.substring(0,100)}...`||"A new story has been added",icon:"/images/story.png",image:i.photoUrl,badge:"/images/icon-192x512x512.png",tag:"new-story",requireInteraction:!0,data:{storyId:i.id,url:"/#/stories"},actions:[{action:"view",title:"Lihat Cerita"},{action:"close",title:"Tutup"}]});return r.onclick=()=>{console.log("Notification clicked, story ID:",i.id),window.focus(),window.location.hash=`#/stories/${i.id}`,r.close()},r.onclose=()=>{console.log("Notification closed")},console.log("‚úÖ Local notification shown successfully"),!0}catch(r){return console.error("‚ùå Failed to show local notification:",r),!1}}showLocalNotification(i,o,r={}){return this.simulateNewStoryNotification({name:i,description:o,...r})}getDebugInfo(){return{supported:this.isSupported,serviceWorker:"serviceWorker"in navigator,pushManager:"PushManager"in window,notification:"Notification"in window,permission:Notification.permission,isSubscribed:this.isSubscribed,hasRegistration:!!this.registration,hasSubscription:!!this.subscription}}}class _n{constructor(){this.dbName="AppDB",this.dbVersion=1,this.db=null,this.stores={STORIES:"stories",FAVORITES:"favorites",OFFLINE_STORIES:"offlineStories",SYNC_QUEUE:"syncQueue"}}async initialize(){return new Promise((i,o)=>{const r=indexedDB.open(this.dbName,this.dbVersion);r.onerror=()=>{console.error("IndexedDB initialization failed:",r.error),o(r.error)},r.onsuccess=()=>{this.db=r.result,console.log("IndexedDB initialized successfully"),i(this.db)},r.onupgradeneeded=c=>{const d=c.target.result;if(!d.objectStoreNames.contains(this.stores.STORIES)){const h=d.createObjectStore(this.stores.STORIES,{keyPath:"id"});h.createIndex("name","name",{unique:!1}),h.createIndex("createdAt","createdAt",{unique:!1}),h.createIndex("lat","lat",{unique:!1}),h.createIndex("lon","lon",{unique:!1})}if(d.objectStoreNames.contains(this.stores.FAVORITES)||d.createObjectStore(this.stores.FAVORITES,{keyPath:"storyId"}).createIndex("addedAt","addedAt",{unique:!1}),!d.objectStoreNames.contains(this.stores.OFFLINE_STORIES)){const h=d.createObjectStore(this.stores.OFFLINE_STORIES,{keyPath:"tempId",autoIncrement:!0});h.createIndex("createdAt","createdAt",{unique:!1}),h.createIndex("synced","synced",{unique:!1})}if(!d.objectStoreNames.contains(this.stores.SYNC_QUEUE)){const h=d.createObjectStore(this.stores.SYNC_QUEUE,{keyPath:"id",autoIncrement:!0});h.createIndex("action","action",{unique:!1}),h.createIndex("timestamp","timestamp",{unique:!1})}console.log("IndexedDB stores created/upgraded")}})}async performOperation(i,o,r=null){return this.db||await this.initialize(),new Promise((c,d)=>{const p=this.db.transaction([i],"readwrite").objectStore(i);let g;switch(o){case"add":g=p.add(r);break;case"put":g=p.put(r);break;case"get":g=p.get(r);break;case"delete":g=p.delete(r);break;case"getAll":g=p.getAll();break;case"clear":g=p.clear();break;default:d(new Error(`Unknown operation: ${o}`));return}g.onsuccess=()=>c(g.result),g.onerror=()=>d(g.error)})}async addStory(i){try{const o={...i,addedAt:new Date().toISOString(),cached:!0};return await this.performOperation(this.stores.STORIES,"put",o),console.log("Story added to IndexedDB:",i.id),o}catch(o){throw console.error("Failed to add story to IndexedDB:",o),o}}async getStory(i){try{return await this.performOperation(this.stores.STORIES,"get",i)}catch(o){return console.error("Failed to get story from IndexedDB:",o),null}}async getAllStories(){try{return await this.performOperation(this.stores.STORIES,"getAll")||[]}catch(i){return console.error("Failed to get all stories from IndexedDB:",i),[]}}async deleteStory(i){try{return await this.performOperation(this.stores.STORIES,"delete",i),console.log("Story deleted from IndexedDB:",i),!0}catch(o){return console.error("Failed to delete story from IndexedDB:",o),!1}}async clearStories(){try{return await this.performOperation(this.stores.STORIES,"clear"),console.log("All stories cleared from IndexedDB"),!0}catch(i){return console.error("Failed to clear stories from IndexedDB:",i),!1}}async searchStories(i){try{return(await this.getAllStories()).filter(c=>{var d,h;return((d=c.name)==null?void 0:d.toLowerCase().includes(i.toLowerCase()))||((h=c.description)==null?void 0:h.toLowerCase().includes(i.toLowerCase()))})}catch(o){return console.error("Failed to search stories:",o),[]}}async sortStories(i="createdAt",o="desc"){try{return(await this.getAllStories()).sort((c,d)=>{let h=c[i],p=d[i];return(i==="createdAt"||i==="addedAt")&&(h=new Date(h),p=new Date(p)),typeof h=="string"&&(h=h.toLowerCase(),p=p.toLowerCase()),o==="asc"?h>p?1:-1:h<p?1:-1})}catch(r){return console.error("Failed to sort stories:",r),[]}}async filterStories(i){try{return(await this.getAllStories()).filter(r=>{let c=!0;if(i.dateFrom){const d=new Date(r.createdAt),h=new Date(i.dateFrom);d<h&&(c=!1)}if(i.dateTo){const d=new Date(r.createdAt),h=new Date(i.dateTo);d>h&&(c=!1)}return i.nearLocation&&r.lat&&r.lon&&this.calculateDistance(i.nearLocation.lat,i.nearLocation.lon,r.lat,r.lon)>(i.maxDistance||50)&&(c=!1),c})}catch(o){return console.error("Failed to filter stories:",o),[]}}calculateDistance(i,o,r,c){const h=this.degreesToRadians(r-i),p=this.degreesToRadians(c-o),g=Math.sin(h/2)*Math.sin(h/2)+Math.cos(this.degreesToRadians(i))*Math.cos(this.degreesToRadians(r))*Math.sin(p/2)*Math.sin(p/2);return 6371*(2*Math.atan2(Math.sqrt(g),Math.sqrt(1-g)))}degreesToRadians(i){return i*(Math.PI/180)}async addToFavorites(i,o){try{const r={storyId:i,storyData:o,addedAt:new Date().toISOString()};return await this.performOperation(this.stores.FAVORITES,"put",r),console.log("Story added to favorites:",i),r}catch(r){throw console.error("Failed to add story to favorites:",r),r}}async removeFromFavorites(i){try{return await this.performOperation(this.stores.FAVORITES,"delete",i),console.log("Story removed from favorites:",i),!0}catch(o){return console.error("Failed to remove story from favorites:",o),!1}}async getFavorites(){try{return await this.performOperation(this.stores.FAVORITES,"getAll")||[]}catch(i){return console.error("Failed to get favorites:",i),[]}}async isFavorite(i){try{return!!await this.performOperation(this.stores.FAVORITES,"get",i)}catch(o){return console.error("Failed to check if story is favorite:",o),!1}}async addOfflineStory(i){try{const o={...i,createdAt:new Date().toISOString(),synced:!1,action:"create"},r=await this.performOperation(this.stores.OFFLINE_STORIES,"add",o);return console.log("Offline story added:",r),await this.addToSyncQueue("create",o),r}catch(o){throw console.error("Failed to add offline story:",o),o}}async getOfflineStories(){try{return(await this.performOperation(this.stores.OFFLINE_STORIES,"getAll")).filter(o=>!o.synced)||[]}catch(i){return console.error("Failed to get offline stories:",i),[]}}async markStorySynced(i,o){try{const r=await this.performOperation(this.stores.OFFLINE_STORIES,"get",i);return r&&(r.synced=!0,r.apiId=o,r.syncedAt=new Date().toISOString(),await this.performOperation(this.stores.OFFLINE_STORIES,"put",r)),!0}catch(r){return console.error("Failed to mark story as synced:",r),!1}}async addToSyncQueue(i,o){try{const r={action:i,data:o,timestamp:new Date().toISOString(),retryCount:0};return await this.performOperation(this.stores.SYNC_QUEUE,"add",r),r}catch(r){throw console.error("Failed to add to sync queue:",r),r}}async getSyncQueue(){try{return await this.performOperation(this.stores.SYNC_QUEUE,"getAll")||[]}catch(i){return console.error("Failed to get sync queue:",i),[]}}async removeSyncQueueItem(i){try{return await this.performOperation(this.stores.SYNC_QUEUE,"delete",i),!0}catch(o){return console.error("Failed to remove sync queue item:",o),!1}}async clearSyncQueue(){try{return await this.performOperation(this.stores.SYNC_QUEUE,"clear"),!0}catch(i){return console.error("Failed to clear sync queue:",i),!1}}async clearAllData(){try{return await Promise.all([this.performOperation(this.stores.STORIES,"clear"),this.performOperation(this.stores.FAVORITES,"clear"),this.performOperation(this.stores.OFFLINE_STORIES,"clear"),this.performOperation(this.stores.SYNC_QUEUE,"clear")]),console.log("All IndexedDB data cleared"),!0}catch(i){return console.error("Failed to clear all data:",i),!1}}async getDBStats(){try{const[i,o,r,c]=await Promise.all([this.getAllStories(),this.getFavorites(),this.getOfflineStories(),this.getSyncQueue()]);return{stories:i.length,favorites:o.length,offlineStories:r.length,syncQueue:c.length,totalSize:this.estimateStorageSize(i,o,r,c)}}catch(i){return console.error("Failed to get database stats:",i),{stories:0,favorites:0,offlineStories:0,syncQueue:0,totalSize:0}}}estimateStorageSize(...i){return i.reduce((r,c)=>r+c.length,0)*2}}class ts{constructor(){this.indexedDBService=new _n,this.apiService=zt,this.isOnline=navigator.onLine,this.syncInProgress=!1,this.syncListeners=[],this.setupOnlineListeners()}async initialize(){try{return await this.indexedDBService.initialize(),console.log("‚úÖ Sync service initialized"),this.isOnline&&await this.syncOfflineData(),!0}catch(i){return console.error("‚ùå Failed to initialize sync service:",i),!1}}setupOnlineListeners(){window.addEventListener("online",()=>{console.log("üåê Connection restored - starting sync"),this.isOnline=!0,this.notifyListeners("online"),this.syncOfflineData()}),window.addEventListener("offline",()=>{console.log("üì¥ Connection lost - entering offline mode"),this.isOnline=!1,this.notifyListeners("offline")})}addSyncListener(i){this.syncListeners.push(i)}removeSyncListener(i){this.syncListeners=this.syncListeners.filter(o=>o!==i)}notifyListeners(i,o=null){this.syncListeners.forEach(r=>{try{r(i,o)}catch(c){console.error("Error in sync listener:",c)}})}async syncOfflineData(){if(this.syncInProgress){console.log("Sync already in progress");return}if(!this.isOnline){console.log("Device is offline, cannot sync");return}this.syncInProgress=!0,this.notifyListeners("sync-start");try{console.log("üîÑ Starting offline data synchronization...");const i=await this.indexedDBService.getOfflineStories(),o=await this.indexedDBService.getSyncQueue();let r=0,c=0;for(const h of i)try{await this.syncOfflineStory(h),r++,this.notifyListeners("story-synced",{story:h,success:!0})}catch(p){console.error("Failed to sync offline story:",p),c++,this.notifyListeners("story-synced",{story:h,success:!1,error:p})}for(const h of o)try{await this.processSyncQueueItem(h),await this.indexedDBService.removeSyncQueueItem(h.id),this.notifyListeners("queue-item-synced",{item:h,success:!0})}catch(p){console.error("Failed to process sync queue item:",p),this.notifyListeners("queue-item-synced",{item:h,success:!1,error:p})}await this.updateCachedStories();const d={syncedCount:r,failedCount:c,totalProcessed:i.length+o.length};return console.log("‚úÖ Sync completed:",d),this.notifyListeners("sync-complete",d),d}catch(i){throw console.error("‚ùå Sync process failed:",i),this.notifyListeners("sync-error",i),i}finally{this.syncInProgress=!1}}async syncOfflineStory(i){var o;try{if(!this.apiService.isAuthenticated())throw new Error("User not authenticated");const r=new FormData;if(r.append("description",i.description),i.photo){let d;typeof i.photo=="string"&&i.photo.startsWith("data:")?d=await(await fetch(i.photo)).blob():(i.photo instanceof File||i.photo instanceof Blob)&&(d=i.photo),d&&r.append("photo",d,i.photoName||"story-photo.jpg")}i.lat&&i.lon&&(r.append("lat",i.lat.toString()),r.append("lon",i.lon.toString()));const c=await this.apiService.addStory(r);if(c.error===!1)return await this.indexedDBService.markStorySynced(i.tempId,(o=c.story)==null?void 0:o.id),c.story&&await this.indexedDBService.addStory(c.story),console.log("‚úÖ Offline story synced successfully:",i.tempId),c;throw new Error(c.message||"Failed to sync story")}catch(r){throw console.error("‚ùå Failed to sync offline story:",r),i.retryCount=(i.retryCount||0)+1,i.lastError=r.message,i.lastRetryAt=new Date().toISOString(),i.retryCount>=3&&(i.syncFailed=!0),await this.indexedDBService.updateOfflineStory(i.tempId,i),r}}async processSyncQueueItem(i){switch(i.action){case"create":return await this.syncOfflineStory(i.data);case"update":console.log("Update action not implemented yet");break;case"delete":console.log("Delete action not implemented yet");break;default:console.warn("Unknown sync queue action:",i.action)}}async updateCachedStories(){try{if(!this.apiService.isAuthenticated()){console.log("User not authenticated, skipping cached stories update");return}console.log("üì• Updating cached stories from API...");const i=await this.apiService.getStories();if(i.error===!1&&i.listStory){await this.indexedDBService.clearStories();for(const o of i.listStory)await this.indexedDBService.addStory(o);console.log(`‚úÖ Cached ${i.listStory.length} stories`)}}catch(i){console.error("‚ùå Failed to update cached stories:",i)}}async addStoryOffline(i){try{console.log("üíæ Adding story to offline queue..."),i.photo instanceof File&&(i.photo=await this.fileToBase64(i.photo),i.photoName=i.photo.name);const o=await this.indexedDBService.addOfflineStory(i);return console.log("‚úÖ Story added to offline queue:",o.tempId),o}catch(o){throw console.error("‚ùå Failed to add story to offline queue:",o),o}}async fileToBase64(i){return new Promise((o,r)=>{const c=new FileReader;c.readAsDataURL(i),c.onload=()=>o(c.result),c.onerror=d=>r(d)})}async getStories(i=!1){try{if(this.isOnline&&i)try{await this.updateCachedStories()}catch{console.warn("‚ö†Ô∏è Failed to refresh from API, using cached data")}const o=await this.indexedDBService.getAllStories(),r=await this.indexedDBService.getOfflineStories(),c=[...o];for(const d of r)c.push({...d,id:`offline-${d.tempId}`,isOffline:!0,syncPending:!0});return c.sort((d,h)=>new Date(h.createdAt)-new Date(d.createdAt)),c}catch(o){return console.error("‚ùå Failed to get stories:",o),[]}}async forceSync(){if(!this.isOnline)throw new Error("Device is offline. Cannot sync.");return await this.syncOfflineData()}getSyncStatus(){return{isOnline:this.isOnline,syncInProgress:this.syncInProgress,lastSyncAt:localStorage.getItem("lastSyncAt"),hasPendingChanges:!1}}async hasPendingChanges(){try{const[i,o]=await Promise.all([this.indexedDBService.getOfflineStories(),this.indexedDBService.getSyncQueue()]);return i.length>0||o.length>0}catch(i){return console.error("Error checking pending changes:",i),!1}}async clearOfflineData(){try{return await this.indexedDBService.clearAllData(),console.log("‚úÖ All offline data cleared"),this.notifyListeners("data-cleared"),!0}catch(i){return console.error("‚ùå Failed to clear offline data:",i),!1}}}window.pushNotificationService=null;window.indexedDBService=null;window.syncService=null;function ic(){if("serviceWorker"in navigator){console.log("üîß Attempting to register Service Worker...");const a=["/story-catalog/sw.js","/sw.js","./sw.js","../sw.js"],i=async r=>{try{console.log(`üìÅ Trying to register Service Worker from: ${r}`);const c=await navigator.serviceWorker.register(r,{scope:"/story-catalog/"});return console.log("‚úÖ Service Worker registered successfully from:",r),c}catch(c){return console.warn(`‚ùå Failed to register from ${r}:`,c.message),null}};(async()=>{for(const r of a){const c=await i(r);if(c)return c}try{console.log("üîÑ Trying fallback registration...");const r=await navigator.serviceWorker.register("/sw.js");return console.log("‚úÖ Fallback registration successful"),r}catch(r){throw console.error("‚ùå All Service Worker registration attempts failed"),r}})().then(r=>{console.log("üéâ Service Worker successfully registered:",r),r.addEventListener("updatefound",()=>{const c=r.installing;console.log("üîÑ New service worker found:",c),c.addEventListener("statechange",()=>{console.log("üìä New service worker state:",c.state),c.state==="activated"&&console.log("‚úÖ New Service Worker activated")})})}).catch(r=>{console.error("‚ùå Service Worker registration failed:",r),$t("Some PWA features may not be available","warning")})}else console.warn("‚ùå Service Worker not supported in this browser")}ic();async function nc(){try{if(console.log("üîÑ Initializing services..."),typeof Xo<"u"){window.pushNotificationService=new Xo,console.log("‚è≥ Waiting for service worker to be ready..."),await new Promise(a=>{navigator.serviceWorker.controller?a():navigator.serviceWorker.ready.then(a)}),console.log("‚úÖ Service Worker is ready, initializing push notifications...");try{const a=await window.pushNotificationService.initialize();console.log("üì± Push Notification Service initialized:",a),a?console.log("‚úÖ Push Notification Service fully initialized"):console.warn("‚ö†Ô∏è Push Notification Service not supported or failed")}catch(a){console.warn("‚ö†Ô∏è Push Notification Service initialization failed:",a)}mi()}else console.warn("‚ö†Ô∏è PushNotificationService not available"),mi();if(typeof _n<"u"){window.indexedDBService=new _n;try{await window.indexedDBService.initialize(),console.log("‚úÖ IndexedDB Service initialized")}catch(a){console.warn("‚ö†Ô∏è IndexedDB Service initialization failed:",a)}}if(typeof ts<"u"){window.syncService=new ts;try{await window.syncService.initialize(),console.log("‚úÖ Sync Service initialized")}catch(a){console.warn("‚ö†Ô∏è Sync Service initialization failed:",a)}}console.log("‚úÖ All services initialized")}catch(a){console.warn("Some services could not be initialized:",a),mi()}}function mi(){console.log("üîß Setting up notification button...");let a=document.getElementById("notification-toggle-btn");if(a)console.log("‚úÖ Notification button already exists");else{console.log("üÜï Creating new notification button"),a=document.createElement("button"),a.id="notification-toggle-btn",a.className="header-action-btn notification-btn",a.innerHTML="üîï",a.setAttribute("aria-label","Toggle push notifications"),a.setAttribute("title","Enable/Disable notifications");const i=document.querySelector(".header-actions");i?(console.log("üìå Adding notification button to header"),i.insertBefore(a,i.firstChild)):(console.log("üìå Header actions container not found, appending to body"),document.body.appendChild(a))}a.disabled=!1,console.log("üîì Button disabled status:",a.disabled),a.style.display="block",es(),a.hasAttribute("data-listener-added")||(a.setAttribute("data-listener-added","true"),a.addEventListener("click",async()=>{if(console.log("üñ±Ô∏è Notification button clicked"),!window.pushNotificationService){console.log("‚ùå Push notification service not available"),$t("Notification service not available","error");return}try{console.log("‚è≥ Starting subscription toggle..."),a.disabled=!0,a.innerHTML="‚è≥",await window.pushNotificationService.toggleSubscription(),console.log("‚úÖ Subscription toggle completed")}catch(i){console.error("‚ùå Error toggling notification:",i),$t("Failed to change notification settings: "+i.message,"error")}finally{console.log("üîì Re-enabling button"),a.disabled=!1,es()}})),console.log("‚úÖ Notification button setup completed")}function es(){console.log("üé® Updating notification button appearance");const a=document.getElementById("notification-toggle-btn");if(!a){console.log("‚ùå Notification button not found for update");return}if(!window.pushNotificationService){console.log("‚ö†Ô∏è Push service not available, setting button to info state"),a.innerHTML="üîï",a.classList.remove("active"),a.setAttribute("aria-label","Notifications not available"),a.setAttribute("title","Notification service not available"),a.disabled=!1;return}const i=window.pushNotificationService.isSubscribed;console.log("üìä Current subscription status:",i),a.innerHTML=i?"üîî":"üîï",a.classList.toggle("active",i),a.setAttribute("aria-label",i?"Disable notifications":"Enable notifications"),a.setAttribute("title",i?"Notifications active - Click to disable":"Notifications inactive - Click to enable"),a.disabled=!1,console.log("‚úÖ Button updated - disabled:",a.disabled)}document.addEventListener("DOMContentLoaded",async()=>{console.log("DOM Content Loaded - Starting app initialization");try{pi.init(),pi.setupSkipLinks(),console.log("‚úì Accessibility initialized"),cn.init(),console.log("‚úì Navigation service initialized"),await nc(),console.log("‚úì Services initialized");const a=new tc({content:document.querySelector("#main-content"),drawerButton:document.querySelector("#drawer-button"),navigationDrawer:document.querySelector("#navigation-drawer")});console.log("‚úì App instance created"),await a.renderPage(),console.log("‚úì Initial page rendered"),window.addEventListener("hashchange",async()=>{console.log("Hash changed to:",window.location.hash),await a.renderPage();const i=document.title.split(" - ")[0];pi.announcePageChange(i),cn.updateNavigation()}),document.addEventListener("authStateChange",()=>{cn.updateNavigation()}),document.addEventListener("highlightMarker",i=>{console.log("Highlight marker requested for story:",i.detail)}),console.log("üéâ App successfully initialized")}catch(a){console.error("‚ùå App initialization failed:",a);const i=document.querySelector("#main-content");i&&(i.innerHTML=`
        <div style="text-align: center; padding: 2rem;">
          <h1>‚ö†Ô∏è Initialization Error</h1>
          <p>Sorry, the application failed to initialize.</p>
          <p>Error: ${a.message}</p>
          <button onclick="location.reload()" style="padding: 0.5rem 1rem; margin-top: 1rem;">
            üîÑ Reload Page
          </button>
        </div>
      `)}});function oc(){let a;window.addEventListener("beforeinstallprompt",i=>{console.log("PWA install prompt available"),i.preventDefault(),a=i,sc(a)}),window.addEventListener("appinstalled",()=>{console.log("PWA was installed"),Cs(),$t("Application installed successfully!","success")})}function sc(a){console.log("Setting up install button...");let i=document.getElementById("pwa-install-btn");if(i)console.log("Install button already exists");else{console.log("Creating new install button"),i=document.createElement("button"),i.id="pwa-install-btn",i.className="header-action-btn install-btn",i.innerHTML='<span class="install-icon">üì±</span><span class="install-text">Install</span>',i.setAttribute("aria-label","Install application to device"),i.setAttribute("title","Install this app to your device");const o=document.querySelector(".header-actions");o?(console.log("Adding install button to header"),o.appendChild(i)):(console.log("Header actions container not found, appending to body"),document.body.appendChild(i))}i.style.display="block",console.log("Install button displayed"),i.hasAttribute("data-listener-added")||(i.setAttribute("data-listener-added","true"),i.addEventListener("click",async()=>{if(console.log("Install button clicked"),a){a.prompt();const{outcome:o}=await a.userChoice;console.log(`User response to the install prompt: ${o}`),a=null,Cs()}}))}function Cs(){const a=document.getElementById("pwa-install-btn");a&&(a.style.display="none",console.log("Install button hidden"))}function rc(){window.syncService&&window.syncService.addSyncListener((a,i)=>{switch(a){case"online":$t("Connection restored! Synchronizing data...","info");break;case"offline":$t("No connection. Offline mode active.","warning");break;case"sync-complete":i.syncedCount>0&&$t(`${i.syncedCount} data synchronized successfully`,"success");break;case"sync-error":$t("Failed to synchronize data","error");break}})}function $t(a,i="info",o=5e3){console.log(`Showing message: ${a} (${i})`);let r=document.getElementById("global-message");r||(r=document.createElement("div"),r.id="global-message",r.className="global-message",r.setAttribute("role","alert"),r.setAttribute("aria-live","polite"),document.body.appendChild(r)),r.textContent=a,r.className=`global-message ${i} show`,setTimeout(()=>{r.classList.remove("show")},o)}document.addEventListener("DOMContentLoaded",()=>{console.log("DOM loaded - setting up PWA features"),oc(),rc()});setTimeout(()=>{console.log("Fallback: Checking if notification button exists..."),document.getElementById("notification-toggle-btn")||(console.log("Fallback: Notification button still not found, creating it..."),mi())},2e3);
